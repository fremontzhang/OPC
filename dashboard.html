<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>‰∏ÉÊòüÈì∂Ê≤≥ - Dashboard</title>

    <!-- Tailwind CSS -->

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->

    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>

    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <!-- Custom Fonts -->

    <link href="https://fonts.googleapis.com/css2 ? family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {

            font-family: 'Inter', sans-serif;

            overflow: hidden;

            background: #0a0e27;

        }

        /* Stunning Dark Gradient Background */

        @keyframes gradientShift {

            0% {

                background-position: 0% 50%;

            }

            50% {

                background-position: 100% 50%;

            }

            100% {

                background-position: 0% 50%;

            }

        }

        .animated-bg {

            background: linear-gradient(135deg,

                    #0f0c29 0%,

                    #302b63 25%,

                    #24243e 50%,

                    #0f0c29 75%,

                    #302b63 100%);

            /* Disabling background shift for zero-light look */
            background: #0a0e27;
            animation: none;


            top: 0;

            left: 0;

            right: 0;

            bottom: 0;

            opacity: 1;

            pointer-events: none;

            z-index: 0;

        }

        /* Animated Grid Background */

        @keyframes gridMove {

            0% {

                transform: translateY(0);

            }

            100% {

                transform: translateY(50px);

            }

        }

        /* Flattened Grid Background as requested */
        .grid-bg {
            display: none !important;
        }


        /* Removed Glowing Orbs as requested */
        .glow-orb {
            display: none !important;
        }


        /* Removed Particles as requested */
        .particle {
            display: none !important;
        }


        /* Glass Morphism Card */

        .glass-card {

            background: rgba(15, 12, 41, 0.7);

            backdrop-filter: blur(20px) saturate(180%);

            border: 1px solid rgba(139, 92, 246, 0.3);

            box-shadow: 0 8px 32px 0 rgba(139, 92, 246, 0.15);

            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            position: relative;

            overflow: hidden;

        }

        .glass-card::before {

            content: '';

            position: absolute;

            top: 0;

            left: -100%;

            width: 100%;

            height: 100%;

            background: linear-gradient(90deg, transparent, rgba(139, 92, 246, 0.2), transparent);

            transition: left 0.5s;

        }

        .glass-card:hover::before {

            left: 100%;

        }

        .glass-card:hover {

            transform: translateY(-8px) scale(1.02);

            box-shadow: 0 20px 40px 0 rgba(139, 92, 246, 0.3),

                0 0 20px 0 rgba(139, 92, 246, 0.4);

            border-color: rgba(139, 92, 246, 0.6);

        }

        /* Ripple Effect */

        @keyframes ripple {

            0% {

                transform: scale(0);

                opacity: 0.6;

            }

            100% {

                transform: scale(2);

                opacity: 0;

            }

        }

        .ripple-container {

            position: relative;

            overflow: hidden;

        }

        .ripple {

            position: absolute;

            border-radius: 50%;

            background: rgba(255, 255, 255, 0.6);

            transform: scale(0);

            animation: ripple 0.6s ease-out;

            pointer-events: none;

        }

        /* Glow Effect */

        @keyframes glow {

            0%,

            100% {

                box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);

            }

            50% {

                box-shadow: 0 0 40px rgba(59, 130, 246, 0.8), 0 0 60px rgba(59, 130, 246, 0.5);

            }

        }

        .glow-effect {

            animation: glow 2s ease-in-out infinite;

        }

        /* Pulse Animation */

        @keyframes pulse {

            0%,

            100% {

                transform: scale(1);

            }

            50% {

                transform: scale(1.05);

            }

        }

        .pulse-animation {

            animation: pulse 2s ease-in-out infinite;

        }

        /* Bounce In */

        @keyframes bounceIn {

            0% {

                transform: scale(0.3);

                opacity: 0;

            }

            50% {

                transform: scale(1.05);

            }

            70% {

                transform: scale(0.9);

            }

            100% {

                transform: scale(1);

                opacity: 1;

            }

        }

        .bounce-in {

            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);

        }

        /* Shimmer Effect */

        @keyframes shimmer {

            0% {

                background-position: -1000px 0;

            }

            100% {

                background-position: 1000px 0;

            }

        }

        .shimmer {

            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);

            background-size: 1000px 100%;

            animation: shimmer 2s infinite;

        }

        /* Rotate 3D */

        @keyframes rotate3d {

            0% {

                transform: perspective(1000px) rotateY(0deg);

            }

            100% {

                transform: perspective(1000px) rotateY(360deg);

            }

        }

        .rotate-3d:hover {

            animation: rotate3d 1s ease-in-out;

        }

        /* Loading Spinner - Advanced */

        @keyframes spin {

            to {

                transform: rotate(360deg);

            }

        }

        @keyframes spinReverse {

            to {

                transform: rotate(-360deg);

            }

        }

        .spinner-dual {

            position: relative;

            width: 60px;

            height: 60px;

        }

        .spinner-dual::before,

        .spinner-dual::after {

            content: '';

            position: absolute;

            border-radius: 50%;

        }

        .spinner-dual::before {

            width: 100%;

            height: 100%;

            border: 4px solid transparent;

            border-top-color: #3b82f6;

            animation: spin 1s linear infinite;

        }

        .spinner-dual::after {

            width: 80%;

            height: 80%;

            margin: 10%;

            border: 4px solid transparent;

            border-bottom-color: #8b5cf6;

            animation: spinReverse 0.7s linear infinite;

        }

        /* Gradient Text */

        @keyframes gradientText {

            0%,

            100% {

                background-position: 0% 50%;

            }

            50% {

                background-position: 100% 50%;

            }

        }

        .gradient-text {

            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899, #3b82f6);

            background-size: 200% auto;

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

            animation: gradientText 3s ease infinite;

        }

        /* Removed Neon Glow as requested */
        .neon-glow {
            text-shadow: none !important;
        }


        /* Card Flip */

        .card-flip {

            perspective: 1000px;

        }

        .card-flip-inner {

            transition: transform 0.6s;

            transform-style: preserve-3d;

        }

        .card-flip:hover .card-flip-inner {

            transform: rotateY(180deg);

        }

        /* Slide In Animations */

        @keyframes slideInLeft {

            from {

                transform: translateX(-100%);

                opacity: 0;

            }

            to {

                transform: translateX(0);

                opacity: 1;

            }

        }

        @keyframes slideInRight {

            from {

                transform: translateX(100%);

                opacity: 0;

            }

            to {

                transform: translateX(0);

                opacity: 1;

            }

        }

        @keyframes slideInUp {

            from {

                transform: translateY(100%);

                opacity: 0;

            }

            to {

                transform: translateY(0);

                opacity: 1;

            }

        }

        @keyframes slideInDown {

            from {

                transform: translateY(-100%);

                opacity: 0;

            }

            to {

                transform: translateY(0);

                opacity: 1;

            }

        }

        /* Gradient Animation for Text */
        @keyframes gradient-x {

            0%,
            100% {
                background-size: 200% 200%;
                background-position: left center;
            }

            50% {
                background-size: 200% 200%;
                background-position: right center;
            }
        }

        .animate-gradient-x {
            animation: gradient-x 15s ease infinite;
        }

        .slide-in-left {

            animation: slideInLeft 0.6s ease-out;

        }

        .slide-in-right {

            animation: slideInRight 0.6s ease-out;

        }

        .slide-in-up {

            animation: slideInUp 0.6s ease-out;

        }

        .slide-in-down {

            animation: slideInDown 0.6s ease-out;

        }

        /* Scale Up */

        @keyframes scaleUp {

            from {

                transform: scale(0);

                opacity: 0;

            }

            to {

                transform: scale(1);

                opacity: 1;

            }

        }

        .scale-up {

            animation: scaleUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);

        }

        /* Fade In */

        @keyframes fadeIn {

            from {

                opacity: 0;

            }

            to {

                opacity: 1;

            }

        }

        .fade-in {

            animation: fadeIn 0.8s ease-in;

        }

        /* Custom Scrollbar - Enhanced */

        ::-webkit-scrollbar {

            width: 8px;

            height: 8px;

        }

        ::-webkit-scrollbar-track {

            background: rgba(241, 245, 249, 0.3);

            border-radius: 10px;

        }

        ::-webkit-scrollbar-thumb {

            background: linear-gradient(135deg, #667eea, #764ba2);

            border-radius: 10px;

            transition: all 0.3s;

        }

        ::-webkit-scrollbar-thumb:hover {

            background: linear-gradient(135deg, #764ba2, #667eea);

            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);

        }

        /* Hover Lift Effect */

        .hover-lift {

            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        }

        .hover-lift:hover {

            transform: translateY(-4px);

            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

        }

        /* Button Press Effect */

        .btn-press:active {

            transform: scale(0.95);

        }

        /* Gradient Border Animation */

        @keyframes gradientBorder {

            0%,

            100% {

                border-color: #3b82f6;

            }

            25% {

                border-color: #8b5cf6;

            }

            50% {

                border-color: #ec4899;

            }

            75% {

                border-color: #10b981;

            }

        }

        .animated-border {

            animation: gradientBorder 3s linear infinite;

        }

        /* Tilt on Hover */

        .tilt-hover:hover {

            transform: perspective(1000px) rotateX(5deg) rotateY(5deg);

            transition: transform 0.3s ease;

        }

        /* Sparkle Effect */

        @keyframes sparkle {

            0%,

            100% {

                opacity: 0;

                transform: scale(0);

            }

            50% {

                opacity: 1;

                transform: scale(1);

            }

        }

        .sparkle::after {

            content: '‚ú®';

            position: absolute;

            top: -5px;

            right: -5px;

            animation: sparkle 1.5s ease-in-out infinite;

        }

        /* Toast Notification */

        @keyframes toastSlideIn {

            from {

                transform: translateX(400px);

            }

            to {

                transform: translateX(0);

            }

        }

        .toast-notification {

            animation: toastSlideIn 0.3s ease-out;

        }

        /* Removed Progress Glow as requested */
        .progress-glow {
            box-shadow: none !important;
            animation: none !important;
        }

        /* Toast Progress Bar Animation */
        @keyframes shrink {
            from {
                width: 100%;
            }

            to {
                width: 0%;
            }
        }


        /* Dark Theme Global Overrides - COMPLETE */

        .bg-white,

        [class*="bg-white"] {

            background: rgba(15, 12, 41, 0.5) !important;

            backdrop-filter: blur(20px) saturate(150%);

            border-color: rgba(139, 92, 246, 0.2) !important;

        }

        .bg-slate-50,

        .bg-slate-100,

        .bg-gray-50,

        .bg-gray-100 {

            background: rgba(30, 27, 75, 0.3) !important;

            backdrop-filter: blur(10px);

        }

        .bg-slate-200,

        .bg-gray-200 {

            background: rgba(40, 37, 85, 0.4) !important;

        }

        .border-slate-100,

        .border-slate-200,

        .border-gray-100,

        .border-gray-200 {

            border-color: rgba(139, 92, 246, 0.2) !important;

        }

        .text-slate-900,

        .text-slate-800,

        .text-gray-900,

        .text-gray-800 {

            color: rgb(226, 232, 240) !important;

        }

        .text-slate-700,

        .text-slate-600,

        .text-gray-700,

        .text-gray-600 {

            color: rgb(203, 213, 225) !important;

        }

        .text-slate-500,

        .text-gray-500 {

            color: rgb(148, 163, 184) !important;

        }

        .text-slate-400,

        .text-gray-400 {

            color: rgb(148, 163, 184) !important;

        }

        .text-slate-300,

        .text-gray-300 {

            color: rgb(203, 213, 225) !important;

        }

        /* Input fields dark theme */

        input[type="text"],

        input[type="email"],

        input[type="password"],

        textarea,

        select {

            background: rgba(30, 27, 75, 0.5) !important;

            border-color: rgba(139, 92, 246, 0.3) !important;

            color: rgb(226, 232, 240) !important;

        }

        input::placeholder,

        textarea::placeholder {

            color: rgb(148, 163, 184) !important;

        }

        /* Shadow updates - removed glow/light */
        .shadow-sm,
        .shadow,
        .shadow-md,
        .shadow-lg,
        .shadow-xl,
        .shadow-2xl {
            box-shadow: none !important;
        }


        /* Remove any remaining white hover states */

        .hover\:bg-white:hover {

            background: rgba(30, 27, 75, 0.5) !important;

        }

        .hover\:bg-slate-50:hover,
        .hover\:bg-gray-50:hover {
            background: rgba(40, 37, 85, 0.4) !important;
        }

        .glow-effect {
            box-shadow: none !important;
            filter: none !important;
        }

        /* Remove purple sidebar glow specifically */
        .shadow-purple-500\/50,
        .shadow-purple-900\/20,
        .shadow-blue-500\/20 {
            box-shadow: none !important;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%) skewX(-12deg);
            }

            100% {
                transform: translateX(200%) skewX(-12deg);
            }
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .slide-in-right {
            animation: slideInRight 0.3s ease-out forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>

    <script>

        tailwind.config = {

            theme: {

                extend: {

                    colors: {

                        primary: '#0F172A', // Slate 900

                        secondary: '#3B82F6', // Blue 500

                        accent: '#0EA5E9',

                        success: '#10B981',

                        background: '#F1F5F9', // Slate 100

                    }

                }

            }

        }

    </script>

</head>

<body class="text-slate-100 antialiased h-screen overflow-hidden flex">

    <!-- Animated Gradient Background -->

    <div class="animated-bg"></div>

    <!-- Grid Background -->

    <div class="grid-bg"></div>

    <!-- Glowing Orbs -->

    <div class="glow-orb orb-1"></div>

    <div class="glow-orb orb-2"></div>

    <div class="glow-orb orb-3"></div>

    <!-- Floating Particles -->

    <div id="particles"></div>

    <div id="root" class="w-full h-full relative z-10"></div>

    <script type="text/babel">

        const { useState, useEffect } = React;

        // API Configuration - Enhanced backend URL detection
        const getApiBase = () => {
            if (window.location.protocol === 'file:') return 'http://127.0.0.1:5001';
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                if (window.location.port !== '5001') return 'http://127.0.0.1:5001';
            }
            return '';
        };
        const API_BASE = getApiBase();

        // Global User Identity
        const CURRENT_USER = {
            name: "Âàõ‰ΩúËÄÖ",
            initials: "Âàõ",
            avatar: API_BASE + "/static/avatar1.png"
        };

        // Helper to generate stable random stats/author for agents
        const getStableStats = (id, name) => {
            let hash = 0;
            const str = String(id || 'default');
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const fans = Math.abs(hash % 13000) + 2000;
            const rating = (Math.abs(hash % 5) / 10 + 4.5).toFixed(1);

            // üåü ÁâπÊÆäÂÆòÊñπÊô∫ËÉΩ‰ΩìÈ´òÊ∏ÖÂ§¥ÂÉèÊò†Â∞Ñ
            const specialAvatars = {
                'AIÂàõ‰ΩúÂä©Êâã': 'static/official_novel.png',
                'AI Novel Assistant': 'static/official_novel.png',
                'ÁàÜÊ¨æÊ†áÈ¢òÁîüÊàêÂô®': 'static/official_headline.png',
                'AIÁøªËØëÂÆò': 'static/official_translator.png',
                'Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à': 'static/official_editor.png',
                'Editing Master': 'static/official_editor.png'
            };

            if (name && specialAvatars[name]) {
                return {
                    fans: (Math.abs(hash % 5000) + 12000),
                    rating: '4.9',
                    author: 'ÂÆòÊñπÂõ¢Èòü',
                    avatar: API_BASE + '/' + specialAvatars[name],
                    isSpecial: true
                };
            }

            const identities = [
                { name: 'Â≠§Áã¨Âàõ‰ΩúËÄÖ', avatar: 'static/avatar1.png' },
                { name: 'AIÊé¢Á¥¢ËÄÖ', avatar: 'static/avatar3.png' },
                { name: 'ÊûÅÂÆ¢Â∞èÂº†', avatar: 'static/avatar5.png' },
                { name: 'ÂÜÖÂÆπÊé®Êâã', avatar: 'static/avatar4.png' },
                { name: 'Êï∞ÊçÆÁåé‰∫∫', avatar: 'static/avatar2.png' },
                { name: 'ÂàõÊÑèÂ§ßÂ∏à', avatar: 'static/avatar7.png' },
                { name: 'ÊäÄÊúØÂÆÖÊùé', avatar: 'static/avatar6.png' },
                { name: 'ÂàÜÂèëËææ‰∫∫', avatar: 'static/avatar8.png' },
                { name: 'ÁàÜÊ¨æÊú∫Âô®', avatar: 'static/avatar9.png' },
                { name: 'ÈÄªËæëÈÄâÊâã', avatar: 'static/avatar10.png' },
                { name: 'ÂçàÂ§úËØó‰∫∫', avatar: 'static/avatar11.png' },
                { name: 'ÂÖÉÂÆáÂÆôÂ±ÖÊ∞ë', avatar: 'static/avatar12.png' },
                { name: 'Êï∞Â≠óÊ∏∏Ê∞ë', avatar: 'static/avatar2.png' },
                { name: 'ÊµÅÈáèËàµÊâã', avatar: 'static/avatar7.png' },
            ];
            const identity = identities[Math.abs(hash) % identities.length];
            const extraIcons = ['file-text', 'video', 'image', 'layers', 'cpu', 'compass', 'globe', 'feather', 'activity', 'award'];
            const icon = extraIcons[Math.abs(hash) % extraIcons.length];

            // Ensure avatar URL includes API_BASE
            const avatarUrl = identity.avatar.startsWith('http') ? identity.avatar : (API_BASE + '/' + identity.avatar);

            return { fans: fans, rating: rating, author: identity.name, icon: icon, avatar: avatarUrl, isSpecial: false };
        };

        // Create Floating Particles using vanilla JavaScript

        // Particle generation disabled
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Visual polish: removing glows');
        });


        // Icons Component Wrapper

        const Icon = ({

            name, size = 20, className = "" }) => {

            // Internal SVG definitions to avoid external dependencies

            const icons = {

                'twitter': <path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z" fill="currentColor" stroke="none" />,
                'x': <path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z" fill="currentColor" stroke="none" />,

                'facebook': <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />,

                'instagram': <g><rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" /></g>,

                'linkedin': <g><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z" /><rect x="2" y="9" width="4" height="12" /><circle cx="4" cy="4" r="2" /></g>,

                'youtube': <g><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z" fill="#FF0000" stroke="none" /><polygon points="9.545 15.568 15.818 12 9.545 8.432" fill="white" stroke="none" /></g>,
                'heart': <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />,
                'shopping-bag': <g><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></g>,
                'tiktok': (
                    <g stroke="none" transform="scale(0.9) translate(1, 1)">
                        <path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.9-.32-1.98-.23-2.81.33-.85.51-1.44 1.43-1.58 2.41-.03.52-.01 1.05.19 1.53.44 1.04 1.48 1.77 2.59 1.83 1.25.12 2.57-.49 3.09-1.63.12-.28.18-.57.21-.87.03-3.6.02-7.2.02-10.8z" fill="#FE2C55" transform="translate(1, 1)" />
                        <path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.9-.32-1.98-.23-2.81.33-.85.51-1.44 1.43-1.58 2.41-.03.52-.01 1.05.19 1.53.44 1.04 1.48 1.77 2.59 1.83 1.25.12 2.57-.49 3.09-1.63.12-.28.18-.57.21-.87.03-3.6.02-7.2.02-10.8z" fill="#25F4EE" transform="translate(-1, -1)" />
                        <path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.9-.32-1.98-.23-2.81.33-.85.51-1.44 1.43-1.58 2.41-.03.52-.01 1.05.19 1.53.44 1.04 1.48 1.77 2.59 1.83 1.25.12 2.57-.49 3.09-1.63.12-.28.18-.57.21-.87.03-3.6.02-7.2.02-10.8z" fill="white" />
                    </g>
                ),

                'video': <path d="M16 6.55v13.9a2.5 2.5 0 1 1-2.5-2.5h.5V2.55A5.5 5.5 0 0 1 19.5 8h-3a2.5 2.5 0 0 0-2.5-1.45z" />,

                'layout': <g><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><line x1="3" y1="9" x2="21" y2="9" /><line x1="9" y1="21" x2="9" y2="9" /></g>,

                'users': <g><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></g>,

                'send': <g><line x1="22" y1="2" x2="11" y2="13" /><polygon points="22 2 15 22 11 13 2 9 22 2" /></g>,

                'bar-chart': <g><line x1="18" y1="20" x2="18" y2="10" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="6" y1="20" x2="6" y2="14" /></g>,

                'settings': <g><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></g>,

                'plus': <g><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></g>,

                'bell': <g><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" /><path d="M13.73 21a2 2 0 0 1-3.46 0" /></g>,

                'check': <polyline points="20 6 9 17 4 12" />,

                'link': <g><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /> <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></g>, 'loader': <g><line x1="12" y1="2" x2="12" y2="6" /><line x1="12" y1="18" x2="12" y2="22" /><line x1="4.93" y1="4.93" x2="7.76" y2="7.76" /><line x1="16.24" y1="16.24" x2="19.07" y2="19.07" /><line x1="2" y1="12" x2="6" y2="12" /><line x1="18" y1="12" x2="22" y2="12" /><line x1="4.93" y1="19.07" x2="7.76" y2="16.24" /><line x1="16.24" y1="7.76" x2="19.07" y2="4.93" /></g>,

                'dollar-sign': <g><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></g>,

                'target': <g><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></g>,

                'trending-up': <g><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></g>,

                'activity': <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />,

                'qr-code': <g><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></g>,

                'file-text': <g><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></g>,

                'database': <g><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></g>,

                'trash': <g><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></g>,

                'calendar': <g><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></g>,

                'search': <g><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></g>,

                'help': <g><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></g>,

                'stars': <g><path d="M9 2L7.1 5.9 3 6.5 6 9.3 5.3 13.4 9 11.5 12.7 13.4 12 9.3 15 6.5 10.9 5.9 9 2z" /><path d="M19 11L17.1 14.9 13 15.5 16 18.3 15.3 22.4 19 20.5 22.7 22.4 22 18.3 25 15.5 20.9 14.9 19 11z" /></g>,

                'upload': <g><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></g>,

                'code': <g><polyline points="16 18 22 12 16 6" /><polyline points="8 6 2 12 8 18" /></g>,

                'chevron-right': <polyline points="9 18 15 12 9 6" />,

                'book': <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5Z" />,

                'globe': <g><circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" /><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" /></g>,

                'mic': <g><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" /><path d="M19 10v2a7 7 0 0 1-14 0v-2" /><line x1="12" y1="19" x2="12" y2="23" /><line x1="8" y1="23" x2="16" y2="23" /></g>,

                'music': <g><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></g>,

                'scissors': <g><circle cx="6" cy="6" r="3" /><circle cx="6" cy="18" r="3" /><line x1="20" y1="4" x2="8.12" y2="15.88" /><line x1="14.47" y1="14.48" x2="20" y2="20" /><line x1="8.12" y1="8.12" x2="12" y2="12" /></g>,

                'book-open': <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />,

                'zap': <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,

                'languages': <g><path d="m5 8 6 6" /><path d="m4 14 6-6 2-3" /><path d="M2 5h12" /><path d="M7 2h1" /><path d="m22 22-5-10-5 10" /><path d="M14 18h6" /></g>,

                'shield-alert': <g><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></g>,

                'git-branch': <g><line x1="6" y1="3" x2="6" y2="15" /><circle cx="18" cy="6" r="3" /><circle cx="6" cy="18" r="3" /><path d="M18 9a9 9 0 0 1-9 9" /></g>,

                'plus-circle': <g><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="16" /><line x1="8" y1="12" x2="16" y2="12" /></g>,

                'edit': <g><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></g>,

                'chevron-left': <polyline points="15 18 9 12 15 6" />,

                'rotate-ccw': <g><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></g>,

                'undo-2': <path d="M9 14 4 9l5-5" />,

                'redo-2': <path d="m15 14 5-5-5-5" />,

                'more-horizontal': <g><circle cx="12" cy="12" r="1" /><circle cx="19" cy="12" r="1" /><circle cx="5" cy="12" r="1" /></g>,

                'message-square': <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />,
                'edit-3': <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />,
                'filter': <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />,
                'award': <g><circle cx="12" cy="8" r="7" /><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88" /></g>,
                'play': <polygon points="5 3 19 12 5 21 5 3" />,
                'facebook': <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />,
                'alert-triangle': <g><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></g>,
                'platform-logo': (
                    <g fill="none" stroke="currentColor" strokeWidth="2.8" strokeLinecap="round" strokeLinejoin="round">
                        {/* Â∑¶‰æßÈïúÂÉè "j" ÂΩ¢Èí©Â≠êÔºàÂêëÂè≥ÊäòÔºâ */}
                        <path d="M4 2 L4 18 C4 21 6 22 9 22" />
                        {/* Âè≥‰æßÂÖ≠ËæπÂΩ¢‰∏âËæπÊ°ÜÊû∂ */}
                        <path d="M16 6 L21 10 L21 18 L16 22" />
                        {/* ‰∏≠ÂøÉÊí≠ÊîæÊåâÈíÆ - Â±Ö‰∏≠Ë∞ÉËäÇ */}
                        <path d="M11.5 11 L15.5 13 L11.5 15 Z" fill="currentColor" stroke="none" />
                    </g>
                ),
                'folder': <g><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" /></g>,
                'box': <g><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /></g>,
                'robot': <g><rect x="3" y="11" width="18" height="10" rx="2" /><circle cx="12" cy="2" r="1" /><path d="M12 3v8" /><circle cx="9" cy="16" r="1" /><circle cx="15" cy="16" r="1" /><path d="M3 16h.01M21 16h.01" /></g>,
                'cute-robot': (
                    <g fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        {/* Head */}
                        <rect x="4" y="8" width="16" height="12" rx="4" />
                        {/* Antenna */}
                        <path d="M12 2v6" />
                        <path d="M12 2h3" />
                        {/* Eyes */}
                        <line x1="9" y1="13" x2="9" y2="15" strokeWidth="3" />
                        <line x1="15" y1="13" x2="15" y2="15" strokeWidth="3" />
                        {/* Ears */}
                        <path d="M2 14h2" />
                        <path d="M20 14h2" />
                    </g>
                )
            };


            return (

                <svg

                    xmlns="http://www.w3.org/2000/svg"

                    width={size}

                    height={

                        size}

                    viewBox="0 0 24 24"

                    fill="none"

                    stroke="currentColor"

                    strokeWidth="2"

                    strokeLinecap="round"

                    strokeLinejoin="round"

                    className={

                        className}

                >

                    {icons[name] || <polygon points="5 3 19 12 5 21 5 3" />}

                </svg>

            );

        };



        // IntegrationCard Component - Platform Connect Button

        const IntegrationCard = ({ integration, onConnect, isConnecting }) => {

            const platformColors = {

                facebook: 'from-blue-600 to-blue-700',

                twitter: 'from-slate-800 to-slate-900',

                instagram: 'from-pink-600 to-purple-600',

                linkedin: 'from-blue-700 to-blue-800',

                youtube: 'from-red-600 to-red-700',

                tiktok: 'from-black to-gray-900'

            };

            const platformIcons = {

                facebook: 'facebook',

                twitter: 'twitter',

                instagram: 'instagram',

                linkedin: 'linkedin',

                youtube: 'youtube',

                tiktok: 'tiktok'

            };

            return (

                <div className="glass-card rounded-2xl p-6 text-center hover:scale-105 transition-all duration-300 group cursor-pointer"

                    onClick={isConnecting ? null : onConnect}>

                    <div className={`w-16 h-16 mx-auto mb-4 rounded-2xl bg-gradient-to-br ${platformColors[integration.id] || 'from-gray-600 to-gray-700'} flex items-center justify-center text-white shadow-lg transition-transform group-hover:scale-110`}>

                        <Icon name={platformIcons[integration.id] || 'link'} size={32} />

                    </div>

                    <h3 className="font-bold text-slate-900 mb-2">{integration.name}</h3>

                    <p className="text-sm text-slate-500 mb-4 min-h-[32px]">{integration.desc}</p>

                    <button

                        className={`w-full py-2 px-4 rounded-xl text-sm font-bold transition-all ${isConnecting

                            ? 'bg-slate-300 text-slate-600 cursor-not-allowed'

                            : 'bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white shadow-md hover:shadow-lg'

                            }`}

                        disabled={isConnecting}

                    >

                        {isConnecting ? 'ËøûÊé•‰∏≠...' : 'Á´ãÂç≥ËøûÊé•'}

                    </button>

                </div>

            );

        };

        // LoginModal Component - OAuth Authorization Modal

        const LoginModal = ({ platform, onClose, onAuthorize, isConnecting }) => {

            if (!platform) return null;

            return (

                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[100] p-4" onClick={onClose}>

                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8 relative" onClick={(e) => e.stopPropagation()}>

                        {/* Close Button */}

                        <button

                            onClick={

                                onClose}

                            className="absolute top-4 right-4 w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center text-slate-600 transition-all"

                        >

                            <Icon name="x" size={18} />

                        </button>

                        {/* Header */}

                        <div className="text-center mb-6">

                            <div className="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center text-white shadow-lg" >

                                <Icon name="link" size={40} />

                            </div>

                            <h2 className="text-2xl font-bold text-slate-900 mb-2">Connect {platform.name}</h2>

                            <p className="text-slate-500 text-sm">

                                You will be redirected to {platform.name} for authorization

                            </p>

                        </div>

                        {/* Description */}

                        <div className="bg-blue-50 border border-blue-100 rounded-2xl p-4 mb-6">

                            <p className="text-sm text-slate-700 leading-relaxed" >

                                <strong>Note:</strong> Please complete authentication in the new window. Allow popups if blocked.</p>

                        </div>

                        {/* Actions */}

                        <div className="flex gap-3">

                            <button

                                onClick={

                                    onClose}

                                className="flex-1 py-3 px-6 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-all"

                            >

                                Cancel

                            </button>

                            <button

                                onClick={onAuthorize}

                                disabled={isConnecting}

                                className={`flex-1 py-3 px-6 rounded-xl font-bold text-white transition-all ${isConnecting ? 'bg-slate-400 cursor-not-allowed'

                                    : 'bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 shadow-lg shadow-purple-500/30'}`}

                            >

                                {isConnecting ? 'Connecting...' : 'Start Auth'}

                            </button>

                        </div>

                    </div>

                </div>

            );

        };

        const Sidebar = ({ activeTab, setActiveTab }) => {

            const menuItems = [

                { id: 'my-agents', icon: 'robot', label: 'ÊàëÁöÑÊô∫ËÉΩÂõ¢Èòü' },

                { id: 'ai-lab', icon: 'box', label: 'Êô∫ËÉΩ‰ΩìÂπøÂú∫' },

                { id: 'accounts', icon: 'users', label: 'Ë¥¶Âè∑ËøûÊé•' },

                { id: 'posts', icon: 'upload', label: 'ÂèëÂ∏É‰∏≠ÂøÉ' },

                { id: 'schedule', icon: 'calendar', label: 'ÂÆöÊó∂ÂèëÂ∏É' },

                { id: 'history', icon: 'folder', label: 'ÂÜÖÂÆπ‰∏≠ÂøÉ' },

                { id: 'analytics', icon: 'bar-chart', label: 'Êï∞ÊçÆ‰∏≠ÂøÉ' },

                { id: 'settings', icon: 'settings', label: 'ËÆæÁΩÆ' },

            ];

            const createRipple = (e) => {

                const button = e.currentTarget;

                const ripple = document.createElement('span');

                const rect = button.getBoundingClientRect();

                const size = Math.max(rect.width, rect.height);

                const x = e.clientX - rect.left - size / 2;

                const y = e.clientY - rect.top - size / 2;

                ripple.style.width = ripple.style.height = `${size}px`;

                ripple.style.left = `${x}px`;

                ripple.style.top = `${y}px`;

                ripple.classList.add('ripple');

                button.appendChild(ripple);

                setTimeout(() => ripple.remove(), 600);

            };

            return (

                <div className="w-60 bg-[#0a0e27] bg-opacity-95 backdrop-blur-xl text-slate-300 flex flex-col h-full shrink-0 border-r border-purple-500/20 shadow-2xl shadow-purple-900/20 slide-in-left">

                    <div className="p-6 flex items-center gap-3 border-b border-purple-500/20">
                        <div className="p-1">
                            <img src="logo.png" alt="‰∏ÉÊòüÈì∂Ê≤≥" className="w-12 h-12 object-contain" />
                        </div>
                        <h1 className="text-white font-bold text-xl tracking-tight gradient-text whitespace-nowrap">‰∏ÉÊòüÈì∂Ê≤≥</h1>
                    </div>

                    <div className="px-4 mb-4">


                        <nav className="space-y-1">

                            {menuItems.map((item, index) => (

                                <button

                                    key={item.id}

                                    onClick={(e) => {

                                        createRipple(e);

                                        setActiveTab(item.id);

                                    }}

                                    style={{ animationDelay: `${index * 0.05}s` }}

                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-300 group ripple-container hover-lift btn-press slide-in-right ${activeTab === item.id ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg shadow-purple-500/50 scale-up'

                                        : 'hover:bg-purple-900/20 hover:text-purple-100 hover:shadow-lg hover:shadow-purple-500/10'}`}

                                >

                                    <Icon name={item.icon} size={20} className={`${activeTab === item.id ? "text-white" : "text-purple-400 group-hover:text-purple-200"} transition-all duration-300`} />

                                    <span className="font-medium text-base">{item.label}</span>

                                    {activeTab === item.id && (

                                        <div className="ml-auto w-2 h-2 bg-white rounded-full pulse-animation glow-effect"></div>

                                    )}

                                </button>

                            ))}

                        </nav>

                    </div>

                    <div className="mt-auto p-4 border-t border-slate-800/50 fade-in">

                        <div className="bg-slate-800/30 rounded-2xl p-4 border border-white/5 hover-lift">

                            <h3 className="text-white text-xs font-semibold mb-1">‰∏ì‰∏öÁâà (Pro)</h3>

                            <p className="text-[10px] text-slate-500 mb-3 font-medium text-opacity-80 leading-relaxed uppercase tracking-wider">Â∑≤ËøûÊé• 8/10 ‰∏™Ë¥¶Âè∑</p>

                            <div className="w-full bg-slate-700/50 h-1.5 rounded-full overflow-hidden mb-1">

                                <div className="bg-secondary w-[80%] h-full rounded-full shadow-[0_0_8px_rgba(59,130,246,0.5)] progress-glow"></div>

                            </div>

                        </div>

                        <button className="w-full flex items-center gap-3 px-4 py-3 mt-4 text-slate-500 hover:text-red-400 transition-all duration-300 text-sm font-medium ripple-container hover-lift btn-press rounded-xl hover:bg-slate-800/30">

                            <Icon name="plus" className="rotate-45 transition-transform duration-300" size={18} />

                            <span>ÈÄÄÂá∫ÁôªÂΩï</span>

                        </button>

                    </div>

                </div>

            );

        };

        const AnalyticsView = ({ showStatus }) => {
            const [data, setData] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [syncing, setSyncing] = React.useState(false);
            const [activePost, setActivePost] = React.useState(null);

            const fetchAnalytics = async (sync = false) => {
                if (sync) setSyncing(true);
                else setLoading(true);
                try {
                    if (sync) {
                        await fetch(`${API_BASE}/api/history?sync=true`);
                    }
                    const res = await fetch(`${API_BASE}/api/analytics`);
                    const result = await res.json();
                    setData(result);
                } catch (error) {
                    console.error('Fetch analytics error:', error);
                } finally {
                    setLoading(false);
                    setSyncing(false);
                }
            };

            React.useEffect(() => {
                fetchAnalytics();
            }, []);

            if (loading) {
                return (
                    <div className="flex flex-col items-center justify-center py-40 gap-4">
                        <div className="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                        <p className="text-sm font-bold text-slate-400 uppercase tracking-widest animate-pulse">Ê≠£Âú®ÁîüÊàêËµÑ‰∫ßÂàÜÊûêÊä•Âëä...</p>
                    </div>
                );
            }

            if (!data) return null;

            return (
                <div className="max-w-6xl mx-auto py-6 px-5 space-y-6 animate-in fade-in slide-in-from-bottom-5 duration-700">
                    <div className="flex items-center justify-between mb-8">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <span className="px-3 py-1 rounded-full bg-blue-500/10 text-blue-400 text-xs font-black uppercase tracking-wider border border-blue-500/20">
                                    LIVE ÂÖ®ÈìæË∑ØÂÆûÊó∂ÁõëÊéß
                                </span>
                            </div>
                            <h2 className="text-5xl font-black text-white tracking-tighter mb-2">Â∑•‰ΩúÂè∞</h2>
                            <p className="text-white/40 font-medium text-base">ÂÖ®Ê∏†ÈÅìËøΩË∏™Ôºö‰ªéÊµÅÈáèËß¶ËææÂà∞ÊúÄÁªàËΩ¨ÂåñÊïàÁéáÔºåÁ≤æÂáÜÂà§ÂÆöÊØè‰∏Ä‰∏™ÂàõÊÑèÁöÑÂïÜ‰∏ö‰ª∑ÂÄº„ÄÇ</p>
                        </div>
                        <div className="flex items-center gap-4">
                            <button
                                onClick={() => fetchAnalytics(true)}
                                disabled={syncing}
                                className={`flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl text-sm font-black transition-all shadow-lg shadow-blue-500/20 ${syncing ? 'opacity-50' : ''}`}
                            >
                                <Icon name="refresh-cw" size={14} className={syncing ? 'animate-spin' : ''} />
                                {syncing ? 'ÂêåÊ≠•‰∏≠...' : 'ÂêåÊ≠•Êï∞ÊçÆ'}
                            </button>
                            <div className="flex bg-white/5 p-1 rounded-2xl border border-white/10 backdrop-blur-md">
                                <button className="px-4 py-2 rounded-xl text-xs font-black text-white/60 hover:text-white hover:bg-white/5 transition-all flex items-center gap-2">
                                    ÂÖ®ÈÉ®Âπ≥Âè∞ <Icon name="chevron-down" size={10} />
                                </button>
                                <div className="w-px bg-white/10 my-2"></div>
                                <button className="px-4 py-2 rounded-xl text-xs font-black text-white/60 hover:text-white hover:bg-white/5 transition-all flex items-center gap-2">
                                    Ëøë7Â§© <Icon name="chevron-down" size={10} />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div className="lg:col-span-2 glass-card rounded-[32px] p-8 relative overflow-hidden flex flex-col min-h-[500px] border border-blue-500/20 shadow-2xl bg-slate-950/50">
                            <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-600/5 rounded-full blur-[120px] -mr-40 -mt-40 pointer-events-none"></div>
                            <div className="absolute bottom-0 left-0 w-[400px] h-[400px] bg-purple-600/5 rounded-full blur-[100px] -ml-20 -mb-20 pointer-events-none"></div>
                            <div className="relative z-10 w-full h-full flex flex-col">
                                <div className="flex items-center gap-3 mb-12">
                                    <div className="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400">
                                        <Icon name="activity" size={24} />
                                    </div>
                                    <h3 className="text-2xl font-black text-white tracking-tight">ËΩ¨ÂåñÊºèÊñó</h3>
                                </div>
                                <div className="flex-1 flex flex-col items-center justify-center -space-y-1 max-w-3xl mx-auto w-full">
                                    <div className="w-full relative group transition-all duration-500 hover:z-50"
                                        style={{ clipPath: 'polygon(0% 0%, 100% 0%, 92% 100%, 8% 100%)' }}>
                                        <div className="h-40 bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 flex flex-col items-center justify-center text-white relative transition-transform duration-500 group-hover:scale-[1.01]">
                                            <div className="absolute top-6 flex flex-col items-center">
                                                <span className="text-base font-black uppercase tracking-[0.2em] opacity-95 mb-1">Êí≠ÊîæÈáè</span>
                                                <div className="w-8 h-0.5 bg-white/30 rounded-full"></div>
                                            </div>
                                            <span className="text-4xl font-black tracking-tighter mt-4 drop-shadow-2xl">
                                                {data.funnel.views.toLocaleString()}
                                            </span>
                                        </div>
                                    </div>
                                    <div className="w-full relative group transition-all duration-500 hover:z-50"
                                        style={{ clipPath: 'polygon(8% 0%, 92% 0%, 82% 100%, 18% 100%)' }}>
                                        <div className="h-48 bg-gradient-to-br from-indigo-500 via-indigo-600 to-purple-700 flex flex-col items-center justify-center text-white relative transition-transform duration-500 group-hover:scale-[1.01]">
                                            <div className="absolute top-6 flex flex-col items-center">
                                                <span className="text-base font-black uppercase tracking-[0.2em] opacity-95 mb-1">ÁÇπÂáªÈáè</span>
                                                <div className="w-8 h-0.5 bg-white/30 rounded-full"></div>
                                            </div>
                                            <span className="text-3xl font-black tracking-tighter mt-6 drop-shadow-2xl">
                                                {data.funnel.engagement.toLocaleString()}
                                            </span>
                                            <span className="text-xs font-bold opacity-80 mt-5 uppercase tracking-wider">
                                                ËΩ¨ÂåñÁéá {data.funnel.engagement_rate}%
                                            </span>
                                        </div>
                                    </div>
                                    <div className="w-full relative group transition-all duration-500 hover:z-50"
                                        style={{ clipPath: 'polygon(18% 0%, 82% 0%, 75% 100%, 25% 100%)' }}>
                                        <div className="h-44 bg-gradient-to-br from-emerald-400 via-emerald-500 to-teal-600 flex flex-col items-center justify-center text-white relative transition-transform duration-500 group-hover:scale-[1.01]">
                                            <div className="absolute top-6 flex flex-col items-center">
                                                <span className="text-base font-black uppercase tracking-[0.2em] opacity-95 mb-1">ËΩ¨ÂåñÈáëÈ¢ù</span>
                                                <div className="w-8 h-0.5 bg-white/30 rounded-full"></div>
                                            </div>
                                            <div className="flex items-baseline gap-2 mt-4">
                                                <span className="text-xl font-black opacity-60">¬•</span>
                                                <span className="text-3xl font-black tracking-tighter drop-shadow-2xl">
                                                    {data.funnel.gmv.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="flex flex-col gap-6">
                            {[
                                { label: 'ÁÇπÂáªÁéá', value: `${data.funnel.engagement_rate}%`, icon: 'target', color: 'indigo', sub: 'ÁÇπÂáª/Ëß¶ËææÊØî‰æã' },
                                { label: 'ÊÄªÊî∂Áõä', value: `¬•${data.funnel.gmv.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })}`, icon: 'dollar-sign', color: 'emerald', sub: 'ÂçïÊ¨°ÁÇπÂáªÂùáÊî∂', dark: true },
                                { label: 'Â∏ñÂ≠êÊï∞Èáè', value: `${data.posts.length}`, icon: 'zap', color: 'orange', sub: 'Â∑≤ËøΩË∏™ÂÜÖÂÆπÊï∞' }
                            ].map((card, i) => (
                                <div key={i} className={`${card.dark ? 'bg-white/5 border-white/10 shadow-2xl' : 'bg-white/5 border-white/10'} rounded-[32px] p-8 border hover:bg-white/[0.08] transition-all duration-300 group relative overflow-hidden backdrop-blur-sm`}>
                                    <div className={`absolute top-0 right-0 w-32 h-32 bg-${card.color}-500/10 rounded-full blur-[40px] -mr-10 -mt-10`}></div>
                                    <div className="relative z-10">
                                        <div className={`w-12 h-12 rounded-2xl bg-${card.color}-500/20 text-${card.color}-400 flex items-center justify-center mb-6 group-hover:scale-110 transition-transform shadow-inner`}>
                                            <Icon name={card.icon} size={24} />
                                        </div>
                                        <p className="text-white/80 text-lg font-black uppercase tracking-widest mb-2">{card.label}</p>
                                        <h3 className="text-4xl font-black text-white tracking-tighter mb-3 animate-in slide-in-from-bottom-2">{card.value}</h3>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-white/5 rounded-[40px] border border-white/10 shadow-2xl overflow-hidden mt-8 backdrop-blur-sm">
                        <div className="p-8 border-b border-white/5 flex items-center justify-between bg-white/5">
                            <div>
                                <h3 className="text-lg font-black text-white flex items-center gap-3">
                                    <div className="w-2 h-6 bg-blue-50 rounded-full"></div>
                                    ËµÑ‰∫ßË°®Áé∞
                                </h3>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="px-4 py-2 bg-white/10 text-white/70 text-xs font-black rounded-xl uppercase tracking-widest flex items-center gap-2 border border-white/20">
                                    <Icon name="bar-chart" size={12} /> ÊéíÂ∫èÔºöÊÄªÊí≠ÊîæÈáè
                                </span>
                            </div>
                        </div>

                        <div className="overflow-x-auto">
                            <table className="w-full text-left">
                                <thead className="bg-[#0f172a] text-[13px] uppercase font-black text-white/70 tracking-[0.3em] border-b border-white/10">
                                    <tr>
                                        <th className="p-8 pl-10 text-white/80">ËµÑ‰∫ßÂÜÖÂÆπ</th>
                                        <th className="p-8 text-white/80">ÂèëÂ∏ÉÊ∏†ÈÅì</th>
                                        <th className="p-8 text-center text-white/80">Êí≠ÊîæÈáè</th>
                                        <th className="p-8 text-center text-white/80">‰∫íÂä®Êï∞ÊçÆ</th>
                                        <th className="p-8 text-right pr-10 text-white/80">È¢Ñ‰º∞Êî∂Áõä (CNY)</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-white/5">
                                    {data.posts.map((post, idx) => (
                                        <tr key={idx} className="hover:bg-white/[0.04] transition-all group">
                                            <td className="p-8 pl-10">
                                                <div className="flex items-center gap-6">
                                                    <div className="w-20 h-28 rounded-2xl bg-slate-800 overflow-hidden shadow-2xl shrink-0 group-hover:scale-105 transition-transform duration-500 border border-white/5 relative">
                                                        {post.thumbnail ? (
                                                            post.thumbnail.match(/\.(mp4|mov|avi|webm|m4v)(\?|$)/i) ? (
                                                                <video
                                                                    src={post.thumbnail + "#t=0.1"}
                                                                    className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"
                                                                    preload="metadata"
                                                                    muted
                                                                    onError={(e) => {
                                                                        e.target.style.display = 'none';
                                                                        if (e.target.nextElementSibling) {
                                                                            e.target.nextElementSibling.style.display = 'flex';
                                                                        }
                                                                    }}
                                                                />
                                                            ) : (
                                                                <img
                                                                    src={post.thumbnail}
                                                                    className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"
                                                                    onError={(e) => {
                                                                        const h = Math.abs(post.id.split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0));
                                                                        const fallbacks = [
                                                                            "cover1.png",
                                                                            "cover2.png",
                                                                            "cover3.png",
                                                                            "cover4.png",
                                                                            "cover5.png",
                                                                            "cover11.png",
                                                                            "cover7.png",
                                                                            "cover8.png",
                                                                            "cover9.png"
                                                                        ];
                                                                        e.target.src = fallbacks[h % fallbacks.length];
                                                                        e.target.onerror = null;
                                                                    }}
                                                                />
                                                            )
                                                        ) : (
                                                            <div className="w-full h-full flex items-center justify-center text-slate-600">
                                                                <span className="text-xs">No Cover</span>
                                                            </div>
                                                        )}
                                                        <div className="hidden w-full h-full flex-col items-center justify-center text-slate-400 bg-slate-800">
                                                            <svg className="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                                                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" />
                                                            </svg>
                                                        </div>
                                                        <div className="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/80 to-transparent"></div>
                                                    </div>
                                                    <div className="space-y-3">
                                                        <div>
                                                            <p className="text-base font-black text-white truncate max-w-[240px] mb-1 group-hover:text-blue-400 transition-colors">{post.title}</p>
                                                            <p className="text-sm text-white/40 font-bold tracking-wider uppercase">ID: POST-{post.id.toString().slice(-4)} | {new Date(post.date).toLocaleDateString()}</p>
                                                        </div>
                                                        <div className="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-all transform translate-y-2 group-hover:translate-y-0">
                                                            <button
                                                                onClick={() => setActivePost(post)}
                                                                className="px-3 py-1.5 bg-blue-500/10 hover:bg-blue-500 text-blue-400 hover:text-white text-[10px] font-black rounded-lg transition-all border border-blue-500/20"
                                                            >
                                                                ÂàÜÊûê
                                                            </button>
                                                            {post.url && (
                                                                <a
                                                                    href={post.url}
                                                                    target="_blank"
                                                                    className="px-3 py-1.5 bg-white/5 hover:bg-white/10 text-white/40 hover:text-white text-[10px] font-black rounded-lg transition-all border border-white/10 flex items-center gap-1"
                                                                >
                                                                    ÂéüÂ∏ñÈìæÊé• <Icon name="external-link" size={10} />
                                                                </a>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="p-8">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-[10px] shadow-sm border border-blue-100 overflow-hidden">
                                                        {post.avatar ? <img src={post.avatar} className="w-full h-full object-cover" /> : CURRENT_USER.initials}
                                                    </div>
                                                    <div>
                                                        <p className="text-sm font-black text-white/80">{post.account}</p>
                                                        <p className="text-xs font-bold text-white/40 uppercase tracking-wider">{post.platform}</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="p-8 text-center bg-white/[0.02]">
                                                <span className="text-3xl font-black text-white tracking-tighter">{post.views.toLocaleString()}</span>
                                                <p className={`text-xs font-bold mt-2 uppercase tracking-widest ${post.views > 50000 ? 'text-red-400' : post.views > 10000 ? 'text-orange-400' : 'text-emerald-400'}`}>
                                                    {post.views > 50000 ? 'ÁàÜÊ¨æ' : post.views > 10000 ? 'ÊΩúÂäõ' : 'Âπ≥Á®≥'}
                                                </p>
                                            </td>
                                            <td className="p-8 text-center">
                                                <div className="flex flex-col items-center">
                                                    <span className="text-3xl font-black text-white tracking-tighter">{post.engagement.toLocaleString()}</span>
                                                    <div className="flex items-center gap-1.5 mt-2">
                                                        <div className={`w-1.5 h-1.5 rounded-full ${post.engagement / post.views > 0.08 ? 'bg-purple-500' : 'bg-blue-500'}`}></div>
                                                        <span className="text-xs text-white/30 font-bold uppercase tracking-widest">
                                                            {post.engagement / post.views > 0.08 ? 'È´ò‰∫íÂä®' : 'Ê¥ªË∑É'}
                                                        </span>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="p-8 text-right pr-10">
                                                <div className="flex flex-col items-end">
                                                    <div className="flex items-baseline gap-1.5">
                                                        <span className="text-[10px] font-black text-emerald-500/50">¬•</span>
                                                        <span className="text-3xl font-black text-emerald-400 tracking-tighter font-mono">
                                                            {Math.floor(post.gmv || 0).toLocaleString()}
                                                        </span>
                                                    </div>
                                                    <p className="text-xs text-white/20 font-bold uppercase tracking-wider mt-1">È¢Ñ‰º∞ÊÄªÊî∂Áõä</p>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {activePost && (
                        <DataDetailModal post={activePost} onClose={() => setActivePost(null)} />
                    )}
                </div>
            );
        };

        const ConnectedCard = ({ account, onDisconnect }) => (

            <div className="glass-card rounded-2xl p-5 flex items-start justify-between group bounce-in tilt-hover">

                <div className="flex gap-4">

                    <div className="w-12 h-12 rounded-full overflow-hidden bg-slate-100 ring-2 ring-white shadow-md hover:scale-110 transition-transform duration-300">

                        <img src={account.avatar} alt={account.name} className="w-full h-full object-cover" />

                    </div>

                    <div>

                        <div className="flex items-center gap-2 mb-1">

                            <h3 className="font-bold text-slate-900">{account.platform || account.type || 'Social Account'}</h3>

                            <span className="bg-green-100 text-green-700 text-xs px-2 py-0.5 rounded-full font-medium flex items-center gap-1 pulse-animation">

                                <span className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse glow-effect"></span>

                                {account.status === 'active' ? 'Ê¥ªË∑É' : 'Â∑≤ËøûÊé•'}

                            </span>

                        </div>

                        <p className="text-sm font-medium text-slate-800">{account.handle || account.name || 'User'}</p>

                        <p className="text-xs text-slate-500 mt-0.5">ÂàöÂàöÂêåÊ≠•</p>

                    </div>

                </div>

                <button

                    onClick={() => onDisconnect(account.id)}

                    className="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all duration-300 opacity-0 group-hover:opacity-100 hover:scale-110 btn-press"

                >

                    <Icon name="trash" size={18} />

                </button>

            </div>

        );

        const CommentPanel = ({ post, onClose }) => {

            const [comments, setComments] = useState([]);

            const [loading, setLoading] = useState(true);

            const [replyContent, setReplyContent] = useState('');

            const [isSubmitting, setIsSubmitting] = useState(false);

            useEffect(() => {

                if (post) fetchComments();

            }, [post]);

            const fetchComments = async () => {

                setLoading(true);

                try {

                    const res = await fetch(`${API_BASE}/api/posts/${post.id}/comments`);

                    const data = await res.json();

                    setComments(Array.isArray(data) ? data : []);

                } catch (error) {

                    console.error('Fetch comments error:', error);

                } finally {

                    setLoading(false);

                }

            };

            const handleSendReply = async () => {

                if (!replyContent.trim()) return;

                setIsSubmitting(true);

                try {

                    const res = await fetch(`${API_BASE}/api/posts/${post.id}/comments`, {

                        method: 'POST',

                        headers: {

                            'Content-Type': 'application/json'

                        },

                        body: JSON.stringify({

                            content: replyContent,

                            accountId: post.accounts[0].id // Default to first account for reply

                        })

                    });

                    const result = await res.json();

                    if (result.success) {

                        setComments([...comments, result.comment]);

                        setReplyContent('');

                    } else {

                        alert('Reply failed: ' + result.error);

                    }

                } catch (error) {

                    alert('Network error');

                } finally {

                    setIsSubmitting(false);

                }

            };

            return (

                <div className="fixed inset-y-0 right-0 w-[450px] bg-white shadow-2xl z-[60] border-l border-slate-100 flex flex-col animate-in slide-in-from-right duration-500">

                    <div className="p-8 border-b border-slate-50 flex items-center justify-between bg-slate-50/50">

                        <div>

                            <h3 className="text-xl font-bold text-slate-900">‰∫íÂä®‰∏≠ÂøÉ</h3>

                            <p className="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">ÁÆ°ÁêÜËØ•ÂÜÖÂÆπÁöÑÂπ≥Âè∞‰∫íÂä®ÊÉÖÂÜµ</p>

                        </div>

                        <button onClick={onClose} className="w-10 h-10 bg-white rounded-xl shadow-sm border border-slate-100 flex items-center justify-center text-slate-400 hover:text-slate-900 transition-all">

                            <Icon name="plus" className="rotate-45" size={24} />

                        </button>

                    </div>

                    <div className="flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar bg-slate-50/30">

                        {loading ? (

                            <div className="flex flex-col items-center justify-center py-20 gap-4">

                                <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>

                                <p className="text-sm font-bold text-slate-400 uppercase tracking-widest">Ê≠£Âú®ÂêåÊ≠•‰∫íÂä®Êï∞ÊçÆ...</p>

                            </div>

                        ) : comments.length === 0 ? (

                            <div className="flex flex-col items-center justify-center py-20 text-center">

                                <div className="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center text-slate-300 mb-4">

                                    <Icon name="message-square" size={32} />

                                </div>

                                <p className="text-sm font-bold text-slate-500">ÊöÇÊó†ËØÑËÆ∫</p>

                                <p className="text-xs text-slate-400 mt-1 uppercase tracking-widest">Êñ∞ÁöÑ‰∫íÂä®Â∞ÜÂá∫Áé∞Âú®ËøôÈáå</p>

                            </div>

                        ) : (

                            comments.map((comment, idx) => (

                                <div key={idx} className={`flex gap-4 animate-in fade-in slide-in-from-bottom-2 duration-300 ${comment.is_reply ? 'ml-8' : ''}`}>

                                    <div className="w-10 h-10 rounded-xl overflow-hidden bg-slate-100 shrink-0 border border-white shadow-sm">

                                        <img src={comment.author_avatar} className="w-full h-full object-cover" />

                                    </div>

                                    <div className="flex-1 bg-white p-5 rounded-3xl rounded-tl-none border border-slate-100 shadow-sm relative group/comment">

                                        <div className="flex items-center justify-between mb-2">

                                            <span className="font-black text-slate-900 text-sm">{comment.author_name}</span>

                                            <span className="text-[11px] font-bold text-slate-400 uppercase tracking-widest">

                                                {comment.created_at && comment.created_at.includes(' ') ? comment.created_at.split(' ')[1] : (comment.created_at || 'Just now')}

                                            </span>

                                        </div>

                                        <p className="text-slate-600 text-sm leading-relaxed font-medium">{comment.content}</p>

                                        {!comment.is_reply && (

                                            <button className="mt-4 text-[10px] font-black text-blue-600 uppercase tracking-widest opacity-0 group-hover/comment:opacity-100 transition-opacity">ÂõûÂ§ç</button>

                                        )}

                                        {comment.is_reply && (

                                            <div className="absolute -left-6 top-5 w-6 h-[2px] bg-slate-200"></div>

                                        )}

                                    </div>

                                </div>

                            ))

                        )}

                    </div>

                    <div className="p-8 border-t border-slate-100 bg-white">

                        <div className="relative">

                            <textarea

                                value={replyContent}

                                onChange={(e) => setReplyContent(e.target.value)}

                                placeholder="ËæìÂÖ•ÂõûÂ§çÂÜÖÂÆπ..."

                                className="w-full h-32 p-5 bg-slate-50 rounded-3xl border border-slate-100 text-sm font-medium focus:ring-2 focus:ring-blue-500/10 focus:border-blue-400 transition-all outline-none resize-none placeholder:text-slate-400"

                            ></textarea>

                            <button

                                onClick={handleSendReply}

                                disabled={isSubmitting || !replyContent.trim()}

                                className={`absolute bottom-4 right-4 px-6 py-2.5 rounded-xl font-black text-xs uppercase tracking-widest transition-all ${replyContent.trim() ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30 hover:scale-105 active:scale-95' : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}

                            >

                                {isSubmitting ? 'ÂèëÈÄÅ‰∏≠...' : 'ÂèëÈÄÅÂõûÂ§ç'}

                            </button>

                        </div>

                        <p className="text-[11px] text-slate-400 font-bold text-center mt-4 uppercase tracking-[0.2em]">ÂõûÂ§çÂ∞ÜÂêåÊ≠•Ëá≥ {post.accounts.map(a => a.type).join(' & ')}</p>

                    </div>

                </div>

            );

        };

        const AgentWorkbenchModal = ({ agent, tasks, onClose }) => {
            // Mock Data Generator based on Agent Type
            const getWorkbenchData = () => {
                // SPECIAL CASE: Meteor Shower Agent uses Custom Grid View (handled in DEFAULT block)
                if (agent.name === 'ÊµÅÊòüÈõ®ÂèëÂ∏ÉËææ‰∫∫') {
                    return { type: 'DEFAULT', tasks: tasks };
                }

                if (agent.name.includes('Ââ™Ëæë') || agent.name.includes('ÂèëÂ∏É') || (agent.tags && agent.tags.includes('Video'))) {
                    return {
                        type: 'DISTRIBUTION',
                        items: [
                            { id: 1, title: '„ÄäÈú∏ÈÅìÊÄªË£ÅÁà±‰∏äÊàë„Äã Ep.1 - ÈÄÜË¢≠ÂΩíÊù•', thumbnail: 'https://images.unsplash.com/photo-1593784991095-a205069470b6?w=200&h=280&fit=crop', platforms: { tiktok: 'done', youtube: 'done', fb: 'processing' } },
                            { id: 2, title: '„ÄäÈú∏ÈÅìÊÄªË£ÅÁà±‰∏äÊàë„Äã Ep.2 - Ë±™Èó®ÊÅ©ÊÄ®', thumbnail: 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=200&h=280&fit=crop', platforms: { tiktok: 'done', youtube: 'processing', fb: 'pending' } },
                            { id: 3, title: '„ÄäÈú∏ÈÅìÊÄªË£ÅÁà±‰∏äÊàë„Äã Ep.3 - ÁúüÁõ∏Â§ßÁôΩ', thumbnail: 'https://images.unsplash.com/photo-1516280440614-6697288d5d38?w=200&h=280&fit=crop', platforms: { tiktok: 'processing', youtube: 'pending', fb: 'pending' } },
                            { id: 4, title: '„ÄäÈú∏ÈÅìÊÄªË£ÅÁà±‰∏äÊàë„Äã Ep.4 - sweet love', thumbnail: 'https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?w=200&h=280&fit=crop', platforms: { tiktok: 'pending', youtube: 'pending', fb: 'pending' } },
                        ]
                    };
                } else if (agent.name.includes('ÂéªÈáç') || agent.name.includes('Â§ÑÁêÜ')) {
                    return {
                        type: 'PROGRESS',
                        items: [
                            { id: 1, name: 'raw_video_source_001.mp4', progress: 100, status: 'Completed' },
                            { id: 2, name: 'raw_video_source_002.mp4', progress: 78, status: 'Processing' },
                            { id: 3, name: 'raw_video_source_003.mp4', progress: 45, status: 'Processing' },
                            { id: 4, name: 'raw_video_source_004.mp4', progress: 12, status: 'Queued' },
                            { id: 5, name: 'raw_video_source_005.mp4', progress: 0, status: 'Queued' },
                        ]
                    };
                }
                return { type: 'DEFAULT', tasks: tasks };
            };

            const data = getWorkbenchData();

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-end" onClick={onClose}>
                    <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm"></div>
                    <div className="relative h-full w-full max-w-lg bg-slate-900 border-l border-white/10 shadow-2xl p-0 flex flex-col font-sans slide-in-right" onClick={e => e.stopPropagation()}>

                        {/* Header */}
                        <div className="p-6 border-b border-white/10 bg-slate-900/50 backdrop-blur-xl z-10 flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center text-white shadow-lg border border-white/10">
                                    <Icon name={agent.icon || 'activity'} size={24} />
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-white tracking-tight">{agent.name}</h3>
                                    <div className="flex items-center gap-2 mt-1">
                                        <span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                                        <span className="text-xs font-bold text-emerald-400 uppercase tracking-wider">ÂÆûÊó∂Â∑•‰ΩúÂè∞</span>
                                    </div>
                                </div>
                            </div>
                            <button onClick={onClose} className="p-2 text-white/40 hover:text-white bg-white/5 hover:bg-white/10 rounded-full transition-colors">
                                <Icon name="x" size={20} />
                            </button>
                        </div>

                        {/* Content */}
                        <div className="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">

                            {/* Scenario A: Distribution */}
                            {data.type === 'DISTRIBUTION' && (
                                <div className="space-y-6">
                                    <div className="flex items-center justify-between">
                                        <h4 className="text-sm font-bold text-slate-400 uppercase tracking-widest">ÂΩìÂâç‰ªªÂä°ÈòüÂàó</h4>
                                        <span className="px-2 py-0.5 rounded-lg bg-blue-500/20 text-blue-300 text-xs font-bold">4 ‰∏™ËøõË°å‰∏≠</span>
                                    </div>
                                    <div className="space-y-3">
                                        {data.items.map(item => (
                                            <div key={item.id} className="bg-white/5 border border-white/5 rounded-2xl p-3 flex gap-4 hover:bg-white/10 transition-colors group">
                                                <div className="w-20 h-28 bg-slate-800 rounded-lg overflow-hidden shrink-0 relative">
                                                    <img src={item.thumbnail} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                                                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                                                    <Icon name="play" size={16} className="absolute bottom-2 left-2 text-white/90" />
                                                </div>
                                                <div className="flex-1 py-1 flex flex-col justify-between">
                                                    <h5 className="text-white font-bold text-sm leading-tight line-clamp-2">{item.title}</h5>

                                                    {/* Platforms */}
                                                    <div className="flex items-center gap-4 mt-2">
                                                        {/* TikTok */}
                                                        <a href="https://www.tiktok.com" target="_blank" className={`flex items-center gap-1.5 transition-opacity ${item.platforms.tiktok === 'pending' ? 'opacity-30' : 'opacity-100'}`} onClick={e => e.stopPropagation()}>
                                                            <div className="w-6 h-6 rounded-full bg-black border border-white/20 flex items-center justify-center">
                                                                <span className="font-bold text-[8px] text-white">T</span>
                                                            </div>
                                                            {item.platforms.tiktok === 'processing' && <Icon name="loader" size={12} className="text-blue-400 animate-spin" />}
                                                            {item.platforms.tiktok === 'done' && <Icon name="check" size={12} className="text-emerald-400" />}
                                                        </a>
                                                        {/* YouTube */}
                                                        <div className={`flex items-center gap-1.5 transition-opacity ${item.platforms.youtube === 'pending' ? 'opacity-30' : 'opacity-100'}`}>
                                                            <div className="w-6 h-6 rounded-full bg-red-600 border border-white/20 flex items-center justify-center">
                                                                <Icon name="play" size={8} className="text-white fill-white" />
                                                            </div>
                                                            {item.platforms.youtube === 'processing' && <Icon name="loader" size={12} className="text-blue-400 animate-spin" />}
                                                            {item.platforms.youtube === 'done' && <Icon name="check" size={12} className="text-emerald-400" />}
                                                        </div>
                                                        {/* FB */}
                                                        <div className={`flex items-center gap-1.5 transition-opacity ${item.platforms.fb === 'pending' ? 'opacity-30' : 'opacity-100'}`}>
                                                            <div className="w-6 h-6 rounded-full bg-blue-600 border border-white/20 flex items-center justify-center">
                                                                <span className="font-bold text-[8px] text-white">f</span>
                                                            </div>
                                                            {item.platforms.fb === 'processing' && <Icon name="loader" size={12} className="text-blue-400 animate-spin" />}
                                                            {item.platforms.fb === 'done' && <Icon name="check" size={12} className="text-emerald-400" />}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Scenario B: Progress */}
                            {data.type === 'PROGRESS' && (
                                <div className="space-y-6">
                                    <div className="flex items-center justify-between">
                                        <h4 className="text-sm font-bold text-slate-400 uppercase tracking-widest">Â§ÑÁêÜËøõÂ∫¶</h4>
                                        <span className="px-2 py-0.5 rounded-lg bg-purple-500/20 text-purple-300 text-xs font-bold">5 ‰∏™‰ªªÂä°</span>
                                    </div>
                                    <div className="space-y-4">
                                        {data.items.map(item => (
                                            <div key={item.id} className="bg-white/5 border border-white/5 rounded-2xl p-4 space-y-3">
                                                <div className="flex items-center justify-between text-xs">
                                                    <span className="font-mono text-slate-300 truncate max-w-[200px]">{item.name}</span>
                                                    <span className={`font-bold ${item.progress === 100 ? 'text-emerald-400' : 'text-blue-400'}`}>{item.progress}%</span>
                                                </div>
                                                <div className="h-1.5 w-full bg-white/10 rounded-full overflow-hidden">
                                                    <div className={`h-full rounded-full transition-all duration-1000 ${item.progress === 100 ? 'bg-emerald-500' :
                                                        item.progress === 0 ? 'bg-slate-600' :
                                                            'bg-gradient-to-r from-blue-500 to-purple-500 relative overflow-hidden'
                                                        }`} style={{ width: `${item.progress}%` }}>
                                                        {/* Shimmer effect for active bars */}
                                                        {item.progress > 0 && item.progress < 100 && (
                                                            <div className="absolute inset-0 bg-white/30 skew-x-12 animate-[shimmer_1s_infinite]"></div>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-[10px] text-slate-500 uppercase font-bold tracking-wider">{item.status}</span>
                                                    {item.progress < 100 && item.progress > 0 && <Icon name="loader" size={10} className="text-blue-400 animate-spin" />}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Default Fallback & Meteor Grid View */}
                            {data.type === 'DEFAULT' && (
                                <div className="space-y-4">
                                    {(!tasks || tasks.length === 0) ? (
                                        <div className="text-center py-10 text-slate-500">ÊöÇÊó†Ê¥ªÂä®‰ªªÂä°</div>
                                    ) : agent.name === 'ÊµÅÊòüÈõ®ÂèëÂ∏ÉËææ‰∫∫' ? (
                                        // üöÄ Meteor Shower Special Grid View (Batch Visualization)
                                        <div className="space-y-4">
                                            <div className="flex items-center justify-between px-1">
                                                <h4 className="text-xs font-bold text-blue-400 uppercase tracking-widest flex items-center gap-2">
                                                    <Icon name="zap" size={12} />
                                                    ÊâπÈáèÈ´òÈÄüÂèëÂ∏ÉÂºïÊìé
                                                </h4>
                                                <span className="text-[10px] font-mono text-slate-500">{tasks.length} ACTIVE</span>
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                {tasks.map(task => (
                                                    <div key={task.id} className="bg-white/5 border border-white/5 p-3 rounded-lg flex flex-col gap-2 relative overflow-hidden group hover:border-blue-500/30 transition-colors">
                                                        {/* Status Pulse */}
                                                        {task.status === 'running' && (
                                                            <div className="absolute top-0 right-0 p-1.5">
                                                                <div className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-ping"></div>
                                                            </div>
                                                        )}

                                                        {/* Icon & ID */}
                                                        <div className="flex items-center justify-between">
                                                            <div className={`w-8 h-8 rounded bg-gradient-to-br ${task.status === 'running' ? 'from-blue-600 to-cyan-600' : 'from-slate-700 to-slate-800'} flex items-center justify-center text-white shadow-inner`}>
                                                                <Icon name={task.status === 'running' ? 'upload-cloud' : 'check'} size={14} />
                                                            </div>
                                                            <span className="text-[10px] font-mono text-slate-500">#{task.id}</span>
                                                        </div>

                                                        {/* Description */}
                                                        <div className="flex flex-col">
                                                            <span className="text-slate-300 text-[10px] font-bold truncate">{task.description.split(':')[0]}</span>
                                                            <span className="text-slate-500 text-[9px] truncate">{task.description.split(':').slice(1).join(':') || 'Processing...'}</span>
                                                        </div>

                                                        {/* Progress Bar (Visual) */}
                                                        <div className="h-1 bg-slate-800 rounded-full overflow-hidden mt-1">
                                                            <div className={`h-full ${task.status === 'running' ? 'bg-blue-500 animate-[shimmer_1s_infinite] w-2/3' : 'bg-emerald-500 w-full'}`}></div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ) : (
                                        // Standard List View
                                        tasks.map(task => (
                                            <div key={task.id} className="p-4 bg-white/5 rounded-xl border border-white/5 flex items-center justify-between">
                                                <span className="text-slate-300 text-sm font-medium">{task.description}</span>
                                                <span className={`text-xs px-2 py-1 rounded bg-slate-800 ${task.status === 'running' ? 'text-blue-400' :
                                                    task.status === 'completed' ? 'text-emerald-400' : 'text-slate-400'
                                                    }`}>{task.status}</span>
                                            </div>
                                        ))
                                    )}
                                </div>
                            )}

                        </div>

                        {/* Footer */}
                        <div className="p-4 border-t border-white/10 bg-slate-900/50 backdrop-blur-md">
                            <button onClick={onClose} className="w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold text-sm transition-colors">
                                ÂÖ≥Èó≠Â∑•‰ΩúÂè∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        };



        const DataDetailModal = ({ post, onClose }) => {

            if (!post) return null;

            const views = post.views || 0;

            const likes = post.likes || 0;

            const comments = post.comments_count || 0;

            // ÁÆÄÂçïÁöÑÂä®ÊÄÅËØÑÂàÜÈÄªËæë

            const dynamicScore = Math.min(99, Math.floor((views / 20) + (likes * 3) + (comments * 5) + 75));

            const status = dynamicScore > 90 ? 'ÁàÜÊ¨æÂ¢ûÈïø' : dynamicScore > 80 ? 'Âπ≥Á®≥Â¢ûÈïø' : 'ÂàùÊúüÈò∂ÊÆµ';

            const statusColor = dynamicScore > 90 ? 'text-emerald-400' : dynamicScore > 80 ? 'text-blue-400' : 'text-slate-400';

            return (

                <div className="fixed inset-0 bg-[#0a0b14]/95 z-[70] flex items-center justify-center p-4 backdrop-blur-md animate-in fade-in duration-300">

                    <div className="bg-[#12141c] w-full max-w-4xl rounded-[40px] border border-white/5 shadow-2xl relative overflow-hidden flex flex-col max-h-[90vh]">

                        {/* Ë£ÖÈ•∞ÊÄßËÉåÊôØ */}

                        <div className="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 blur-[100px] rounded-full -translate-y-1/2 translate-x-1/2"></div>

                        <div className="absolute bottom-0 left-0 w-64 h-64 bg-purple-500/10 blur-[100px] rounded-full translate-y-1/2 -translate-x-1/2"></div>

                        {/* Close Button */}

                        <button onClick={onClose} className="absolute top-8 right-8 w-10 h-10 bg-white/5 hover:bg-white/10 rounded-2xl flex items-center justify-center text-white/40 hover:text-white transition-all z-10">

                            <Icon name="plus" className="rotate-45" size={24} />

                        </button>

                        <div className="flex-1 overflow-y-auto p-12 custom-scrollbar space-y-12">

                            {/* Top Section */}

                            <div className="flex justify-between items-start">

                                <div className="space-y-4">

                                    <div className="inline-flex items-center gap-2 px-3 py-1 bg-blue-500/10 border border-blue-500/20 rounded-full">

                                        <div className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse"></div>

                                        <span className="text-xs font-black text-blue-400 uppercase tracking-widest">ÂçïÊù°ÂÜÖÂÆπÊ∑±Â∫¶ÂàÜÊûêÊä•Âëä</span>

                                    </div>

                                    <h2 className="text-4xl font-black text-white tracking-tighter">

                                        {dynamicScore > 90 ? 'Ë°®Áé∞‰ºòÂºÇ' : 'ÊΩúÂäõÂÜÖÂÆπ'}

                                    </h2>

                                    <p className="text-white/60 text-base font-medium max-w-md leading-relaxed">
                                        Êï∞ÊçÆË∂ãÂäøÂØπÊØîÂêåÁ±ªÂàõ‰ΩúËÄÖÔºåÂΩìÂâç‰∫íÂä®ÁéáË∂ÖË∂ä <span className="text-emerald-400 font-bold">{Math.floor(dynamicScore / 1.1)}%</span> ÁöÑÂêåÁ±ªÂÜÖÂÆπ„ÄÇ </p>

                                </div>

                                <div className="bg-white/5 border border-white/10 rounded-[32px] p-6 text-center w-32 shadow-xl backdrop-blur-sm">

                                    <p className="text-sm font-bold text-white/40 uppercase tracking-widest mb-1">ÂÜÖÂÆπÁªºÂêàËØÑÂàÜ</p>

                                    <h3 className="text-5xl font-black text-white tracking-tighter">{dynamicScore}</h3>

                                    <p className={`text-sm font-bold ${statusColor} mt-1 uppercase tracking-widest`}>Áä∂ÊÄÅ: {status}</p>

                                </div>

                            </div>

                            {/* Stat Cards Row */}

                            <div className="grid grid-cols-4 gap-6">

                                {

                                    [

                                        { label: 'Êí≠Êîæ', value: (views).toLocaleString(), icon: 'bar-chart-2', color: 'text-blue-500' },

                                        { label: 'ËØÑËÆ∫', value: (comments).toLocaleString(), icon: 'message-circle', color: 'text-purple-500' },

                                        { label: 'ÂàÜ‰∫´', value: (post.shares || 0).toLocaleString(), icon: 'share-2', color: 'text-pink-500' },

                                        { label: 'ÊÄªÈîÄÂîÆÈ¢ù', value: `¬•${(post.gmv || 0).toLocaleString()}`, icon: 'shopping-bag', color: 'text-amber-500' }

                                    ].map((stat, i) => (

                                        <div key={i} className="bg-white/5 border border-white/10 rounded-[28px] p-6 hover:bg-white/[0.08] transition-all group">

                                            <div className={`w-10 h-10 rounded-2xl bg-white/5 flex items-center justify-center mb-4 ${stat.color} group-hover:scale-110 transition-transform`}>

                                                <Icon name={stat.icon} size={20} />

                                            </div>

                                            <p className="text-sm font-bold text-white/40 uppercase tracking-widest mb-1">{stat.label}</p>

                                            <p className="text-2xl font-black text-white tracking-tighter">{stat.value}</p>

                                            <div className="flex items-center gap-1 mt-2">

                                                <div className="w-1 h-1 bg-emerald-400 rounded-full"></div>

                                                <span className="text-[11px] font-bold text-emerald-400 uppercase tracking-widest">Â¢ûÈïø‰∏≠</span>

                                            </div>

                                        </div>

                                    ))}

                            </div>

                            {/* Charts & Details */}

                            <div className="grid grid-cols-5 gap-8">

                                <div className="col-span-3 bg-white/5 border border-white/10 rounded-[24px] p-6">

                                    <div className="flex items-center justify-between mb-8">

                                        <h4 className="text-xs font-black text-white uppercase tracking-widest flex items-center gap-2">

                                            <div className="w-1.5 h-1.5 bg-blue-500 rounded-full"></div>

                                            24H ÁàÜÂèëË∂ãÂäø

                                        </h4>

                                    </div>

                                    <div className="h-48 flex items-end justify-between gap-1.5">

                                        {[40, 60, 45, 90, 70, 100, 80, 50, 65, 40, 30].map((h, i) => (

                                            <div key={i} className={`flex-1 ${views > 100 ? 'bg-gradient-to-t from-blue-600/20 to-blue-500' : 'bg-white/10'} rounded-t-lg transition-all hover:opacity-80 cursor-help`} style={{ height: `${h}%` }}></div>

                                        ))}

                                    </div>

                                </div>

                                <div className="col-span-2 bg-white/5 border border-white/10 rounded-[24px] p-6">

                                    <h4 className="text-xs font-black text-white uppercase tracking-widest flex items-center gap-2 mb-8">

                                        <Icon name="clock" size={14} className="text-blue-500" />

                                        ËΩ¨ÂåñÊåáÊ†á

                                    </h4>

                                    <div className="space-y-6">

                                        {[

                                            { label: 'ÂÆåÊí≠Áéá', value: '72% ', color: 'from-blue-500 to-blue-600' },

                                            { label: '‰∏ªÈ°µËÆøÈóÆ', value: '45% ', color: 'from-purple-500 to-purple-600' },

                                            { label: 'ÂïÜÂìÅÁÇπÂáª', value: '18% ', color: 'from-pink-500 to-pink-600' }

                                        ].map((item, i) => (

                                            <div key={i} className="space-y-2">

                                                <div className="flex justify-between text-sm font-bold uppercase tracking-widest">
                                                    <span className="text-white/60">{item.label}</span>
                                                    <span className="text-white text-base">{item.value}</span>
                                                </div>

                                                <div className="h-1.5 bg-white/5 rounded-full overflow-hidden">

                                                    <div className={`h-full bg-gradient-to-r ${item.color} rounded-full`} style={{ width: item.value }}></div>

                                                </div>

                                            </div>

                                        ))}

                                    </div>

                                </div>

                            </div>

                            {/* Bottom Card */}

                            <div className="bg-gradient-to-r from-blue-600/10 to-purple-600/10 border border-white/10 rounded-[24px] p-6 flex items-center justify-between">

                                <div className="flex items-center gap-6" >

                                    <div className="w-12 h-12 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-center text-blue-400 shadow-[0_0_20px_rgba(59,130,246,0.2)]">

                                        <Icon name="zap" size={24} />

                                    </div>

                                    <div>

                                        <h5 className="text-sm font-black text-white uppercase tracking-widest">Á≠ñÁï•ÂºïÊìéÊ¥ûÂØü</h5>

                                        <p className="text-white/40 text-xs font-medium mt-1 uppercase tracking-wider leading-relaxed">

                                            {dynamicScore > 90 ? "ÂΩìÂâçÂÜÖÂÆπÂ§Ñ‰∫éÈªÑÈáëÁàÜÂèëÊúüÔºåÂª∫ËÆÆÁ´ãÂç≥ÊäïÊîæ'ÂÖ®ÁêÉÂä©Êé®'„ÄÇ" : "ÂàùÁ≠õÊòæÁ§∫Ë¥®Èáè‰ºòÂºÇÔºåÂª∫ËÆÆÂú®ÈªÑÈáëÊó∂Èó¥ÊÆµÂ¢ûÂä†‰∫íÂä®ÂõûÂ§ç„ÄÇ"}

                                        </p>

                                    </div>

                                </div>

                                <button className="px-8 py-3 bg-white text-[#0a0f18] rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-slate-200 transition-all shadow-xl shadow-white/5">

                                    Á´ãÂç≥Âä©Êé®

                                </button>

                            </div>

                        </div>

                    </div>

                </div>

            );

        };

        const HistoryCard = ({

            post, account, onDelete, onViewComments, onViewData }) => {

            const platformColors = {

                'TWITTER': 'text-sky-500 bg-sky-50 border-sky-100',

                'YOUTUBE': 'text-red-600 bg-red-50 border-red-100',

                'INSTAGRAM': 'text-pink-600 bg-pink-50 border-pink-100',

                'LINKEDIN': 'text-blue-700 bg-blue-50 border-blue-100',

                'FACEBOOK': 'text-blue-600 bg-blue-50 border-blue-100',

                'TIKTOK': 'text-slate-900 bg-slate-100 border-slate-200'

            };

            const formatDate = (dateStr) => {

                if (!dateStr) return 'Êú™Áü•Êó∂Èó¥';

                const date = new Date(dateStr);

                return date.toLocaleString('zh-CN', {

                    month: '2-digit',

                    day: '2-digit',

                    hour: '2-digit',

                    minute: '2-digit'

                });

            };

            // Ëé∑ÂèñÈ¶ñ‰∏™Â™í‰Ωì‰Ωú‰∏∫Â∞ÅÈù¢

            const firstMedia = post.media && post.media.length > 0 ? post.media[0] : null;

            // Safe property access

            const accountType = (account && account.type) ? account.type.toUpperCase() : 'UNKNOWN';

            const accountName = (account && account.name) ? account.name : 'Êú™Áü•Áî®Êà∑';

            const accountAvatar = (account && account.avatar) ? account.avatar : 'https://api.dicebear.com/7.x/initials/svg?seed=Unknown';

            const postContent = post && post.content ? post.content : '';

            // Icon safe name

            const getIconName = (type) => {

                if (!type) return 'help-circle';

                const t = type.toUpperCase();

                if (t === 'TIKTOK') return 'tiktok';
                if (t === 'TWITTER' || t === 'X') return 'twitter';

                return type.toLowerCase();

            }

            return (
                <div className="bg-white rounded-[24px] p-6 mb-6 border border-slate-100 shadow-lg shadow-slate-200/50 hover:shadow-2xl hover:-translate-y-1 transition-all duration-500 group flex flex-col lg:flex-row gap-8 overflow-hidden relative">
                    <div className="absolute top-0 right-0 w-32 h-32 bg-slate-50 rounded-full blur-[40px] -mr-16 -mt-16 group-hover:bg-blue-50 transition-all"></div>

                    {/* Left: Media Thumbnail */}

                    <div className="w-full md:w-64 shrink-0">

                        <div className="aspect-[4/3] rounded-2xl overflow-hidden bg-slate-50 border border-slate-100 relative shadow-inner group-hover:scale-[1.02] transition-transform duration-500">

                            {post.thumbnail ? (

                                // Êô∫ËÉΩÂà§Êñ≠ÊòØËßÜÈ¢ëËøòÊòØÂõæÁâá

                                post.thumbnail.match(/\.(mp4|mov|avi|webm|m4v)(\?|$)/i) ||

                                    (post.media && post.media.length > 0 && post.media[0].type && post.media[0].type.startsWith('video')) ? (

                                    <video

                                        src={post.thumbnail + "#t=0.1"}

                                        className="w-full h-full object-cover"

                                        preload="metadata"

                                        muted

                                        onError={(e) => {

                                            // Â¶ÇÊûúËßÜÈ¢ëÈîôËØØÔºåÊòæÁ§∫Êí≠ÊîæÂõæÊ†á

                                            e.target.style.display = 'none';

                                            e.target.nextElementSibling.style.display = 'flex';

                                        }}

                                    />

                                ) : (

                                    <img

                                        src={post.thumbnail}

                                        className="w-full h-full object-cover"

                                        onError={(e) => {

                                            // ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÁöÑÂÆπÈîôÂ§ÑÁêÜ - ‰ΩøÁî®Áî®Êà∑‰∏ä‰º†ÁöÑÂ∞ÅÈù¢
                                            const covers = ["cover1.png", "cover2.png", "cover3.png", "cover4.png", "cover5.png", "cover11.png", "cover7.png", "cover8.png", "cover9.png"];
                                            const h = Math.abs(String(post.id).split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0));
                                            e.target.src = covers[h % covers.length];

                                            e.target.onerror = null;

                                        }}

                                    />

                                )

                            ) : (

                                <div className="w-full h-full flex flex-col items-center justify-center text-slate-300">

                                    <Icon name="image" size={32} />

                                    <span className="text-xs font-bold uppercase tracking-widest mt-2">Text Only</span>

                                </div>

                            )}

                            {/* ËßÜÈ¢ëÂ§áÁî®ÂõæÊ†áÔºàÂΩìËßÜÈ¢ëÂä†ËΩΩÂ§±Ë¥•Êó∂ÊòæÁ§∫Ôºâ */}

                            <div className="hidden w-full h-full flex-col items-center justify-center text-slate-400 bg-slate-100">

                                <Icon name="video" size={32} />

                                <span className="text-xs font-bold uppercase tracking-widest mt-2">Video Content</span>

                            </div>

                            {/* Platform Badge on Thumbnail */}

                            <div className="absolute top-3 left-3">

                                <span className={`flex items-center gap-1.5 px-3 py-1.5 rounded-xl text-xs font-black uppercase tracking-wider shadow-sm border ${platformColors[accountType] || 'text-slate-600 bg-slate-50 border-slate-200'}`}>

                                    <Icon name={getIconName(accountType)} size={12} />

                                    {accountType}

                                </span>

                            </div>

                        </div>

                    </div>

                    {/* Right: Content */}

                    <div className="flex-1 flex flex-col">

                        {/* Header */}

                        <div className="flex items-start justify-between mb-4">

                            <div className="flex items-center gap-3">

                                <div className="w-10 h-10 rounded-full border border-slate-100 p-0.5 bg-white shadow-sm">

                                    <img src={accountAvatar} alt={accountName} className="w-full h-full rounded-full object-cover" />

                                </div>

                                <div>

                                    <h4 className="font-bold text-slate-900 text-sm">{accountName}</h4>

                                    <p className="text-xs text-slate-400 font-bold uppercase tracking-wider">ÂèëÂ∏É‰∫é: {formatDate(post.postDate)}</p>

                                </div>

                            </div>

                            {/* Status Indicator (Optional) */}

                            {

                                post.status === 'PUBLISHED' && (

                                    <div className="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"></div>

                                )

                            }

                        </div>

                        <div className="flex-1 mb-6">

                            <p className="text-slate-700 text-base leading-relaxed font-medium">{postContent || <span className="text-slate-300 italic">No Content</span>}</p>

                            {/* Tags placeholder if data had tags */}

                            <div className="text-blue-600 text-xs font-bold mt-2 flex flex-wrap gap-2">

                                {

                                    (postContent.match(/#[^\s#]+/g) || []).map((tag, i) => (

                                        <span key={i}>{tag}</span>

                                    ))

                                }

                            </div>

                        </div>

                        <div className="flex items-center justify-between pt-4 mt-auto">

                            <div className="flex items-center gap-6">

                                <div className="flex items-center gap-2 text-slate-400 font-bold text-xs">

                                    <Icon name="bar-chart" size={14} />

                                    <span>{post.views || 0}</span>

                                </div>

                                <div className="flex items-center gap-2 text-slate-400 font-bold text-xs">
                                    <Icon name="heart" size={14} />
                                    <span>{post.likes || 0}</span>
                                </div>
                                <div className="flex items-center gap-2 text-emerald-500 font-black text-xs">
                                    <Icon name="dollar-sign" size={14} />
                                    <span>¬•{(post.gmv || 0).toLocaleString()}</span>
                                </div>

                            </div>

                            <div className="flex items-center gap-3">

                                {account.url && (

                                    <a

                                        href={account.url}

                                        target="_blank"

                                        rel="noopener noreferrer"

                                        className="px-4 py-2 text-sm font-bold text-blue-600 hover:bg-blue-50 rounded-xl transition-all flex items-center gap-1.5"

                                    >

                                        <span>Êü•ÁúãÂéüÊñá</span>

                                        <Icon name="external-link" size={14} />

                                    </a>

                                )}

                                <div className="flex flex-wrap items-center gap-3">
                                    <button
                                        onClick={() => onViewComments(post)}
                                        className="px-6 py-2.5 text-xs font-black text-white bg-blue-600 hover:bg-blue-500 rounded-xl transition-all shadow-lg shadow-blue-500/30 active:scale-95 flex items-center gap-2"
                                    >
                                        <Icon name="message-square" size={14} />
                                        <span>Êü•ÁúãËØÑËÆ∫</span>
                                    </button>
                                    <button
                                        onClick={() => onViewData(post)}
                                        className="px-6 py-2.5 text-xs font-black text-white bg-indigo-600 hover:bg-indigo-500 rounded-xl transition-all shadow-lg shadow-indigo-500/30 active:scale-95 flex items-center gap-2"
                                    >
                                        <Icon name="bar-chart" size={14} />
                                        <span>ËØ¶ÁªÜÊï∞ÊçÆ</span>
                                    </button>
                                    <button
                                        onClick={() => onDelete(post.id)}
                                        className="px-6 py-2.5 text-xs font-black text-white bg-red-600 hover:bg-red-500 rounded-xl transition-all shadow-lg shadow-red-500/30 active:scale-95 flex items-center gap-2"
                                    >
                                        <Icon name="trash" size={14} />
                                        <span>Âà†Èô§</span>
                                    </button>
                                </div>

                            </div>

                        </div>

                    </div>

                </div>

            );

        };

        const HistoryView = ({ showStatus }) => {

            const [posts, setPosts] = useState([]);

            const [loading, setLoading] = useState(true);

            const [isSyncing, setIsSyncing] = useState(false);

            const [activePost, setActivePost] = useState(null);

            const [dataPost, setDataPost] = useState(null);

            const [activePlatform, setActivePlatform] = useState('ALL');

            // Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°ÜÁä∂ÊÄÅ
            const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
            const [pendingDeleteId, setPendingDeleteId] = useState(null);

            useEffect(() => {

                // Initial load: fast fetch (sync=false)

                fetchHistory(false);

                // Auto refresh every 3 minutes (180000 ms)

                const interval = setInterval(() => {

                    console.log('Auto-refreshing history data...');

                    fetchHistory(true);

                }, 180000);

                return () => clearInterval(interval);

            }, []);

            const fetchHistory = async (forceSync = false) => {

                if (forceSync) setIsSyncing(true);

                else setLoading(true);

                try {

                    const res = await fetch(`${API_BASE}/api/history?sync=${forceSync}`);

                    const data = await res.json();

                    setPosts(Array.isArray(data) ? data : []);

                } catch (error) {

                    console.error('Fetch history error:', error);

                } finally {

                    setLoading(false);

                    setIsSyncing(false);

                }

            };

            const handleDelete = async (postId) => {
                // ÊòæÁ§∫Ëá™ÂÆö‰πâÁ°ÆËÆ§ÂØπËØùÊ°Ü
                setPendingDeleteId(postId);
                setShowDeleteConfirm(true);
            };

            const confirmDelete = async () => {
                const postId = pendingDeleteId;
                setShowDeleteConfirm(false);
                setPendingDeleteId(null);


                try {

                    const res = await fetch(`${API_BASE}/api/posts/${postId}`, {

                        method: 'DELETE'

                    });

                    const result = await res.json();

                    if (result.success) {
                        // ‰ªéÂàóË°®‰∏≠ÁßªÈô§Â∏ñÂ≠ê
                        setPosts(posts.filter(p => p.id !== postId));
                        // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
                        showStatus('success', 'Â∑≤‰ªéÊâÄÊúâÂπ≥Âè∞Âà†Èô§');
                    } else {
                        showStatus('error', 'Delete failed: ' + (result.error || 'Unknown Error'));
                    }
                } catch (error) {
                    showStatus('error', 'Network Error: ' + error.message);
                }
            };

            // Flatten posts to separate items by account

            const flattenedItems = React.useMemo(() => {

                return posts.flatMap(post => {

                    return (post.accounts || []).map(account => ({

                        originalPost: post,

                        displayAccount: account,

                        key: `${post.id}-${account.type}-${account.name}`

                    }));

                });

            }, [posts]);

            const filteredItems = activePlatform === 'ALL' ? flattenedItems

                : flattenedItems.filter(item => item.displayAccount.type === activePlatform);

            const platformCounts = React.useMemo(() => {
                const counts = { 'ALL': flattenedItems.length };
                flattenedItems.forEach(item => {
                    const type = (item.displayAccount.type || 'UNKNOWN').toUpperCase();
                    counts[type] = (counts[type] || 0) + 1;
                });
                return counts;
            }, [flattenedItems]);

            return (
                <div className="max-w-5xl mx-auto py-8 px-5 relative">
                    <div className="mb-12 flex items-end justify-between">
                        <div>
                            <h2 className="text-4xl font-extrabold text-slate-900 tracking-tight mb-2">ÂèëÂ∏ÉÁÆ°ÁêÜ</h2>
                            <p className="text-slate-500 font-medium">ÂÖ®Âπ≥Âè∞ÂÜÖÂÆπÂèëÂ∏ÉÁõëÊéß‰∏é‰º†Êí≠ÂàÜÊûê</p>
                        </div>

                        <div className="flex items-center gap-4">
                            {/* Sync Button */}
                            <button
                                onClick={() => fetchHistory(true)}
                                disabled={isSyncing || loading}
                                className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all border ${isSyncing ? 'bg-blue-50 text-blue-600 border-blue-100 cursor-wait'
                                    : 'bg-white text-slate-600 border-slate-200 hover:bg-white/50 hover:text-blue-600'}`}
                            >
                                <Icon name="rotate-ccw" size={14} className={isSyncing ? "animate-spin" : ""} />
                                {isSyncing ? 'ÂêåÊ≠•‰∏≠...' : 'ÂêåÊ≠•Áä∂ÊÄÅ'}
                            </button>

                            <div className="hidden md:flex items-center -space-x-2">
                                {/* Only show first 5 distinct avatars */}
                                {posts.slice(0, 5).flatMap(p => p.accounts).slice(0, 5).map((acc, i) => (
                                    <div key={i} className="w-8 h-8 rounded-full border-2 border-white bg-slate-100 flex items-center justify-center overflow-hidden">
                                        <img src={acc.avatar} className="w-full h-full object-cover" />
                                    </div>
                                ))}
                                {posts.length > 5 && (
                                    <div className="w-8 h-8 rounded-full border-2 border-white bg-slate-100 flex items-center justify-center text-[10px] font-bold text-slate-500">
                                        +{posts.length}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Platform Tabs */}
                    {
                        !loading && posts.length > 0 && (
                            <div className="flex items-center gap-3 mb-8 overflow-x-auto pb-4 no-scrollbar">
                                <button
                                    onClick={() => setActivePlatform('ALL')}
                                    className={`px-6 py-3 rounded-2xl text-sm font-bold transition-all whitespace-nowrap flex items-center gap-2 ${activePlatform === 'ALL' ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30'
                                        : 'bg-slate-800/50 text-slate-300 border border-blue-500/20 hover:bg-slate-700/50 hover:border-blue-500/40'}`}
                                >
                                    <div className={`w-6 h-6 rounded-lg flex items-center justify-center shrink-0 shadow-sm bg-blue-500`}>
                                        <Icon name="folder" size={16} />
                                    </div>
                                    <span>ÂÖ®ÈÉ®</span>
                                    <span className={`px-1.5 py-0.5 rounded-md text-[11px] ${activePlatform === 'ALL' ? 'bg-blue-500 text-blue-100' : 'bg-slate-700 text-slate-400'}`}>
                                        {platformCounts['ALL'] || 0}
                                    </span>
                                </button>

                                {
                                    Array.from(new Set(posts.flatMap(p => p.accounts.map(a => a.type ? a.type.toUpperCase() : 'UNKNOWN')))).map(type => {
                                        const iconName = (type === 'TWITTER' || type === 'X') ? 'twitter' : type.toLowerCase();

                                        // Match Publish Center icon background logic
                                        const getPlatformBg = (t) => {
                                            const lowered = t.toLowerCase();
                                            if (lowered.includes('youtube')) return 'bg-white';
                                            if (lowered.includes('tiktok')) return 'bg-black';
                                            if (lowered.includes('twitter') || lowered.includes('x')) return 'bg-black';
                                            return 'bg-blue-600';
                                        };

                                        return (
                                            <button
                                                key={type}
                                                onClick={() => setActivePlatform(type)}
                                                className={`px-6 py-3 rounded-2xl text-sm font-bold transition-all whitespace-nowrap flex items-center gap-2 ${activePlatform === type ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30'
                                                    : 'bg-slate-800/50 text-slate-300 border border-blue-500/20 hover:bg-slate-700/50 hover:border-blue-500/40'}`}
                                            >
                                                <div className={`w-6 h-6 rounded-lg flex items-center justify-center shrink-0 shadow-sm ${getPlatformBg(type)}`}>
                                                    <Icon name={iconName} size={16} />
                                                </div>
                                                <span>{type}</span>
                                                <span className={`px-1.5 py-0.5 rounded-md text-[11px] ${activePlatform === type ? 'bg-blue-500 text-blue-100' : 'bg-slate-700 text-slate-400'}`}>
                                                    {platformCounts[type] || 0}
                                                </span>
                                            </button>
                                        );
                                    })
                                }
                            </div>
                        )
                    }


                    {

                        loading ? (

                            <div className="space-y-8">

                                {[1, 2, 3].map(i => (

                                    <div key={i} className="bg-white rounded-[32px] p-6 h-64 animate-pulse border border-slate-100 shadow-sm flex gap-8">

                                        <div className="w-64 bg-slate-50 rounded-2xl"></div>

                                        <div className="flex-1 space-y-4 py-4">

                                            <div className="w-1/2 h-4 bg-slate-50 rounded"></div>

                                            <div className="w-full h-20 bg-slate-50 rounded"></div>

                                        </div>

                                    </div>

                                ))}

                            </div>

                        ) : filteredItems.length === 0 ? (

                            <div className="flex flex-col items-center justify-center py-40 bg-white rounded-[50px] border border-slate-100 shadow-sm">

                                <div className="w-24 h-24 bg-slate-50 rounded-[32px] flex items-center justify-center text-slate-200 mb-8 border border-white shadow-inner">

                                    <Icon name="layout" size={48} />

                                </div>

                                <h3 className="text-2xl font-black text-slate-800 mb-2 tracking-tight">No Publish Records</h3>

                                <p className="text-slate-400 font-bold uppercase tracking-widest text-[10px]">Go publish your first amazing content</p>

                            </div>

                        ) : (

                            <div className="animate-in fade-in slide-in-from-bottom-5 duration-700">

                                {filteredItems.map(item => (

                                    <HistoryCard

                                        key={item.key}

                                        post={item.originalPost}

                                        account={item.displayAccount}

                                        onDelete={handleDelete}

                                        onViewComments={setActivePost}

                                        onViewData={setDataPost}

                                    />

                                ))}

                            </div>

                        )}

                    {

                        activePost && (

                            <>

                                <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-50 animate-in fade-in duration-500" onClick={() => setActivePost(null)}></div>

                                <CommentPanel post={activePost} onClose={() => setActivePost(null)} />

                            </>

                        )

                    }

                    {

                        dataPost && (

                            <DataDetailModal post={dataPost} onClose={() => setDataPost(null)} />

                        )

                    }

                    {/* Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°Ü */}
                    {showDeleteConfirm && (
                        <div className="fixed inset-0 z-[300] flex items-center justify-center p-4">
                            {/* ËÉåÊôØÈÅÆÁΩ© */}
                            <div className="absolute inset-0 bg-slate-950/60 backdrop-blur-sm animate-in fade-in duration-300" onClick={() => setShowDeleteConfirm(false)}></div>

                            {/* ÂØπËØùÊ°Ü */}
                            <div className="bg-[#1a1c2e] rounded-3xl w-full max-w-md p-8 shadow-[0_20px_60px_rgba(0,0,0,0.5)] border border-red-500/20 relative overflow-hidden backdrop-blur-xl animate-in zoom-in duration-300 z-10">
                                {/* È°∂ÈÉ®Ë≠¶ÂëäÊù° */}
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 to-rose-400"></div>

                                <div className="flex flex-col items-center text-center">
                                    {/* Ë≠¶ÂëäÂõæÊ†á */}
                                    <div className="w-16 h-16 rounded-2xl bg-red-500/10 text-red-400 border border-red-500/20 flex items-center justify-center mb-6">
                                        <Icon name="alert-triangle" size={32} />
                                    </div>

                                    {/* Ê†áÈ¢ò */}
                                    <h3 className="text-2xl font-black text-white mb-3 tracking-tight">
                                        ‚ö†Ô∏è Âà†Èô§È£éÈô©Ë≠¶Âëä
                                    </h3>

                                    {/* Ë≠¶ÂëäËØ¥Êòé */}
                                    <p className="text-slate-400 text-sm mb-6 leading-relaxed">
                                        Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§‰ª•‰∏ãÂπ≥Âè∞ÁöÑÂÜÖÂÆπÔºö
                                    </p>

                                    {/* Âπ≥Âè∞ÂàóË°® */}
                                    <div className="w-full bg-slate-900/50 rounded-2xl p-4 mb-6 border border-slate-700/50">
                                        <ul className="text-left space-y-2 text-sm text-slate-300">
                                            <li className="flex items-center gap-2">
                                                <Icon name="check" size={14} className="text-red-400" />
                                                ‰ªé TikTok Âà†Èô§ËßÜÈ¢ë
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <Icon name="check" size={14} className="text-red-400" />
                                                ‰ªé YouTube Âà†Èô§ËßÜÈ¢ë
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <Icon name="check" size={14} className="text-red-400" />
                                                ‰ªé Twitter/X Âà†Èô§Â∏ñÂ≠ê
                                            </li>
                                            <li className="flex items-center gap-2">
                                                <Icon name="check" size={14} className="text-red-400" />
                                                Âà†Èô§Êú¨Âú∞Êï∞ÊçÆÂ∫ìËÆ∞ÂΩï
                                            </li>
                                        </ul>
                                    </div>

                                    {/* APIÈôêÂà∂ËØ¥Êòé */}
                                    <p className="text-yellow-400 text-xs mb-6 font-bold bg-yellow-500/10 px-4 py-2 rounded-xl border border-yellow-500/20">
                                        ‚ö†Ô∏è API ÈôêÂà∂ÊèêÁ§∫Ôºö‰∏çÊîØÊåÅÂçïÂπ≥Âè∞Áã¨Á´ãÂà†Èô§
                                    </p>

                                    {/* ÊúÄÁªàË≠¶Âëä */}
                                    <p className="text-red-400 text-sm font-black mb-8">
                                        Ê≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅÊÇ®Á°ÆÂÆöÂêóÔºü
                                    </p>

                                    {/* Êìç‰ΩúÊåâÈíÆ */}
                                    <div className="flex gap-3 w-full">
                                        <button
                                            onClick={() => setShowDeleteConfirm(false)}
                                            className="flex-1 py-3 px-4 rounded-2xl font-bold text-sm bg-slate-800 hover:bg-slate-700 text-white transition-all active:scale-95"
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                        <button
                                            onClick={confirmDelete}
                                            className="flex-1 py-3 px-4 rounded-2xl font-bold text-sm bg-red-600 hover:bg-red-500 text-white transition-all active:scale-95 shadow-lg shadow-red-500/20"
                                        >
                                            Á°ÆËÆ§Âà†Èô§
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                </div>

            );

        };

        const PublishView = ({

            accounts, postContent, setPostContent, selectedAccounts, toggleAccountSelection, handlePublish, publishing, mediaFiles, setMediaFiles }) => {

            const [activeTab, setActiveTab] = React.useState('local');

            const fileInputRef = React.useRef(null);

            const [isScheduleModalOpen, setIsScheduleModalOpen] = React.useState(false);

            const [scheduledTime, setScheduledTime] = React.useState(null);

            const [previewFile, setPreviewFile] = React.useState(null);

            const handleFiles = (files) => {

                const newFiles = Array.from(files).map(file => ({

                    file: file,

                    preview: URL.createObjectURL(file),

                    name: file.name,

                    type: file.type

                }));

                setMediaFiles(prev => [...prev, ...newFiles]);

            };

            const handleRemoteUrl = () => {

                const url = prompt("Enter image or video URL:");

                if (url) {

                    setMediaFiles(prev => [...prev, {

                        remoteUrl: url,

                        preview: url,

                        name: 'Remote File',

                        type: 'video/mp4' // ÊöÇÂÆöÔºåÂêéÁ´Ø‰ºöÊ†°È™å

                    }]);

                }

            };

            const removeFile = (index) => {

                setMediaFiles(prev => {

                    const newFiles = [...prev];

                    if (newFiles[index].preview && !newFiles[index].remoteUrl) {

                        URL.revokeObjectURL(newFiles[index].preview);

                    }

                    newFiles.splice(index, 1);

                    return newFiles;

                });

            };

            return (

                <>

                    <div className="flex w-full h-full bg-transparent p-6 gap-8 overflow-hidden relative">

                        {/* Left: Editor Card - White Theme */}

                        <div className="flex-1 flex flex-col min-w-0 z-10">

                            <div className="bg-white rounded-[24px] shadow-sm flex flex-col h-full overflow-hidden border border-slate-200">

                                {/* Header */}

                                <div className="px-6 py-4 border-b border-slate-100 flex items-center justify-between shrink-0 bg-white">

                                    <div className="flex items-center gap-3">

                                        <div className="w-1.5 h-6 bg-blue-600 rounded-full"></div>

                                        <h2 className="text-xl font-bold text-slate-800">Âàõ‰ΩúÂ∑•‰ΩúÂÆ§</h2>

                                    </div>

                                    <button

                                        onClick={() => setPostContent('')}

                                        className="flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors"

                                    >

                                        <Icon name="rotate-ccw" size={14} />

                                        <span>Ê∏ÖÁ©∫ÂÜÖÂÆπ</span>

                                    </button>

                                </div>

                                {/* Scrollable Content */}

                                <div className="flex-1 overflow-y-auto px-6 py-4 custom-scrollbar">

                                    <div className="max-w-4xl mx-auto space-y-8">

                                        {/* 1. Accounts */}

                                        <div className="space-y-3">

                                            <label className="text-xs font-bold text-slate-400 uppercase tracking-wider">ÂèëÂ∏ÉË¥¶Âè∑</label>

                                            <div className="flex flex-wrap gap-3">

                                                {/* Inject Fake Facebook Account for UI Demo */}
                                                {accounts.map(acc => {
                                                    const isSelected = selectedAccounts.includes(acc.id);

                                                    return (

                                                        <button
                                                            key={acc.id}
                                                            onClick={() => toggleAccountSelection(acc.id)}
                                                            className={`flex flex-col items-start gap-1 px-4 py-3 rounded-xl border transition-all duration-300 group/acc relative ${isSelected
                                                                ? 'bg-blue-600/10 border-blue-500 ring-2 ring-blue-500/50 text-white shadow-[0_0_20px_rgba(59,130,246,0.3)] scale-[1.05] z-10'
                                                                : 'bg-white border-slate-200 text-slate-600 hover:border-blue-500/30 hover:bg-blue-50/30'
                                                                }`}
                                                        >
                                                            {isSelected && (
                                                                <div className="absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center shadow-lg border-2 border-white z-20 bounce-in">
                                                                    <Icon name="check" size={14} className="text-white" />
                                                                </div>
                                                            )}
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-all shadow-lg ${(acc.platform || acc.type || '').toLowerCase().includes('youtube') ? 'bg-white' :
                                                                    (acc.platform || acc.type || '').toLowerCase().includes('tiktok') ? 'bg-black' :
                                                                        (acc.platform || acc.type || '').toLowerCase().includes('twitter') || (acc.platform || acc.type || '').toLowerCase().includes('x') ? 'bg-black' :
                                                                            'bg-blue-600'
                                                                    } ${isSelected ? 'ring-2 ring-white/40 scale-105' : 'group-hover/acc:scale-105'}`}>
                                                                    <Icon
                                                                        name={(acc.platform || acc.type || '').toLowerCase()}
                                                                        size={24}
                                                                    />
                                                                </div>
                                                                <div className="flex flex-col items-start min-w-0">
                                                                    <span className={`text-sm font-black uppercase tracking-widest truncate ${isSelected ? 'text-white' : 'text-slate-500'}`}>
                                                                        {acc.platform || acc.type}
                                                                    </span>
                                                                    <span className={`text-[11px] font-medium truncate max-w-[120px] ${isSelected ? 'text-blue-100' : 'text-slate-400'}`}>
                                                                        @{acc.handle || acc.name}
                                                                    </span>
                                                                </div>
                                                                {isSelected && <div className="w-2.5 h-2.5 rounded-full bg-blue-400 animate-pulse ml-2 shadow-[0_0_12px_rgba(96,165,250,0.8)]"></div>}
                                                            </div>
                                                        </button>

                                                    )

                                                })
                                                }

                                                {accounts.length === 0 && (

                                                    <div className="text-slate-400 text-sm italic">ÊöÇÊó†Â∑≤ËøûÊé•Ë¥¶Âè∑ÔºåËØ∑ÂÖàËøûÊé•Ë¥¶Âè∑</div>

                                                )}

                                            </div>

                                        </div>

                                        {/* 2. Text Content */}

                                        <div className="space-y-3">

                                            <div className="flex items-center justify-between">

                                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider">Ê≠£ÊñáÂÜÖÂÆπ</label>

                                                <div className="flex items-center gap-2">
                                                    {(() => {
                                                        const selectedPlats = accounts
                                                            .filter(a => selectedAccounts.includes(a.id))
                                                            .map(a => (a.platform || a.type || "").toUpperCase());

                                                        let limit = null;
                                                        if (selectedPlats.includes('YOUTUBE')) limit = 100;
                                                        else if (selectedPlats.includes('TWITTER') || selectedPlats.includes('X')) limit = 280;

                                                        if (limit) {
                                                            const isOver = postContent.length > limit;
                                                            return (
                                                                <span className={`text-[10px] font-bold px-2 py-1 rounded-full transition-all flex items-center gap-1 ${isOver ? 'bg-red-50 text-red-500 ring-1 ring-red-200 animate-pulse' : 'bg-blue-50 text-blue-600'
                                                                    }`}>
                                                                    {isOver && <Icon name="help" size={10} />}
                                                                    {postContent.length} / {limit}
                                                                </span>
                                                            );
                                                        }
                                                        return (
                                                            <span className="text-[10px] font-bold text-slate-300 bg-slate-100 px-2 py-1 rounded-full">{postContent.length}</span>
                                                        );
                                                    })()}
                                                </div>

                                            </div>

                                            <div className="relative group">

                                                <textarea

                                                    value={postContent}

                                                    onChange={(e) => setPostContent(e.target.value)}

                                                    placeholder="ÂàÜ‰∫´ÊÇ®ÁöÑÁ≤æÂΩ©ÊÉ≥Ê≥ï..."

                                                    className="w-full h-40 p-4 bg-slate-50 border border-slate-100 rounded-2xl resize-none outline-none focus:bg-white focus:border-blue-500/20 focus:ring-4 focus:ring-blue-500/5 transition-all text-slate-700 text-sm leading-relaxed"

                                                ></textarea>

                                                <button className="absolute bottom-4 right-4 p-2 text-slate-400 hover:text-blue-600 transition-colors bg-white rounded-xl shadow-sm border border-slate-100 hover:shadow-md">

                                                    <Icon name="wand" size={16} />

                                                </button>

                                            </div>

                                        </div>

                                        <div className="space-y-3">

                                            <label className="text-xs font-bold text-slate-400 uppercase tracking-wider">ÂÜÖÂÆπÁ¥†Êùê</label>

                                            <input

                                                type="file"

                                                ref={fileInputRef}

                                                className="hidden"

                                                multiple

                                                accept="image/*,video/*"

                                                onChange={(e) => handleFiles(e.target.files)}

                                            />

                                            {/* Upload Buttons */}

                                            <div className="grid grid-cols-2 gap-4">

                                                <div

                                                    onClick={() => fileInputRef.current?.click()}

                                                    className="h-20 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 hover:bg-blue-50 hover:border-blue-400 hover:text-blue-600 text-slate-400 transition-all cursor-pointer flex flex-col items-center justify-center gap-2 group"

                                                >

                                                    <div className="p-2 bg-white rounded-full shadow-sm group-hover:scale-110 transition-transform">

                                                        <Icon name="upload-cloud" size={18} />

                                                    </div>

                                                    <span className="text-xs font-bold">‰∏ä‰º†Êú¨Âú∞Êñá‰ª∂</span>

                                                </div>

                                                <div

                                                    onClick={handleRemoteUrl}

                                                    className="h-20 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50 hover:bg-purple-50 hover:border-purple-400 hover:text-purple-600 text-slate-400 transition-all cursor-pointer flex flex-col items-center justify-center gap-2 group"

                                                >

                                                    <div className="p-2 bg-white rounded-full shadow-sm group-hover:scale-110 transition-transform">

                                                        <Icon name="link" size={18} />

                                                    </div>

                                                    <span className="text-xs font-bold">Á≤òË¥¥ÈìæÊé•</span>

                                                </div>

                                            </div>

                                            {/* Media Preview Grid - Enhanced with Loading States */}

                                            {

                                                mediaFiles.length > 0 && (

                                                    <div className="flex gap-4 overflow-x-auto pb-4 pt-2 custom-scrollbar">

                                                        {mediaFiles.map((file, index) => (

                                                            <div key={index}

                                                                className="relative w-28 h-40 shrink-0 group rounded-xl overflow-hidden shadow-lg border-2 border-slate-200 bg-slate-100 transition-all hover:border-blue-400"

                                                            >

                                                                {/* Loading Background - Visible while media decodes */}

                                                                <div className="absolute inset-0 flex flex-col items-center justify-center bg-slate-50 z-0">

                                                                    <div className="w-6 h-6 border-2 border-blue-600/30 border-t-blue-600 rounded-full animate-spin mb-2"></div>

                                                                    <span className="text-[10px] font-bold text-slate-400 tracking-tighter">Âä†ËΩΩÂÜÖÂÆπ‰∏≠...</span>

                                                                </div>

                                                                {/* Thumbnail Content */}

                                                                <div className="relative w-full h-full cursor-pointer z-10" onClick={() => setPreviewFile(file)}>

                                                                    {

                                                                        file.type.startsWith('video') ? (

                                                                            <>

                                                                                <video

                                                                                    src={file.preview + "#t=0.5"}

                                                                                    className="w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity"

                                                                                    preload="metadata"

                                                                                    muted

                                                                                />

                                                                                {/* Video indicator badge */}

                                                                                <div className="absolute bottom-10 left-2 p-1 bg-black/40 backdrop-blur-md rounded-lg group-hover:bg-blue-600 transition-colors">

                                                                                    <Icon name="play" size={12} className="text-white" />

                                                                                </div>

                                                                            </>

                                                                        ) : (

                                                                            <img src={file.preview} className="w-full h-full object-cover" />

                                                                        )

                                                                    }

                                                                </div>

                                                                {/* RED X DELETE BUTTON - FIXED TOP RIGHT */}

                                                                <button

                                                                    onClick={(e) => { e.stopPropagation(); removeFile(index); }}

                                                                    className="absolute top-2 right-2 w-7 h-7 rounded-full bg-red-500 text-white flex items-center justify-center shadow-lg hover:bg-red-600 transition-all z-20 hover:scale-110 active:scale-95"

                                                                    title="Remove file"

                                                                >

                                                                    <Icon name="plus" size={18} className="rotate-45" />

                                                                </button>

                                                                {/* Label Overlay */}

                                                                <div className="absolute inset-x-0 bottom-0 bg-black/50 backdrop-blur-sm p-2 pointer-events-none text-center z-20">

                                                                    <p className="text-[10px] text-white truncate font-bold">{file.name}</p>

                                                                </div>

                                                            </div>

                                                        ))

                                                        }

                                                    </div>

                                                )}

                                        </div>

                                    </div>

                                    {/* Preview Modal - Enhanced for validation */}

                                    {previewFile && (

                                        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-3xl p-4 sm:p-20 animate-in fade-in duration-300"

                                            onClick={() => setPreviewFile(null)}>

                                            <div className="relative w-full max-w-5xl h-full flex flex-col items-center justify-center" onClick={e => e.stopPropagation()}>

                                                <button className="absolute -top-12 -right-4 w-12 h-12 rounded-full bg-red-500 text-white flex items-center justify-center hover:bg-red-600 transition-all shadow-xl hover:scale-110"

                                                    onClick={

                                                        () => setPreviewFile(null)}>

                                                    <Icon name="plus" size={32} className="rotate-45" />

                                                </button>

                                                <div className="w-full h-full max-h-[80vh] bg-slate-900 rounded-[40px] overflow-hidden shadow-2xl flex items-center justify-center border-[6px] border-white/10">

                                                    {previewFile.type.startsWith('video') ? (

                                                        <video src={previewFile.preview} controls autoPlay className="max-w-full max-h-full" />

                                                    ) : (

                                                        <img src={previewFile.preview} className="max-w-full max-h-full object-contain" />

                                                    )}

                                                </div>

                                                <p className="mt-6 text-white font-bold text-xl tracking-wide drop-shadow-lg">{previewFile.name}</p>

                                            </div>

                                        </div>

                                    )}

                                </div>

                                {/* Footer Actions */}

                                <div className="p-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between shrink-0">

                                    <button

                                        onClick={() => setIsScheduleModalOpen(true)}

                                        className="flex items-center gap-2 px-6 py-3 rounded-xl text-slate-500 font-bold text-sm hover:bg-white hover:text-slate-800 hover:shadow-sm transition-all"

                                    >

                                        <Icon name="clock" size={18} />

                                        <span>{scheduledTime ? `ÂÆöÊó∂: ${scheduledTime.toLocaleDateString()} ${scheduledTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}` : 'ÂÆöÊó∂ÂèëÂ∏É'}</span>

                                    </button>

                                    <button

                                        onClick={handlePublish}

                                        disabled={publishing}

                                        className={`relative overflow-hidden flex items-center gap-3 px-10 py-3 rounded-xl text-white font-bold text-sm shadow-xl shadow-slate-900/30 transition-all transform hover:-translate-y-1 ripple-container btn-press ${publishing ? 'bg-slate-400 cursor-not-allowed'

                                            : 'bg-gradient-to-r from-slate-900 to-slate-700 hover:from-slate-800 hover:to-slate-600'

                                            }`}

                                    >


                                        {publishing ? (

                                            <>

                                                <div className="spinner-dual scale-50"></div>

                                                <span>ÂèëÂ∏É‰∏≠...</span>

                                            </>

                                        ) : (

                                            <>

                                                <Icon name="send" size={16} className="transition-transform group-hover:translate-x-1" />

                                                <span>Á´ãÂç≥ÂèëÂ∏É</span>

                                            </>

                                        )}

                                    </button>

                                </div>

                            </div>

                        </div>

                        {/* Right: Phone Preview - Adjusted for Light Theme */}

                        <div className="hidden xl:flex flex-col w-[340px] shrink-0 items-center justify-center relative z-10">

                            {/* Phone Mockup Frame */}

                            <div className="relative w-[280px] h-[560px] bg-slate-900 rounded-[36px] shadow-2xl border-[6px] border-slate-900 overflow-hidden ring-4 ring-slate-200">

                                {/* Dynamic Island / Notch */}

                                <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-black rounded-b-2xl z-20"></div>

                                {/* Screen Content - Preview */}

                                <div className="w-full h-full bg-white relative flex flex-col">

                                    {/* Header */}

                                    <div className="h-24 bg-gradient-to-b from-slate-100 to-white px-5 pt-10 pb-4 flex items-center gap-3 border-b border-slate-50">

                                        <div className="w-10 h-10 rounded-full bg-slate-200 overflow-hidden border-2 border-white shadow-sm">

                                            {selectedAccounts.length > 0 && accounts.find(a => a.id === selectedAccounts[0])?.avatar ? (

                                                <img src={accounts.find(a => a.id === selectedAccounts[0])?.avatar} className="w-full h-full object-cover" />

                                            ) : (

                                                <div className="w-full h-full flex items-center justify-center text-slate-400">

                                                    <Icon name="user" size={20} />

                                                </div>

                                            )}

                                        </div>

                                        <div className="flex-1 min-w-0">

                                            <p className="text-sm font-bold text-slate-900 truncate">

                                                {selectedAccounts.length > 0 ? accounts.find(a => a.id === selectedAccounts[0])?.name || 'Selected'

                                                    : 'È¢ÑËßàÁî®Êà∑'}

                                            </p>

                                            <p className="text-[10px] text-slate-400">ÂàöÂàö ‚Ä¢ ÂÖ¨ÂºÄ</p>

                                        </div>

                                        <Icon name="more-horizontal" size={16} className="text-slate-400" />

                                    </div>

                                    {/* Content Body */}

                                    <div className="flex-1 overflow-y-auto p-0 scrollbar-hide">

                                        {postContent ? (

                                            <p className="px-5 py-4 text-sm text-slate-800 leading-relaxed whitespace-pre-wrap">{postContent}</p>

                                        ) : (

                                            <div className="px-5 py-8 text-center">

                                                <p className="text-xs text-slate-300 italic">Preview your content here...</p>

                                            </div>

                                        )}

                                        {/* Media Preview in Phone */}

                                        {mediaFiles.length > 0 && (

                                            <div className="mt-2">

                                                {mediaFiles.length === 1 ? (

                                                    <div className="w-full aspect-[4/5] bg-slate-100">

                                                        {mediaFiles[0].type.startsWith('video') ? (

                                                            <video src={mediaFiles[0].preview} className="w-full h-full object-cover" autoPlay muted loop playsInline />

                                                        ) : (

                                                            <img src={mediaFiles[0].preview} className="w-full h-full object-cover" />

                                                        )}

                                                    </div>

                                                ) : (

                                                    <div className="grid grid-cols-2 gap-0.5">

                                                        {mediaFiles.slice(0, 4).map((file, i) => (

                                                            <div key={i} className="aspect-square bg-slate-100 relative">

                                                                {file.type.startsWith('video') ? (

                                                                    <video src={file.preview} className="w-full h-full object-cover" muted />

                                                                ) : (

                                                                    <img src={file.preview} className="w-full h-full object-cover" />

                                                                )}

                                                                {i === 3 && mediaFiles.length > 4 && (

                                                                    <div className="absolute inset-0 bg-black/50 flex items-center justify-center text-white font-bold text-lg">

                                                                        +{mediaFiles.length - 4}

                                                                    </div>

                                                                )}

                                                            </div>

                                                        ))}

                                                    </div>

                                                )}

                                            </div>

                                        )}

                                    </div>

                                    {/* Interaction Bar */}

                                    <div className="h-14 px-5 flex items-center justify-between border-t border-slate-50 text-slate-400">

                                        <div className="flex gap-4">

                                            <Icon name="heart" size={20} />

                                            <Icon name="message-circle" size={20} />

                                            <Icon name="send" size={20} />

                                        </div>

                                        <Icon name="bookmark" size={20} />

                                    </div>

                                </div>

                            </div>

                        </div>

                    </div>

                    {/* Schedule Modal */}

                    {

                        isScheduleModalOpen && (

                            <ScheduleModal

                                onClose={() => setIsScheduleModalOpen(false)}

                                onConfirm={(date) => {

                                    setScheduledTime(date);
                                    setIsScheduleModalOpen(false);
                                    showStatus('success', `Scheduled time set: ${date.toLocaleString()}`);

                                }}

                            />

                        )

                    }

                </>

            );

        };

        function CreateConfirmModal({ onConfirm, onCancel }) {

            return (

                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">

                    <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-md" onClick={onCancel}></div>

                    <div className="bg-white rounded-[32px] w-full max-w-sm p-10 shadow-2xl relative animate-in fade-in zoom-in duration-300 text-center">

                        <div className="w-20 h-20 bg-blue-50 text-blue-600 rounded-[24px] flex items-center justify-center mx-auto mb-6 shadow-inner">

                            <Icon name="zap" size={40} />

                        </div>

                        <h2 className="text-2xl font-extrabold text-slate-900 mb-2 tracking-tight">ÂèëÂ∏ÉÊñ∞Êô∫ËÉΩ‰Ωì</h2>
                        <p className="text-slate-500 text-sm mb-8 leading-relaxed font-medium">
                            ÂáÜÂ§áÂ•ΩÂºÄÂêØÊÇ®ÁöÑÂàõÊÑè‰πãÊóÖ‰∫ÜÂêóÔºü <br />ÁÇπÂáªÁ°ÆËÆ§ËøõÂÖ•È´òÁ∫ßÁºñÊéí‰∏≠ÂøÉ
                        </p>
                        <div className="flex flex-col gap-3">
                            <button
                                onClick={onConfirm}
                                className="w-full py-4 bg-slate-900 text-white rounded-[20px] font-bold shadow-xl shadow-slate-900/20 hover:-translate-y-1 transition-all active:scale-95"
                            >
                                ÊòØÁöÑÔºåÁé∞Âú®ÂºÄÂßã
                            </button>
                            <button
                                onClick={onCancel}
                                className="w-full py-4 bg-slate-50 text-slate-400 rounded-[20px] font-bold hover:bg-slate-100 transition-all"
                            >
                                ÊàëÂÜçÈÄõÈÄõ
                            </button>
                        </div>

                    </div>

                </div>

            );

        }

        // Áä∂ÊÄÅÈÄöÁü•Ê®°ÊÄÅÁªÑ‰ª∂
        const StatusModal = ({ isOpen, type, message, onClose }) => {
            if (!isOpen) return null;

            const isSuccess = type === 'success';

            // Êô∫ËÉΩÊ†áÈ¢òÔºöÊ†πÊçÆÊ∂àÊÅØÂÜÖÂÆπÂà§Êñ≠Êìç‰ΩúÁ±ªÂûã
            let titleText = isSuccess ? 'Êìç‰ΩúÊàêÂäü' : 'Êèê‰∫§Â§±Ë¥•';
            if (isSuccess && message) {
                if (message.includes('Delete') || message.includes('Remove')) {
                    titleText = 'Âà†Èô§ÊàêÂäü';
                } else if (message.includes('Publish') || message.includes('ÂèëÂ∏É')) {
                    titleText = 'ÂèëÂ∏ÉÊàêÂäü';
                } else if (message.includes('Subscribe') || message.includes('ËÆ¢ÈòÖ')) {
                    titleText = 'ËÆ¢ÈòÖÊàêÂäü';
                } else if (message.includes('Save') || message.includes('‰øùÂ≠ò')) {
                    titleText = '‰øùÂ≠òÊàêÂäü';
                }
            }

            // 3ÁßíÂêéËá™Âä®ÂÖ≥Èó≠
            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="fixed inset-0 z-[300] flex items-center justify-center p-4">
                    {/* ÂçäÈÄèÊòéËÉåÊôØÈÅÆÁΩ© */}
                    <div className="absolute inset-0 bg-slate-950/40 backdrop-blur-sm animate-in fade-in duration-300" onClick={onClose}></div>

                    {/* ÈÄöÁü•Âç°Áâá */}
                    <div className={`bg-[#1a1c2e] rounded-3xl w-full max-w-md p-6 shadow-[0_20px_60px_rgba(0,0,0,0.5)] border ${isSuccess ? 'border-emerald-500/20' : 'border-red-500/20'} relative overflow-hidden backdrop-blur-xl animate-in zoom-in duration-300 z-10`}>


                        <div className="flex items-start gap-4">
                            {/* ÂõæÊ†á */}
                            <div className={`w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 ${isSuccess ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'bg-red-500/10 text-red-400 border border-red-500/20'}`}>
                                <Icon name={isSuccess ? "check" : "shield-alert"} size={24} />
                            </div>

                            {/* ÂÜÖÂÆπ */}
                            <div className="flex-1 min-w-0">
                                <h3 className="text-xl font-black text-white mb-1 tracking-tight">
                                    {titleText}
                                </h3>
                                <p className="text-slate-400 text-sm leading-relaxed font-medium">
                                    {message}
                                </p>
                            </div>

                            {/* ÂÖ≥Èó≠ÊåâÈíÆ */}
                            <button
                                onClick={onClose}
                                className="text-slate-500 hover:text-white transition-colors p-1 shrink-0"
                            >
                                <Icon name="x" size={18} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Êó•ÊúüÊó∂Èó¥ÈÄâÊã©Âô®Ê®°ÊÄÅÁªÑ‰ª∂
        function ScheduleModal({ onClose, onConfirm }) {

            const [selectedDate, setSelectedDate] = React.useState(new Date());

            const [currentMonth, setCurrentMonth] = useState(new Date());

            const formatDateTime = (date) => {

                const year = date.getFullYear();

                const month = String(date.getMonth() + 1).padStart(2, '0');

                const day = String(date.getDate()).padStart(2, '0');

                const hours = String(date.getHours()).padStart(2, '0');

                const minutes = String(date.getMinutes()).padStart(2, '0');

                return `${year}/${month}/${day} ${hours}:${minutes}`;

            };

            const getDaysInMonth = (date) => {

                const year = date.getFullYear();

                const month = date.getMonth();

                const firstDay = new Date(year, month, 1);

                const lastDay = new Date(year, month + 1, 0);

                const daysInMonth = lastDay.getDate();

                const startingDayOfWeek = firstDay.getDay();

                const days = [];

                for (let i = 0; i < startingDayOfWeek; i++) {

                    days.push(null);

                }

                for (let i = 1; i <= daysInMonth; i++) {

                    days.push(new Date(year, month, i));

                }

                return days;

            };

            const days = getDaysInMonth(currentMonth);

            const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            const isSameDay = (date1, date2) => {

                return date1.getDate() === date2.getDate() &&

                    date1.getMonth() === date2.getMonth() &&

                    date1.getFullYear() === date2.getFullYear();

            };

            const prevMonth = () => {

                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1));

            };

            const nextMonth = () => {

                setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1));

            };

            const handleTimeChange = (field, value) => {

                const newDate = new Date(selectedDate);

                if (field === 'hours') {

                    newDate.setHours(parseInt(value) || 0);

                } else if (field === 'minutes') {

                    newDate.setMinutes(parseInt(value) || 0);

                }

                setSelectedDate(newDate);

            };

            return (

                <div className="fixed inset-0 z-[120] flex items-center justify-center p-4">

                    <div className="absolute inset-0 bg-white/80 backdrop-blur-md" onClick={onClose}></div>

                    <div className="bg-white rounded-[32px] w-full max-w-md shadow-2xl relative animate-in zoom-in duration-300 border border-slate-200">

                        <div className="p-6 border-b border-slate-100 flex items-center justify-between">

                            <div className="flex items-center gap-3">

                                <div className="w-10 h-10 bg-blue-50 rounded-xl flex items-center justify-center">

                                    <Icon name="clock" size={20} className="text-blue-600" />

                                </div>

                                <div>

                                    <h3 className="text-lg font-bold text-slate-900">ËÆæÁΩÆÂÆöÊó∂ÂèëÂ∏ÉÊó∂Èó¥</h3>

                                    <p className="text-sm text-slate-500">{formatDateTime(selectedDate)}</p>

                                </div>

                            </div>

                            <button onClick={onClose} className="text-slate-400 hover:text-slate-700 transition-colors">

                                <Icon name="plus" className="rotate-45" size={24} />

                            </button>

                        </div>

                        <div className="p-6">

                            <div className="flex items-center justify-between mb-4">

                                <button

                                    onClick={prevMonth}

                                    className="p-2 hover:bg-slate-100 rounded-lg transition-colors"

                                >

                                    <Icon name="chevron-left" size={20} className="text-slate-600" />

                                </button>

                                <h4 className="text-sm font-bold text-slate-900">

                                    {currentMonth.toLocaleString('default', { month: 'long' })} {currentMonth.getFullYear()}

                                </h4>

                                <button

                                    onClick={nextMonth}

                                    className="p-2 hover:bg-slate-100 rounded-lg transition-colors"

                                >

                                    <Icon name="chevron-right" size={20} className="text-slate-600" />

                                </button>

                            </div>

                            <div className="grid grid-cols-7 gap-1 mb-2">

                                {weekDays.map(day => (

                                    <div key={day} className="text-center text-sm font-bold text-slate-400 py-2">

                                        {day}

                                    </div>

                                ))}

                            </div>

                            <div className="grid grid-cols-7 gap-1">

                                {days.map((day, index) => {

                                    if (!day) {

                                        return <div key={index} className="aspect-square"></div>;

                                    }

                                    const isSelected = isSameDay(day, selectedDate);

                                    const isToday = isSameDay(day, new Date());

                                    return (

                                        <button

                                            key={index}

                                            onClick={() => {

                                                const newDate = new Date(selectedDate);

                                                newDate.setFullYear(day.getFullYear());

                                                newDate.setMonth(day.getMonth());

                                                newDate.setDate(day.getDate());

                                                setSelectedDate(newDate);

                                            }}

                                            className={`aspect-square rounded-lg text-base font-medium transition-all ${isSelected ? 'bg-blue-600 text-white shadow-lg shadow-blue-600/30'

                                                : isToday ? 'bg-blue-50 text-blue-600 font-bold'

                                                    : 'hover:bg-slate-100 text-slate-700'

                                                }`}

                                        >

                                            {day.getDate()}

                                        </button>

                                    );

                                })}

                            </div>

                            <div className="mt-6 pt-6 border-t border-slate-100">

                                <label className="text-xs font-bold text-slate-600 uppercase tracking-wider mb-3 block">

                                    ÈÄâÊã©Êó∂Èó¥

                                </label>

                                <div className="flex items-center gap-3">

                                    <div className="flex-1">

                                        <input

                                            type="number"

                                            min="0"

                                            max="23"

                                            value={selectedDate.getHours()}

                                            onChange={(e) => handleTimeChange('hours', e.target.value)}

                                            className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-center text-lg font-bold text-slate-900 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all"

                                        />

                                        <p className="text-sm text-slate-400 text-center mt-1 font-medium">Êó∂</p>

                                    </div>

                                    <span className="text-2xl font-bold text-slate-300">:</span>

                                    <div className="flex-1">

                                        <input

                                            type="number"

                                            min="0"

                                            max="59"

                                            value={selectedDate.getMinutes()}

                                            onChange={(e) => handleTimeChange('minutes', e.target.value)}

                                            className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-center text-lg font-bold text-slate-900 outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all"

                                        />

                                        <p className="text-sm text-slate-400 text-center mt-1 font-medium">ÂàÜ</p>

                                    </div>

                                </div>

                            </div>

                        </div>

                        <div className="p-6 border-t border-slate-100 flex gap-3">

                            <button

                                onClick={onClose}

                                className="flex-1 py-3 bg-slate-100 text-slate-700 rounded-xl font-bold text-sm hover:bg-slate-200 transition-all"
                            >
                                ÂèñÊ∂à
                            </button>

                            <button

                                onClick={() => onConfirm(selectedDate)}

                                className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold text-sm hover:bg-blue-700 shadow-lg shadow-blue-600/30 transition-all"

                            >

                                Á°ÆËÆ§ÂÆöÊó∂ÂèëÂ∏É
                            </button>

                        </div>

                    </div>

                </div >

            );

        };

        const CustomConfirmModal = ({ title, message, onConfirm, onCancel, confirmText = "Á°ÆÂÆö", cancelText = "ÂèñÊ∂à" }) => {
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-md animate-in fade-in duration-300">
                    <div className="glass-card w-full max-w-sm rounded-[32px] p-8 border border-white/10 shadow-2xl scale-up">
                        <div className="flex flex-col items-center text-center">
                            <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-orange-400 to-red-500 flex items-center justify-center text-white mb-6 shadow-lg shadow-orange-500/20">
                                <Icon name="alert-triangle" size={32} />
                            </div>
                            <h3 className="text-xl font-bold text-white mb-2">{title}</h3>
                            <p className="text-slate-400 leading-relaxed mb-8">{message}</p>
                            <div className="flex gap-4 w-full">
                                <button
                                    onClick={onCancel}
                                    className="flex-1 py-3.5 bg-slate-800 text-white rounded-2xl font-bold text-sm hover:bg-slate-700 transition-all border border-white/5 active:scale-95"
                                >
                                    {cancelText}
                                </button>
                                <button
                                    onClick={onConfirm}
                                    className="flex-1 py-3.5 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-2xl font-bold text-sm hover:from-orange-400 hover:to-red-500 shadow-lg shadow-orange-600/30 transition-all active:scale-95"
                                >
                                    {confirmText}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        function AgentEditorView({ onBack, showStatus }) {

            const [name, setName] = useState('ÁàÜÊ¨æÁü≠ÂâßÂâßÊú¨Âä©Êâã');
            const [desc, setDesc] = useState('‰∏ì‰∏∫Áü≠ÂâßÂàõ‰ΩúËÄÖËÆæËÆ°Ôºå‰∏ÄÈîÆÁîüÊàêÂ∏¶ÊúâÈªÑÈáë3ÁßíÈí©Â≠êÁöÑÁàÜÊ¨æÂâßÊú¨„ÄÇ');
            const [logic, setLogic] = useState(`# ËßíËâ≤\nÊÇ®ÊòØ‰∏Ä‰ΩçÁªèÈ™å‰∏∞ÂØåÁöÑÁü≠ÂâßÁºñÂâßÔºåÁ≤æÈÄö Reels Âíå TikTok Âπ≥Âè∞ÁöÑÁàÜÊ¨æÈÄªËæë„ÄÇ\n\n# ‰ªªÂä°\n1. Ê†πÊçÆÁî®Êà∑ÁöÑ‰∏ªÈ¢òÂàõ‰ΩúÂâßÊú¨Â§ßÁ∫≤ÔºåÂåÖÊã¨‚ÄúÈªÑÈáë3Áßí‚Äù„ÄÅ‚ÄúÂâßÊÉÖÂèçËΩ¨‚ÄùÂíå‚Äú‰∏ãÈõÜÈ¢ÑÂëä‚Äù„ÄÇ\n2. ‰ΩøÁî®ÁÆÄÊ¥Å„ÄÅÊúóÊúó‰∏äÂè£‰∏îËäÇÂ•èÊÑüÂº∫ÁöÑËØ≠Ë®Ä„ÄÇ\n3. Ëá™Âä®ÂåπÈÖçÂêàÈÄÇÁöÑËÉåÊôØÈü≥‰πêÈ£éÊ†ºÂª∫ËÆÆ„ÄÇ`);

            const [isPublishing, setIsPublishing] = useState(false);

            const handlePublish = async () => {

                if (!name || !desc) {
                    showStatus('error', 'ËØ∑Â°´ÂÜôÂêçÁß∞ÂíåÊèèËø∞');
                    return;
                }

                setIsPublishing(true);

                try {

                    const response = await fetch(`${API_BASE}/api/agents`, {

                        method: 'POST',

                        headers: {

                            'Content-Type': 'application/json'

                        },

                        body: JSON.stringify({

                            name,

                            description: desc,

                            logic,

                            tags: 'Short Drama, Script', // Default tags

                            icon: 'video',

                            price: '20.00',

                            author: CURRENT_USER.name

                        })

                    });

                    const result = await response.json();

                    if (result.success) {

                        showStatus('success', 'ÂÜÖÂÆπÂèëÂ∏ÉÊàêÂäüÔºÅÂ∑≤Êèê‰∫§Ëá≥Êô∫ËÉΩ‰ΩìÂπøÂú∫');

                        onBack();

                    } else {

                        showStatus('error', 'ÂèëÂ∏ÉÂ§±Ë¥•: ' + result.error);
                    }
                } catch (error) {
                    showStatus('error', 'ÁΩëÁªúËøûÊé•ÈîôËØØÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°');

                } finally {

                    setIsPublishing(false);

                }

            };

            return (

                <div className="fixed inset-0 z-[70] bg-slate-900/95 backdrop-blur-xl flex flex-col animate-in fade-in duration-300">

                    {/* Header */}

                    <header className="h-16 bg-slate-800/30 backdrop-blur-xl border-b border-purple-500/20 px-6 flex items-center justify-between shrink-0">

                        <div className="flex items-center gap-4">

                            <button onClick={onBack} className="p-2 hover:bg-slate-50 rounded-lg text-slate-400 transition-colors">

                                <Icon name="chevron-left" size={24} />

                            </button>

                            <div className="h-6 w-[1px] bg-slate-100 mx-2"></div>

                            <div className="flex items-center gap-3">

                                <div className="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center font-bold">

                                    <Icon name="zap" size={18} />

                                </div>

                                <h2 className="text-base font-bold text-white leading-none">{name || 'Êñ∞Êô∫ËÉΩ‰Ωì'}</h2>

                            </div>

                        </div>

                        <div className="flex items-center gap-3">

                            <button className="px-5 py-2 rounded-xl text-slate-300 font-bold text-sm hover:bg-white/10 transition-all border border-transparent">

                                ‰øùÂ≠òËçâÁ®ø
                            </button>

                            <button

                                onClick={handlePublish}

                                disabled={isPublishing}

                                className="px-6 py-2.5 bg-blue-600 text-white rounded-xl font-bold text-sm shadow-lg shadow-blue-500/20 hover:bg-blue-700 transition-all active:scale-95 disabled:bg-slate-300 disabled:shadow-none"

                            >

                                {isPublishing ? 'ÂèëÂ∏É‰∏≠...' : 'ÂèëÂ∏É'}

                            </button>

                        </div>

                    </header>

                    {/* Editor Content */}

                    <main className="flex-1 flex overflow-hidden">

                        {/* Left: Configuration */}

                        <div className="w-[60%] flex flex-col bg-white border-r border-slate-100">

                            <div className="h-14 border-b border-slate-50 px-8 flex items-center" >

                                <span className="text-sm font-bold text-blue-600 flex items-center gap-2">

                                    <Icon name="edit" size={14} />

                                    Ê†∏ÂøÉÈÖçÁΩÆ
                                </span>

                            </div>

                            <div className="flex-1 overflow-y-auto p-10 space-y-10 custom-scrollbar">

                                {/* Name & Description */}

                                <div className="grid grid-cols-1 gap-8">

                                    <div className="space-y-3">

                                        <label className="text-base font-bold text-slate-800 flex items-center gap-1">

                                            Êô∫ËÉΩ‰ΩìÂêçÁß∞ <span className="text-red-500">*</span>

                                        </label>

                                        <div className="relative">

                                            <input

                                                type="text"

                                                value={name}

                                                onChange={(e) => setName(e.target.value.slice(0, 20))}

                                                placeholder="ÁªôÊÇ®ÁöÑAIËµ∑‰∏Ä‰∏™Âìç‰∫ÆÁöÑÂêçÂ≠ó" className="w-full bg-slate-50 border border-slate-100 rounded-xl p-4 text-base font-medium outline-none focus:border-blue-500/30 focus:bg-white transition-all pr-16"

                                            />

                                            <span className="absolute right-4 top-1/2 -translate-y-1/2 text-sm font-bold text-slate-300 uppercase tracking-widest">{name.length} / 20</span>

                                        </div>

                                    </div>

                                    <div className="space-y-3">

                                        <label className="text-base font-bold text-slate-800 flex items-center gap-1">

                                            ÊèèËø∞ <span className="text-red-500">*</span>

                                        </label>

                                        <div className="relative">

                                            <textarea

                                                value={desc}

                                                onChange={(e) => setDesc(e.target.value.slice(0, 50))}

                                                placeholder="ÁÆÄÁü≠ÊèèËø∞ÂÆÉÁöÑÂäüËÉΩ"

                                                className="w-full bg-slate-100/50 border border-slate-100 rounded-xl p-4 text-base font-medium outline-none focus:border-blue-500/30 focus:bg-white transition-all h-20 resize-none"

                                            ></textarea>

                                            <span className="absolute right-4 bottom-4 text-sm font-bold text-slate-300 uppercase tracking-widest">{desc.length} / 50</span>

                                        </div>

                                    </div>

                                </div>

                                {/* Prompt / Character Logic */}

                                <div className="space-y-4">

                                    <div className="flex items-center justify-between" >

                                        <label className="text-base font-bold text-slate-800 flex items-center gap-1">

                                            ÊèêÁ§∫ËØçËÆæÁΩÆ (Ê†∏ÂøÉÈÄªËæë) <span className="text-red-500">*</span>

                                        </label>

                                        <button className="text-blue-600 text-sm font-black uppercase tracking-tighter flex items-center gap-1 hover:opacity-80 transition-all px-2 py-1 bg-blue-50 rounded-lg border border-blue-100">

                                            <Icon name="stars" size={12} />

                                            AI Êô∫ËÉΩ‰ºòÂåñ
                                        </button>

                                    </div>

                                    <textarea

                                        value={logic}

                                        onChange={(e) => setLogic(e.target.value)}

                                        placeholder="ÂÜô‰∏ãÊÇ®ÂØπ AI ÁöÑËØ¶ÁªÜË¶ÅÊ±Ç..."

                                        className="w-full bg-slate-800/30 border border-purple-500/20 rounded-2xl p-6 font-mono text-base leading-relaxed text-slate-200 shadow-inner min-h-[300px] outline-none focus:bg-slate-800/50 focus:border-purple-500/40 transition-all resize-none custom-scrollbar placeholder:text-slate-500"

                                    ></textarea>

                                </div>

                            </div>

                        </div>

                        {/* Right: Preview */}

                        <div className="flex-1 bg-slate-50 flex flex-col p-8">

                            <div className="flex items-center justify-between mb-6" >

                                <h3 className="text-base font-bold text-slate-800 uppercase tracking-widest flex items-center gap-2">

                                    ËÅäÂ§©ÊµãËØï
                                </h3>
                                <span className="text-sm text-slate-300 font-medium tracking-wider">ÂÆûÊó∂È¢ÑËßà </span>

                            </div>

                            <div className="flex-1 bg-white rounded-[32px] shadow-2xl flex flex-col overflow-hidden border border-slate-100 scale-95 origin-top transition-transform">

                                {/* Chat Header */}

                                <div className="h-16 px-6 flex items-center gap-3 border-b border-slate-50">

                                    <div className="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center">

                                        <Icon name="zap" size={18} />

                                    </div>

                                    <span className="text-base font-bold text-slate-800">{name || 'Êñ∞Êô∫ËÉΩ‰Ωì'}</span>

                                </div>

                                {/* Chat area */}

                                <div className="flex-1 p-8 flex flex-col items-center justify-center text-center space-y-4">

                                    <div className="w-16 h-16 bg-slate-50 text-slate-200 rounded-3xl flex items-center justify-center">

                                        <Icon name="message-square" size={32} />

                                    </div>

                                    <p className="text-base font-bold text-slate-400">ËÆæÁΩÆÂÆåÊàêÂêéÂú®Ê≠§Â§ÑÊµãËØïÂØπËØù</p>

                                </div>

                                {/* Input bar */}

                                <div className="p-6" >

                                    <div className="bg-slate-50 rounded-2xl p-4 flex items-center gap-3 border border-slate-100">

                                        <input type="text" placeholder="ËæìÂÖ•‰ª•ÊµãËØï..." className="flex-1 bg-transparent text-base font-medium outline-none text-slate-700 placeholder:text-slate-300" />

                                        <button className="w-8 h-8 rounded-xl bg-slate-200 text-white flex items-center justify-center transition-all">

                                            <Icon name="send" size={16} className="-rotate-90" />

                                        </button>

                                    </div>

                                </div>

                            </div>

                        </div>

                    </main >

                </div>

            );

        };

        const AIAgentsView = ({

            setActiveTab, setMediaFiles, setPostContent, showStatus }) => {

            const [isEditorOpen, setIsEditorOpen] = useState(false);

            const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);

            const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);

            const [isDetailsModalOpen, setIsDetailsModalOpen] = useState(false);
            const [isSuccessModalOpen, setIsSuccessModalOpen] = useState(false);

            const [isChatOpen, setIsChatOpen] = useState(false);

            const [selectedAgent, setSelectedAgent] = useState(null);

            const [agents, setAgents] = useState([]);

            const [loading, setLoading] = useState(true);

            const [activeFilter, setActiveFilter] = useState('ÂÖ®ÈÉ®');

            const [confirmData, setConfirmData] = useState({ open: false, id: null, name: '', isSelfCreated: false });

            useEffect(() => {

                fetchAgents();

            }, [isEditorOpen]);

            const fetchAgents = async () => {

                setLoading(true);

                try {

                    const url = `${API_BASE}/api/agents`;

                    console.log('üèóÔ∏è AIAgentsView fetching:', url);

                    const res = await fetch(url);

                    const data = await res.json();

                    // üéñÔ∏è ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºöÂÆòÊñπ {Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à} ÁΩÆÈ°∂ÔºåÂÖ∂‰ΩôÂõ∫ÂÆöÈ°∫Â∫è
                    const highlightName = "Editing Master";

                    // 1. ‰∏çÈúÄË¶ÅÊ¥óÁâåÔºå‰øùÊåÅÂêéÁ´ØËøîÂõûÁöÑÊàñÈªòËÆ§ÁöÑÁ®≥ÂÆöÈ°∫Â∫è
                    // 2. Â∞ÜÊåáÂÆöÁöÑÂÆòÊñπÂä©ÊâãÁßªÂä®Âà∞ÊúÄÂâçÈù¢
                    const highlighted = data.filter(a => a.name === highlightName || a.name === "Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à");
                    const others = data.filter(a => a.name !== highlightName && a.name !== "Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à");
                    const sortedData = [...highlighted, ...others];

                    setAgents(sortedData);
                    console.log('‚úÖ AIAgentsView loaded (Stable Sort):', sortedData.length, 'agents');

                } catch (error) {

                    console.error('Fetch agents error:', error);

                } finally {

                    setLoading(false);

                }

            };

            if (isEditorOpen) {

                return <AgentEditorView onBack={() => setIsEditorOpen(false)} showStatus={showStatus} />

            }

            if (isChatOpen && selectedAgent) {
                return <AgentChatView agent={selectedAgent} onBack={() => setIsChatOpen(false)} setActiveTab={setActiveTab} setMediaFiles={setMediaFiles} setPostContent={setPostContent} showStatus={showStatus} />
            }


            return (

                <div className="w-full h-full bg-transparent text-slate-100 overflow-y-auto custom-scrollbar relative">

                    {/* Modals */}

                    {isDetailsModalOpen && (
                        <AgentDetailsModal
                            agent={selectedAgent}
                            setIsSuccessModalOpen={setIsSuccessModalOpen}
                            onClose={() => setIsDetailsModalOpen(false)}
                            onSubscribe={() => {
                                setIsDetailsModalOpen(false);
                                setIsPaymentModalOpen(true);
                            }}
                            onOpenChat={() => {
                                setIsDetailsModalOpen(false);
                                setIsChatOpen(true);
                            }}
                        />
                    )}

                    {isPaymentModalOpen && (
                        <PaymentModal
                            agent={selectedAgent}
                            onClose={() => setIsPaymentModalOpen(false)}
                            onSuccess={async () => {
                                setIsPaymentModalOpen(false);
                                // Record subscription
                                try {
                                    await fetch(`${API_BASE}/api/subscriptions`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ agent_id: selectedAgent.id })
                                    });
                                } catch (e) { console.error('Sub error:', e); }
                                setIsSuccessModalOpen(true);
                            }}
                        />
                    )}

                    {isSuccessModalOpen && (
                        <SubscriptionSuccessModal
                            agent={selectedAgent}
                            onClose={() => setIsSuccessModalOpen(false)}
                            onOpenChat={() => {
                                setIsSuccessModalOpen(false);
                                setIsChatOpen(true);
                            }}
                            onViewMyAgents={() => {
                                setIsSuccessModalOpen(false);
                                setActiveTab('my-agents');
                            }}
                        />
                    )}

                    {isConfirmModalOpen && (

                        <CreateConfirmModal

                            onConfirm={() => {

                                setIsConfirmModalOpen(false);

                                setIsEditorOpen(true);

                            }}

                            onCancel={() => setIsConfirmModalOpen(false)}

                        />

                    )}

                    {/* 1. Top Banner - White Background with Premium Agent Card */}
                    <div className="relative pt-12 pb-10 px-8 border-b border-slate-200 bg-white overflow-hidden">
                        {/* Original Background Decorations */}
                        <div className="absolute inset-0 bg-[radial-gradient(#e2e8f0_1px,transparent_1px)] [background-size:20px_20px] opacity-40"></div>
                        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-50/50 rounded-full blur-3xl pointer-events-none"></div>

                        {/* Background Illustration */}
                        <div className="absolute inset-0 overflow-hidden pointer-events-none">
                            <div className="absolute top-1/2 right-10 -translate-y-1/2 text-slate-100/60 -rotate-12 transform scale-150">
                                <Icon name="cute-robot" size={320} />
                            </div>
                        </div>

                        <div className="max-w-6xl mx-auto flex items-center justify-between relative z-10">
                            {/* Featured Agent Card - ULTRA-COMPACT SIZE */}
                            <div className="max-w-xl w-full bg-gradient-to-br from-[#4c1d95] via-[#1e1b4b] to-[#0f172a] border border-white/10 rounded-3xl p-6 shadow-[0_20px_50px_-12px_rgba(139,92,246,0.3)] relative group overflow-hidden">
                                {/* Enhanced internal glow for depth */}
                                <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_20%_20%,rgba(167,139,250,0.25),transparent_70%)]"></div>
                                <div className="absolute bottom-0 right-0 w-full h-full bg-[radial-gradient(circle_at_80%_80%,rgba(59,130,246,0.15),transparent_70%)]"></div>

                                <div className="space-y-6 relative z-10">
                                    <div className="flex items-center gap-3">
                                        <div className="px-3 py-1 bg-[#ffffff10] backdrop-blur-md text-white/90 rounded-lg text-xs font-bold border border-white/10 flex items-center gap-1.5">
                                            ‰ªäÊó•‰∏ªÊé® ¬∑ ÊòéÊòüÂëòÂ∑•
                                        </div>
                                    </div>

                                    <div className="space-y-3">
                                        <h1 className="text-3xl font-black tracking-tight text-white leading-tight">
                                            Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à <br />
                                            <span className="text-2xl opacity-90">Video Editor</span>
                                        </h1>

                                        <div className="inline-flex items-center px-3 py-1.5 bg-[#00000040] backdrop-blur-sm rounded-lg border border-white/5">
                                            <span className="text-white/90 text-xs font-bold">
                                                L5Á∫ß Êô∫ËÉΩ‰Ωì ¬∑ Êô∫ËÉΩËßÜÈ¢ëÂâ™Ëæë‰∏ìÂÆ∂
                                            </span>
                                        </div>

                                        <p className="text-white/70 text-base font-medium leading-relaxed italic line-clamp-2">
                                            "Êô∫ËÉΩËßÜÈ¢ëÂâ™ËæëÔºåËá™Âä®ÁîüÊàêÁàÜÊ¨æÊïàÊûú„ÄÇ"
                                        </p>
                                    </div>

                                    <div className="flex items-end justify-between pt-2">
                                        <div className="flex items-center gap-3">
                                            <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-400 to-blue-600 flex items-center justify-center text-white shadow-lg border border-white/20 overflow-hidden">
                                                <img src={API_BASE + "/static/official_editor.png"} className="w-full h-full object-cover shadow-inner" />
                                            </div>
                                            <div className="flex flex-col">
                                                <span className="text-[10px] text-white/50 uppercase font-black tracking-widest">Premium Agent</span>
                                                <span className="text-sm text-white font-bold leading-none mt-1">Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à</span>
                                            </div>
                                        </div>

                                        <button
                                            onClick={() => { setSelectedAgent(agents.find(a => a.name === "Editing Master" || a.name === "Áü≠ÂâßÂâ™ËæëÂ§ßÂ∏à") || agents[0]); setIsDetailsModalOpen(true); }}
                                            className="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-500 hover:to-indigo-500 rounded-2xl font-bold text-sm shadow-lg shadow-blue-500/30 flex items-center gap-2 transition-all hover:scale-105 active:scale-95 group relative overflow-hidden"
                                        >
                                            <Icon name="play" size={14} className="fill-current" />
                                            <span>Á´ãÂç≥ËÆ¢ÈòÖ</span>
                                        </button>
                                    </div>
                                </div>

                                {/* Further Scaled Background Robot Icon */}
                                <div className="absolute -bottom-4 -right-8 text-white/10 transform rotate-[5deg] pointer-events-none">
                                    <Icon name="cute-robot" size={240} />
                                </div>
                            </div>

                            {/* Right Action - Creating Agent */}
                            <button
                                onClick={() => setIsConfirmModalOpen(true)}
                                className="px-8 py-4 bg-white border border-slate-200 text-slate-900 rounded-2xl font-bold shadow-sm hover:shadow-md flex items-center gap-3 transition-all hover:scale-105 active:scale-95 group relative overflow-hidden"
                            >
                                <div className="p-1 bg-blue-50 text-blue-600 rounded-lg group-hover:rotate-90 transition-transform duration-300">
                                    <Icon name="plus" size={20} />
                                </div>
                                <span className="text-base text-slate-900">ÂàõÂª∫Êô∫ËÉΩ‰Ωì</span>
                            </button>
                        </div>
                    </div>






                    {/* 2. Content Area */}

                    <div className="max-w-6xl mx-auto px-8 py-8">

                        {/* Filter Bar */}

                        <div className="flex items-center gap-4 mb-10 overflow-x-auto pb-2 no-scrollbar" >

                            <button

                                onClick={() => setActiveFilter('ÂÖ®ÈÉ®')}

                                className={`px-6 py-2.5 rounded-xl text-sm font-bold shadow-lg transition-all flex items-center gap-2 border ${activeFilter === 'ÂÖ®ÈÉ®' ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white border-transparent shadow-purple-500/30' : 'bg-slate-800/50 text-slate-300 border-purple-500/20 hover:bg-slate-700/50 hover:border-purple-500/40'}`}

                            >

                                <Icon name="filter" size={14} />

                                ÂÖ®ÈÉ®ÂàóË°®

                            </button>

                            {

                                ['Áü≠Ââß/ÂõæÂÉè', 'AIËßÜÈ¢ë', 'Êï∞ÊçÆÂàÜÊûê', 'ËÑöÊú¨ÂÜô‰Ωú', 'Êµ∑Â§ñÂá∫Êµ∑'].map(tag => (

                                    <button

                                        key={tag}

                                        onClick={() => setActiveFilter(tag)}

                                        className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all border shadow-lg ${activeFilter === tag ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-transparent shadow-blue-500/30' : 'bg-slate-800/50 text-slate-300 border-blue-500/20 hover:bg-slate-700/50 hover:border-blue-500/40'}`}

                                    >

                                        {tag}

                                    </button>

                                ))}

                        </div>

                        {/* 3. Cards Grid */}

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20" >

                            {/* Agent Cards */}

                            {

                                agents.filter(agent => {
                                    if (activeFilter === 'ÂÖ®ÈÉ®') return true;
                                    const matchTag = activeFilter === 'Áü≠Ââß/ÂõæÂÉè' ? 'Áü≠Ââß' :
                                        activeFilter === 'AIËßÜÈ¢ë' ? 'ËßÜÈ¢ë' :
                                            activeFilter === 'Êï∞ÊçÆÂàÜÊûê' ? 'Êï∞ÊçÆ' :
                                                activeFilter === 'ËÑöÊú¨ÂÜô‰Ωú' ? 'ËÑöÊú¨' :
                                                    activeFilter === 'Êµ∑Â§ñÂá∫Êµ∑' ? 'Âá∫Êµ∑' : activeFilter;
                                    return agent.tags && agent.tags.some(t => t.includes(matchTag) || matchTag.includes(t));
                                }).map(agent => {

                                    const stats = getStableStats(agent.id, agent.name);

                                    return (

                                        <div key={agent.id} className="bg-white rounded-[24px] p-6 border border-slate-100 shadow-lg shadow-slate-200/50 hover:shadow-2xl hover:shadow-blue-500/10 hover:border-blue-500/20 transition-all duration-300 group flex flex-col relative overflow-hidden">

                                            {/* Header */}

                                            <div className="flex justify-between items-start mb-6 relative z-10" >

                                                <div className="relative group/icon">

                                                    <div className={`absolute inset-0 bg-gradient-to-br ${(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')))) ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400'} rounded-2xl blur opacity-75 group-hover/icon:opacity-100 animate-pulse`}></div>

                                                    <div className={`relative w-16 h-16 rounded-2xl bg-gradient-to-br ${(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')))) ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400'} flex items-center justify-center text-white shadow-lg overflow-hidden shadow-purple-500/20 transition-all duration-300 group-hover/icon:scale-110 group-hover/icon:rotate-3`}>

                                                        {((agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')))) && !stats.isSpecial) ? (
                                                            <Icon name={agent.icon || 'zap'} size={28} className="drop-shadow-lg" />
                                                        ) : (
                                                            <img src={stats.avatar} className="w-full h-full object-cover" />
                                                        )}

                                                        <div className="absolute inset-0 rounded-2xl bg-gradient-to-t from-white/20 to-transparent pointer-events-none"></div>

                                                    </div>

                                                </div>

                                                <div className="flex gap-2">

                                                    {(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')))) ? (

                                                        <span className="px-3 py-1.5 bg-blue-50 text-blue-600 text-xs font-bold rounded-lg border border-blue-100 uppercase tracking-wider flex items-center gap-1.5 shadow-sm">
                                                            <Icon name="award" size={12} />
                                                            ÂÆòÊñπ
                                                        </span>
                                                    ) : (
                                                        <div className="flex items-center px-4 py-1.5 bg-slate-50 text-slate-700 text-sm font-bold rounded-xl border border-slate-200 shadow-sm backdrop-blur-md">
                                                            {stats.author}
                                                        </div>
                                                    )}
                                                    {/* ÂÖçË¥π/‰ªòË¥πÊ†áÁ≠æ */}

                                                    {(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || agent.price === 'ÂÖçË¥π' || agent.price === 'Free' || agent.price === 'ÂÖçË¥πËÆ¢ÈòÖ' || agent.price === 'Free Subscription' || agent.price === '0' || agent.price === '¬•0') ? (

                                                        <span className="px-3 py-1.5 bg-green-50 text-green-600 text-xs font-bold rounded-lg border border-green-200 uppercase tracking-wider flex items-center gap-1.5 shadow-sm">
                                                            <Icon name="check" size={12} />
                                                            ÂÖçË¥π
                                                        </span>

                                                    ) : (

                                                        <span className="px-3 py-1.5 bg-amber-50 text-amber-600 text-xs font-bold rounded-lg border border-amber-200 uppercase tracking-wider flex items-center gap-1.5 shadow-sm">

                                                            <Icon name="zap" size={12} />

                                                            ‰ªòË¥π

                                                        </span>

                                                    )}

                                                </div>

                                            </div>

                                            {/* Content */}

                                            <div className="relative z-10 mb-8">

                                                <h3 className="text-xl font-extrabold text-slate-900 mb-3 tracking-tight">{

                                                    agent.name}</h3>

                                                <p className="text-slate-500 text-base leading-relaxed line-clamp-2 h-14 font-medium">

                                                    {agent.description || "Analyze content logic, auto-generate viral copy, boost creation efficiency..."}

                                                </p>

                                            </div>

                                            {/* Stats */}

                                            <div className="grid grid-cols-2 gap-4 mb-8 bg-slate-50 rounded-2xl p-4 border border-slate-100 relative z-10">

                                                <div >

                                                    <p className="text-xl font-bold text-slate-900 tracking-tight">{agent.usage || stats.fans}</p>

                                                    <p className="text-xs text-slate-400 uppercase tracking-widest font-bold mt-0.5">ÁÉ≠Â∫¶/Ë∞ÉÁî®</p>

                                                </div>

                                                <div>

                                                    <p className="text-xl font-bold text-slate-900 tracking-tight">{agent.rating || stats.rating}</p>

                                                    <p className="text-xs text-slate-400 uppercase tracking-widest font-bold mt-0.5">ËØÑÂàÜ</p>

                                                </div>

                                            </div>

                                            {/* Action */}

                                            <button

                                                onClick={() => { setSelectedAgent(agent); setIsDetailsModalOpen(true); }}

                                                className="w-full py-3.5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold text-sm hover:from-blue-500 hover:to-indigo-500 transition-all mt-auto flex items-center justify-center gap-2 relative z-10 shadow-lg shadow-blue-600/40 hover:shadow-blue-500/60 active:scale-95"

                                            >

                                                <Icon name="play" size={14} className="fill-current" />

                                                Á´ãÂç≥ËÆ¢ÈòÖ

                                            </button>

                                        </div>

                                    );

                                })

                            }

                        </div>

                    </div>

                </div >

            );

        };

        const Typewriter = ({ text, speed = 20, delay = 0, onComplete, className = "" }) => {

            const [displayedText, setDisplayedText] = useState('');

            const [started, setStarted] = useState(false);

            const [isComplete, setIsComplete] = useState(false);

            useEffect(() => {

                const timer = setTimeout(() => setStarted(true), delay);

                return () => clearTimeout(timer);

            }, [delay]);

            useEffect(() => {

                if (!started) return;

                if (displayedText.length < text.length) {

                    const timer = setTimeout(() => {

                        setDisplayedText(text.slice(0, displayedText.length + 1));

                    }, speed);

                    return () => clearTimeout(timer);

                } else if (!isComplete && displayedText === text) {

                    setIsComplete(true);

                    if (onComplete) onComplete();

                }

            }, [displayedText, text, speed, onComplete, started, isComplete]);

            return (

                <span className={`${className} relative`}>

                    {displayedText}

                    {started && !isComplete && (

                        <span className="inline-block w-1.5 h-[1.1em] bg-blue-500 ml-1 animate-pulse align-middle" />

                    )}

                </span>

            );

        };

        const SubscriptionLoadingOverlay = ({ agent, message = "Ê≠£Âú®‰∏∫ÊÇ®ÂáÜÂ§áÊô∫ËÉΩ‰Ωì..." }) => {

            return (

                <div className="fixed inset-0 z-[200] flex items-center justify-center bg-slate-900/40 backdrop-blur-2xl animate-in fade-in duration-500">

                    <div className="text-center space-y-8 max-w-sm w-full px-6">

                        <div className="relative inline-block">

                            {/* Outer Glow */}

                            <div className="absolute inset-0 bg-blue-500/30 blur-[40px] rounded-full animate-pulse"></div>

                            {/* Rotating Ring */}

                            <div className="relative w-24 h-24 rounded-full border-4 border-slate-100/10 border-t-blue-500 animate-spin"></div>

                            <div className="absolute inset-0 flex items-center justify-center">
                                {(() => {
                                    const isOfficial = agent?.price === 'ÂÆòÊñπËÉΩÂäõ' || agent?.price === 'Official' || (agent?.author && (agent?.author.includes('ÂÆòÊñπ') || agent?.author.includes('Official')));
                                    const stats = getStableStats(agent?.id, agent?.name);
                                    const gradientClass = isOfficial ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400';
                                    return (
                                        <div className={`relative w-20 h-20 bg-gradient-to-br ${gradientClass} rounded-[28px] flex items-center justify-center text-white shadow-2xl shadow-blue-500/50 overflow-hidden`}>
                                            {(isOfficial && !stats.isSpecial) ? (
                                                <Icon name={agent?.icon || 'zap'} size={40} className="drop-shadow-lg" />
                                            ) : (
                                                <img src={stats.avatar} className="w-full h-full object-cover" />
                                            )}
                                        </div>
                                    );
                                })()}
                            </div>

                        </div>

                        <div className="space-y-3">

                            <h3 className="text-2xl font-black text-white tracking-tight">{message}</h3>

                            <div className="w-full bg-slate-100/10 h-1.5 rounded-full overflow-hidden relative">

                                <div className="absolute inset-0 bg-gradient-to-r from-blue-600 to-indigo-600 w-full animate-[shimmer_2s_infinite] origin-left scale-x-0"

                                    style={{ animationName: 'progressMove', animationDuration: '2s', animationIterationCount: 'infinite' }}></div>

                            </div>



                        </div>

                    </div>

                    <style>{`

                        @keyframes progressMove {

                            0% { transform: scaleX(0); transform-origin: left; }

                            45% { transform: scaleX(1); transform-origin: left; }

                            55% { transform: scaleX(1); transform-origin: right; }

                            100% { transform: scaleX(0); transform-origin: right; }

                        }

                    `}</style>

                </div>

            );

        };

        const SubscriptionSuccessModal = ({ agent, onClose, onOpenChat, onViewMyAgents }) => {
            if (!agent) return null;
            const stats = getStableStats(agent.id, agent.name);
            const isOfficial = agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')));
            const gradientClass = isOfficial ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400';

            return (
                <div className="fixed inset-0 z-[300] flex items-center justify-center p-4 animate-in fade-in duration-300">
                    <div className="absolute inset-0 bg-[#0a0e27]/80 backdrop-blur-xl" onClick={onClose}></div>
                    <div className="bg-[#1a1c2e] border border-white/10 rounded-[40px] w-full max-w-md shadow-2xl relative overflow-hidden flex flex-col items-center p-8 text-center animate-in zoom-in duration-300 z-[310]">
                        {/* Success Icon with Glow */}
                        <div className="relative mb-8">
                            <div className="absolute inset-0 bg-emerald-500/30 blur-2xl rounded-full"></div>
                            <div className="relative w-20 h-20 bg-emerald-500 rounded-full flex items-center justify-center text-white shadow-xl shadow-emerald-500/40">
                                <Icon name="check" size={40} strokeWidth={3} />
                            </div>
                        </div>

                        <h2 className="text-3xl font-black text-white mb-2 tracking-tight">ËÆ¢ÈòÖÊàêÂäüÔºÅ</h2>
                        <p className="text-slate-400 font-medium mb-8">
                            ÊÇ®Â∑≤ÊàêÂäüËÆ¢ÈòÖ <span className="text-blue-400 font-bold">{agent.name}</span>ÔºåÂèØ‰ª•Âú®‚ÄúÊàëÁöÑÊô∫ËÉΩÂõ¢Èòü‚ÄùÊùøÂùóÈöèÊó∂Êü•Áúã‰∏é‰ΩøÁî®„ÄÇ
                        </p>

                        {/* Agent Preview */}
                        <div className="w-full bg-white/5 rounded-3xl p-6 mb-8 border border-white/5 flex items-center gap-4">
                            <div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${gradientClass} flex items-center justify-center text-white overflow-hidden shadow-lg`}>
                                {(isOfficial && !stats.isSpecial) ? (
                                    <Icon name={agent.icon || 'zap'} size={32} />
                                ) : (
                                    <img src={stats.avatar} className="w-full h-full object-cover" />
                                )}
                            </div>
                            <div className="text-left">
                                <p className="text-white font-bold text-lg">{agent.name}</p>
                                <p className="text-slate-400 text-xs font-medium">{agent.tags?.[0] || 'AI Intelligence'}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 gap-4 w-full">
                            <button
                                onClick={onOpenChat}
                                className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-black text-sm shadow-xl shadow-blue-500/30 hover:shadow-blue-500/50 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2"
                            >
                                <Icon name="message-square" size={18} />
                                Á´ãÂç≥Ë∑≥ËΩ¨‰ΩøÁî®
                            </button>
                            <button
                                onClick={onClose}
                                className="w-full py-4 bg-white/5 text-slate-300 rounded-2xl font-bold text-sm hover:bg-white/10 transition-all active:scale-[0.98] border border-white/5"
                            >
                                ÂÖ≥Èó≠
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const PublishSuccessModal = ({ publishedAccounts, onClose, onViewHistory }) => {
            if (!publishedAccounts || publishedAccounts.length === 0) return null;

            const handleViewHomepages = () => {
                const platformLinks = {
                    'TIKTOK': 'https://www.tiktok.com/@',
                    'YOUTUBE': 'https://www.youtube.com/@',
                    'TWITTER': 'https://x.com/',
                    'X': 'https://x.com/',
                    'FACEBOOK': 'https://www.facebook.com/'
                };

                publishedAccounts.forEach(acc => {
                    const platform = (acc.platform || acc.type || '').toUpperCase();
                    const baseUrl = platformLinks[platform];
                    if (baseUrl) {
                        const handle = acc.handle || acc.name;
                        window.open(`${baseUrl}${handle}`, '_blank');
                    }
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 z-[300] flex items-center justify-center p-4 animate-in fade-in duration-300">
                    <div className="absolute inset-0 bg-[#0a0e27]/80 backdrop-blur-xl" onClick={onClose}></div>
                    <div className="bg-[#1a1c2e] border border-white/10 rounded-[40px] w-full max-w-md shadow-2xl relative overflow-hidden flex flex-col items-center p-8 text-center animate-in zoom-in duration-300 z-[310]">
                        {/* Success Icon with Glow */}
                        <div className="relative mb-8">
                            <div className="absolute inset-0 bg-blue-500/30 blur-2xl rounded-full"></div>
                            <div className="relative w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center text-white shadow-xl shadow-blue-500/40">
                                <Icon name="check" size={40} strokeWidth={3} />
                            </div>
                        </div>

                        <h2 className="text-3xl font-black text-white mb-2 tracking-tight">ÂèëÂ∏ÉÊàêÂäüÔºÅ</h2>
                        <p className="text-slate-400 font-medium mb-8">
                            ÊÇ®ÁöÑÂÜÖÂÆπÂ∑≤ÊàêÂäüÂêåÊ≠•Ëá≥ <span className="text-blue-400 font-bold">{publishedAccounts.length}</span> ‰∏™Âπ≥Âè∞Ë¥¶Âè∑„ÄÇ
                        </p>

                        {/* Platforms Preview */}
                        <div className="w-full bg-white/5 rounded-3xl p-6 mb-8 border border-white/5 flex flex-wrap justify-center gap-4">
                            {publishedAccounts.map(acc => (
                                <div key={acc.id} className="flex flex-col items-center gap-2">
                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center text-white overflow-hidden shadow-lg ${(acc.platform || acc.type || '').toLowerCase().includes('youtube') ? 'bg-white' : (acc.platform || acc.type || '').toLowerCase().includes('tiktok') ? 'bg-black' : (acc.platform || acc.type || '').toLowerCase().includes('twitter') || (acc.platform || acc.type || '').toLowerCase().includes('x') ? 'bg-black' : 'bg-blue-600'}`}>
                                        <Icon name={(acc.platform || acc.type || '').toLowerCase()} size={24} />
                                    </div>
                                    <span className="text-[10px] text-slate-400 font-bold truncate max-w-20">@{acc.handle || acc.name}</span>
                                </div>
                            ))}
                        </div>

                        <div className="grid grid-cols-1 gap-4 w-full">
                            <button
                                onClick={handleViewHomepages}
                                className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-black text-sm shadow-xl shadow-blue-500/30 hover:shadow-blue-500/50 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2"
                            >
                                <Icon name="external-link" size={18} />
                                ÂéªÊü•Áúã
                            </button>
                            <div className="grid grid-cols-2 gap-3 w-full">
                                <button
                                    onClick={onViewHistory}
                                    className="py-3 bg-white/5 text-slate-300 rounded-2xl font-bold text-xs hover:bg-white/10 transition-all active:scale-[0.98] border border-white/5"
                                >
                                    Êü•ÁúãÂèëÂ∏ÉËÆ∞ÂΩï
                                </button>
                                <button
                                    onClick={onClose}
                                    className="py-3 bg-white/5 text-slate-300 rounded-2xl font-bold text-xs hover:bg-white/10 transition-all active:scale-[0.98] border border-white/5"
                                >
                                    ÁïôÂú®Ê≠§È°µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AgentDetailsModal = ({

            agent, onClose, onSubscribe, onOpenChat, setIsSuccessModalOpen }) => {

            const [isOpening, setIsOpening] = useState(false);
            const stats = getStableStats(agent?.id, agent?.name);

            if (!agent) return null;

            const handleSubscribe = async () => {

                const isFree = agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || agent.price === 'ÂÖçË¥π' || agent.price === 'Free' || agent.price === 'ÂÖçË¥πËÆ¢ÈòÖ' || agent.price === 'Free Subscription' || agent.price === '0' || agent.price === '¬•0';

                if (isFree) {

                    setIsOpening(true);

                    // Record subscription
                    try {
                        await fetch(`${API_BASE}/api/subscriptions`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ agent_id: agent.id })
                        });
                    } catch (e) {
                        console.error('Record sub error:', e);
                    }

                    setTimeout(() => {

                        setIsOpening(false);
                        onClose();
                        setIsSuccessModalOpen(true);

                    }, 2000);

                } else {

                    onSubscribe();

                }

            };

            return (

                <>

                    {isOpening && <SubscriptionLoadingOverlay agent={agent} />}

                    <div className="fixed inset-0 z-[110] flex items-center justify-center p-4" >

                        <div className="absolute inset-0 bg-white/80 backdrop-blur-xl" onClick={onClose}></div>

                        <div className="bg-white border border-slate-200 rounded-[40px] w-full max-w-2xl shadow-2xl relative animate-in zoom-in duration-300 overflow-hidden flex flex-col max-h-[90vh]" >

                            {/* Header Image Area */}

                            <div className="p-8 pb-4 relative z-10">

                                <div className="flex items-start justify-between" >

                                    <div className="flex gap-6">

                                        <div className="relative">
                                            {(() => {
                                                const isOfficial = agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')));
                                                const gradientClass = isOfficial ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400';
                                                return (
                                                    <>
                                                        <div className={`absolute inset-0 bg-gradient-to-br ${gradientClass} rounded-3xl blur-lg opacity-75 animate-pulse`}></div>
                                                        <div className={`relative w-24 h-24 rounded-3xl bg-gradient-to-br ${gradientClass} flex items-center justify-center text-white shadow-2xl shadow-purple-500/50 overflow-hidden`}>
                                                            {(isOfficial && !stats.isSpecial) ? (
                                                                <Icon name={agent.icon || 'zap'} size={56} className="drop-shadow-2xl" />
                                                            ) : (
                                                                <img src={stats.avatar} className="w-full h-full object-cover" />
                                                            )}
                                                            <div className="absolute inset-0 rounded-3xl bg-gradient-to-t from-white/20 to-transparent"></div>
                                                        </div>
                                                    </>
                                                );
                                            })()}
                                        </div>

                                        <div className="space-y-2">

                                            <div className="flex items-center gap-3">

                                                <span className="px-3 py-1 bg-teal-50 text-teal-600 text-[10px] font-bold rounded-full border border-teal-200 uppercase tracking-wider">

                                                    {agent.tags?.[0] || 'AI Intelligence'}

                                                </span>

                                            </div>

                                            <h2 className="text-3xl font-bold text-slate-900 tracking-tight">{agent.name}</h2>

                                            <p className="text-slate-500 text-sm">by <span className="text-slate-700 font-medium">{(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || (agent.author && (agent.author.includes('ÂÆòÊñπ') || agent.author.includes('Official')))) ? agent.author : stats.author}</span></p>

                                        </div>

                                    </div>

                                    <button onClick={onClose} className="text-slate-400 hover:text-slate-700 transition-colors p-2 hover:bg-slate-100 rounded-full">

                                        <Icon name="plus" className="rotate-45" size={28} />

                                    </button>

                                </div>

                            </div>

                            {/* Content */}

                            <div className="flex-1 overflow-y-auto px-8 pb-10 space-y-8 custom-scrollbar">

                                <div className="space-y-4" >

                                    <h3 className="text-slate-600 text-sm font-bold uppercase tracking-widest">ÊÇ®Â∞ÜËé∑Âæó</h3>

                                    <div className="grid grid-cols-2 gap-4">

                                        <div className="bg-slate-50 p-6 rounded-[24px] border border-slate-200 group hover:border-blue-300 transition-all">

                                            <div className="flex items-start gap-4">

                                                <div className="w-12 h-12 rounded-2xl bg-pink-50 text-pink-600 flex items-center justify-center shrink-0">

                                                    <Icon name="file-text" size={24} />

                                                </div>

                                                <div>

                                                    <p className="text-slate-900 font-bold text-sm">ÊèêÁ§∫ËØçÊ®°Êùø</p>

                                                    <p className="text-slate-500 text-[11px] mt-1 font-medium">12‰∏™Ê†∏ÂøÉÊèêÁ§∫ËØç</p>

                                                </div>

                                            </div>

                                        </div>

                                        <div className="bg-slate-50 p-6 rounded-[24px] border border-slate-200 group hover:border-purple-300 transition-all">

                                            <div className="flex items-start gap-4">

                                                <div className="w-12 h-12 rounded-2xl bg-purple-50 text-purple-600 flex items-center justify-center shrink-0">

                                                    <Icon name="database" size={24} />

                                                </div>

                                                <div>

                                                    <p className="text-slate-900 font-bold text-sm">ËÆ≠ÁªÉÊï∞ÊçÆ</p>

                                                    <p className="text-slate-500 text-[11px] mt-1 font-medium">500+Á≤æÈÄâÊ°à‰æã</p>

                                                </div>

                                            </div>

                                        </div>

                                        <div className="bg-slate-50 p-6 rounded-[24px] border border-slate-200 group hover:border-blue-300 transition-all">

                                            <div className="flex items-start gap-4">

                                                <div className="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center shrink-0">

                                                    <Icon name="git-branch" size={24} />

                                                </div>

                                                <div>

                                                    <p className="text-slate-900 font-bold text-sm">Â∑•‰ΩúÊµÅÁ®ã</p>

                                                    <p className="text-slate-500 text-[11px] mt-1 font-medium">ÂÖ®ÈìæË∑ØËá™Âä®ÂåñÈÖçÁΩÆ</p>

                                                </div>

                                            </div>

                                        </div>

                                        <div className="bg-slate-50 p-6 rounded-[24px] border border-slate-200 group hover:border-teal-300 transition-all">

                                            <div className="flex items-start gap-4">

                                                <div className="w-12 h-12 rounded-2xl bg-teal-50 text-teal-600 flex items-center justify-center shrink-0">

                                                    <Icon name="zap" size={24} />

                                                </div>

                                                <div>

                                                    <p className="text-slate-900 font-bold text-sm">‰ºòÂåñÂèÇÊï∞</p>

                                                    <p className="text-slate-500 text-[11px] mt-1 font-medium">ÁÆóÊ≥ïÊúÄ‰Ω≥ËÆæÁΩÆ</p>

                                                </div>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                                <div className="bg-gradient-to-br from-slate-900/60 via-slate-900/40 to-slate-800/60 p-8 rounded-[32px] border border-white/10 relative overflow-hidden backdrop-blur-xl group">

                                    <div className="absolute top-0 right-0 w-32 h-32 bg-teal-500/10 blur-[60px] rounded-full group-hover:bg-teal-500/20 transition-all duration-700"></div>

                                    <h4 className="text-teal-400 text-base font-black uppercase tracking-widest mb-8 flex items-center gap-2">

                                        <div className="w-1.5 h-1.5 rounded-full bg-teal-400 animate-pulse"></div>

                                        ‰ΩøÁî® {agent.name || 'Êô∫ËÉΩ‰Ωì'} ÁöÑÂπ≥ÂùáË°®Áé∞ </h4>

                                    {/* Âä®ÊÄÅÁîüÊàêËØ•Êô∫ËÉΩ‰ΩìÁöÑË°®Áé∞Êï∞ÊçÆ */}
                                    {(() => {
                                        let hash = 0;
                                        const str = String(agent.id || 'default');
                                        for (let i = 0; i < str.length; i++) {
                                            hash = str.charCodeAt(i) + ((hash << 5) - hash);
                                        }
                                        const absHash = Math.abs(hash);
                                        const exposure = Math.floor(absHash % 300 + 220) + '%';
                                        const income = '¬•' + Math.floor(absHash % 4000 + 3200).toLocaleString();

                                        // Ê†∏ÂøÉÈÄªËæëÔºöÂ∞èËØ¥Âä©ÊâãÂøÖÈ°ªÊòØ 2mÔºåÂÖ∂‰ªñÈöèÊú∫Âçï‰Ωç‰∏îÂèñÊï¥
                                        let time;
                                        if (agent.name.includes('Â∞èËØ¥')) {
                                            time = '2m';
                                        } else {
                                            const isSeconds = absHash % 2 === 0;
                                            if (isSeconds) {
                                                time = Math.floor(absHash % 40 + 20) + 's';
                                            } else {
                                                time = Math.floor(absHash % 5 + 1) + 'm';
                                            }
                                        }

                                        return (
                                            <div className="grid grid-cols-3 gap-8 relative z-10">
                                                <div className="space-y-1">
                                                    <p className="text-3xl font-black text-white tracking-tighter drop-shadow-sm">{exposure}</p>
                                                    <p className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">ÊõùÂÖâÂ¢ûÈïø</p>
                                                </div>
                                                <div className="space-y-1">
                                                    <p className="text-3xl font-black text-teal-400 tracking-tighter drop-shadow-md">{income}</p>
                                                    <p className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">ÊúàÂùáÊî∂ÂÖ•</p>
                                                </div>
                                                <div className="space-y-1">
                                                    <p className="text-3xl font-black text-white tracking-tighter drop-shadow-sm">{time}</p>
                                                    <p className="text-slate-400 text-[10px] font-bold uppercase tracking-widest">Âπ≥ÂùáÂà∂‰ΩúÊó∂Èó¥</p>
                                                </div>
                                            </div>
                                        );
                                    })()}

                                </div>

                            </div>

                            {/* Footer / CTA */}

                            <div className="p-8 bg-slate-50 border-t border-slate-200 flex items-center justify-between">

                                <div className="space-y-0.5" >

                                    <p className="text-slate-500 text-[10px] font-black uppercase tracking-widest">ËÆ¢ÈòÖ‰ª∑Ê†º</p>

                                    <p className="text-2xl font-black text-slate-900">
                                        {(agent.price === 'ÂÆòÊñπËÉΩÂäõ' || agent.price === 'Official' || agent.price === 'ÂÖçË¥π' || agent.price === 'Free' || agent.price === 'ÂÖçË¥πËÆ¢ÈòÖ' || agent.price === 'Free Subscription' || agent.price === '0' || agent.price === '¬•0') ? (
                                            'ÂÖçË¥π'
                                        ) : (
                                            <>¬• {agent.price.replace('¬•', '')} <span className="text-xs text-slate-500 font-bold tracking-normal text-[11px]">/ Ê∞∏‰πÖÊéàÊùÉ</span></>
                                        )}
                                    </p>

                                </div>

                                <button

                                    onClick={handleSubscribe}

                                    className="px-10 py-5 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-2xl font-black text-sm shadow-xl shadow-blue-500/30 hover:shadow-blue-500/50 hover:scale-[1.02] active:scale-[0.98] transition-all"

                                >

                                    Á´ãÂç≥ËÆ¢ÈòÖ

                                </button>

                            </div>

                        </div>

                    </div>

                </>

            );

        };

        const PaymentModal = ({

            agent, onClose, onSuccess }) => {

            const [payMethod, setPayMethod] = useState('wechat'); // 'wechat' or 'alipay'

            const [isSuccessLoading, setIsSuccessLoading] = useState(false);

            const [isProcessing, setIsProcessing] = useState(false);

            const handleComplete = () => {

                setIsProcessing(true);

                // Ê®°ÊãüÊîØ‰ªòÂõûË∞ÉÂª∂Ëøü

                setTimeout(() => {

                    setIsProcessing(false);

                    setIsSuccessLoading(true);

                    setTimeout(() => {

                        onSuccess();

                    }, 2000);

                }, 1500);

            };

            return (

                <>

                    {isSuccessLoading && <SubscriptionLoadingOverlay agent={agent} message="ÊîØ‰ªòÊàêÂäüÔºÅÂáÜÂ§á‰∏≠..." />}

                    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4" >

                        <div className="absolute inset-0 bg-white/80 backdrop-blur-md" onClick={onClose}></div>

                        <div className="bg-white rounded-[40px] w-full max-w-md p-8 shadow-2xl relative animate-in zoom-in duration-300 overflow-hidden" >

                            {/* Decorative Background */}

                            <div className="absolute top-0 left-0 right-0 h-32 bg-gradient-to-br from-slate-50 to-blue-50/30 -z-10"></div>

                            <button onClick={onClose} className="absolute top-6 right-6 text-slate-400 hover:text-slate-600 transition-colors">

                                <Icon name="plus" className="rotate-45" size={24} />

                            </button>

                            <div className="text-center mb-8">

                                <div className="w-16 h-16 bg-white rounded-2xl shadow-sm border border-slate-100 flex items-center justify-center mx-auto mb-4 overflow-hidden">

                                    {((agent.price === 'ÂÆòÊñπËÉΩÂäõ' || (agent.author && agent.author.includes('ÂÆòÊñπ'))) && !getStableStats(agent.id, agent.name).isSpecial) ? (
                                        <Icon name={agent.icon || 'zap'} size={32} className="text-blue-600" />
                                    ) : (
                                        <img src={getStableStats(agent.id, agent.name).avatar} className="w-full h-full object-cover" />
                                    )}

                                </div>

                                <h3 className="text-xl font-bold text-slate-900">ËÆ¢ÈòÖÊô∫ËÉΩ‰Ωì</h3>

                                <p className="text-slate-500 text-sm mt-1">ÊÇ®Ê≠£Âú®ËÆ¢ÈòÖÔºö <span className="font-bold text-slate-800">{agent.name}</span></p>

                                <div className="mt-4 inline-flex items-baseline gap-1">

                                    <span className="text-sm font-bold text-slate-400">¬•</span>

                                    <span className="text-4xl font-black text-slate-900 tracking-tight">{agent.price.replace('¬•', '')}</span>

                                </div>

                            </div>

                            {/* Pay Method Toggle */}

                            <div className="flex gap-4 mb-8">

                                <button

                                    onClick={() => setPayMethod('wechat')}

                                    className={`flex-1 p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-2 ${payMethod === 'wechat' ? 'border-green-500 bg-green-50/30' : 'border-slate-50 bg-slate-50/50 text-slate-400'}`}

                                >

                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${payMethod === 'wechat' ? 'bg-green-500 text-white' : 'bg-slate-200 text-white'}`}>

                                        <Icon name="plus" size={20} /> {/* Placeholder for WeChat icon */}

                                    </div>

                                    <span className={`text-sm font-bold ${payMethod === 'wechat' ? 'text-green-600' : 'text-slate-400'}`}>WeChat Pay</span>

                                </button>

                                <button

                                    onClick={() => setPayMethod('alipay')}

                                    className={`flex-1 p-4 rounded-2xl border-2 transition-all flex flex-col items-center gap-2 ${payMethod === 'alipay' ? 'border-blue-500 bg-blue-50/30' : 'border-slate-50 bg-slate-50/50 text-slate-400'}`}

                                >

                                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center ${payMethod === 'alipay' ? 'bg-blue-500 text-white' : 'bg-slate-200 text-white'}`}>

                                        <Icon name="zap" size={20} /> {/* Placeholder for Alipay icon */}

                                    </div>

                                    <span className={`text-sm font-bold ${payMethod === 'alipay' ? 'text-blue-600' : 'text-slate-400'}`}>Alipay</span>

                                </button>

                            </div>

                            {/* QR Code Area */}

                            <div className="bg-slate-50 rounded-[32px] p-6 mb-8 flex flex-col items-center border border-slate-100" >

                                <div className="bg-white p-3 rounded-2xl shadow-inner border border-slate-50 mb-4 group relative">

                                    <div className="w-48 h-48 bg-slate-50 flex items-center justify-center overflow-hidden rounded-xl">

                                        {payMethod === 'wechat' ? (

                                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=WeChatPay" alt="WeChat Pay QR" className="w-full h-full object-cover" />

                                        ) : (

                                            <div className="flex flex-col items-center gap-2 text-slate-300">

                                                <Icon name="qr-code" size={48} />

                                                <span className="text-xs font-bold uppercase tracking-widest text-center">ËØ∑‰ΩøÁî®ÊîØ‰ªòÂÆùÊâ´Á†ÅÊîØ‰ªò</span>

                                            </div>

                                        )}

                                    </div>

                                    {isProcessing && (

                                        <div className="absolute inset-0 bg-white/80 backdrop-blur-[2px] rounded-2xl flex flex-col items-center justify-center gap-3 animate-in fade-in">

                                            <div className="w-8 h-8 border-4 border-blue-600/20 border-t-blue-600 rounded-full animate-spin"></div>

                                            <span className="text-xs font-bold text-blue-600 uppercase tracking-widest">Ê≠£Âú®Á°ÆËÆ§ÊîØ‰ªòÁªìÊûú...</span>

                                        </div>

                                    )}

                                </div>

                                <p className="text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2">

                                    <Icon name="search" size={12} />

                                    ËØ∑‰ΩøÁî® {payMethod === 'wechat' ? 'ÂæÆ‰ø°' : 'ÊîØ‰ªòÂÆù'} Êâ´Á†ÅÊîØ‰ªò

                                </p>

                            </div>

                            <button

                                onClick={handleComplete}

                                disabled={isProcessing}

                                className="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-sm shadow-xl hover:bg-black transition-all active:scale-[0.98] disabled:bg-slate-300"

                            >

                                {isProcessing ? 'Á°ÆËÆ§‰∏≠...' : 'ÊàëÂ∑≤ÊîØ‰ªò'}

                            </button>

                            <p className="text-center text-xs text-slate-300 font-medium mt-4 italic tracking-tight">ÊîØ‰ªòÊàêÂäüÂêéËá™Âä®Ëß£ÈîÅ</p>

                        </div>

                    </div>

                </>

            );

        };

        const AgentChatView = ({
            agent, onBack, setActiveTab, setMediaFiles, setPostContent, showStatus }) => {

            const [messages, setMessages] = useState([

                { id: 1, role: 'ai', content: `ÊÇ®Â•ΩÔºÅÊàëÊòØ ${agent.name}„ÄÇËØ∑‰∏ä‰º†ÊÇ®ÊÉ≥Ë¶ÅÂàÜÊûêÁöÑÂÜÖÂÆπÔºàÂâßÊú¨„ÄÅÂ∞èËØ¥ÊàñËßÜÈ¢ëÁ¥†ÊùêÔºâÔºåÊàëÂ∞Ü‰∏∫ÊÇ®Âø´ÈÄüÁîüÊàêÈ´òË¥®ÈáèÁöÑÁü≠ÂâßËßÜÈ¢ë„ÄÇ`, time: 'ÂàöÂàö' }

            ]);

            const [inputValue, setInputValue] = useState(''); // Initial empty
            const [isIntroDone, setIsIntroDone] = useState(false); // Track intro completion
            const [hasTypedInput, setHasTypedInput] = useState(false); // Track if auto-typing has happened

            useEffect(() => {
                const targetText = 'Â∏ÆÊàëÂâ™ËæëËøôÈÉ®Áü≠Ââß„ÄäGran Demonio„ÄãÂπ∂ÁîüÊàêÊé®ÂπøËßÜÈ¢ë';
                if (isIntroDone && !hasTypedInput) {
                    if (inputValue.length < targetText.length) {
                        const timeout = setTimeout(() => {
                            setInputValue(targetText.slice(0, inputValue.length + 1));
                        }, 50); // Typing speed
                        return () => clearTimeout(timeout);
                    } else {
                        setHasTypedInput(true); // Mark as done
                    }
                }
            }, [isIntroDone, inputValue, hasTypedInput]);

            const [isGenerating, setIsGenerating] = useState(false);

            const chatContainerRef = React.useRef(null);

            const [aiSequence, setAiSequence] = useState([]);

            const [sequenceIdx, setSequenceIdx] = useState(-1);

            const [shouldAutoScroll, setShouldAutoScroll] = useState(true);

            const lastScrollTop = React.useRef(0);

            // Êô∫ËÉΩÊªöÂä®ÈÄªËæëÔºöË∑üÈöè Typewriter ÁîüÊàêËøõÂ∫¶

            const handleScroll = () => {

                if (!chatContainerRef.current) return;

                const { scrollTop, scrollHeight, clientHeight } = chatContainerRef.current;

                // Âà§Êñ≠ÊòØÂê¶Êé•ËøëÂ∫ïÈÉ® (60px ÁºìÂÜ≤)

                const isAtBottom = scrollHeight - scrollTop - clientHeight < 60;

                // Â¶ÇÊûúÁî®Êà∑‰∏ªÂä®Âêë‰∏äÂ§ßÂπÖÊªöÂä®ÔºåÂàôÊöÇÊó∂ÂÖ≥Èó≠Ëá™Âä®Ë∑üÈöè

                if (scrollTop < lastScrollTop.current - 5 && !isAtBottom) {

                    if (shouldAutoScroll) setShouldAutoScroll(false);

                } else if (isAtBottom) {

                    // Â¶ÇÊûúÂõûÂà∞Â∫ïÈÉ®Âå∫ÂüüÔºåËá™Âä®ÊÅ¢Â§çË∑üÈöè

                    if (!shouldAutoScroll) setShouldAutoScroll(true);

                }

                lastScrollTop.current = scrollTop;

            };

            const scrollToBottom = React.useCallback((behavior = 'auto') => {

                if (chatContainerRef.current) {

                    chatContainerRef.current.scrollTo({

                        top: chatContainerRef.current.scrollHeight,

                        behavior

                    });

                }

            }, []);

            // Â∑≤ÁßªÈô§Ëá™Âä®ÊªöÂä®ÈÄªËæëÔºåÁ°Æ‰øùÁî®Êà∑Âú®ÈòÖËØª‰∏äÊñπÂÜÖÂÆπÊó∂‰∏ç‰ºöË¢´Âº∫Ë°åÊãΩÂà∞Â∫ïÈÉ®

            // ÁßªÈô§ ResizeObserver Âº∫Âà∂Ë∑üÈöèÔºåÈÅøÂÖçÊâìÂ≠óËøáÁ®ã‰∏≠Âº∫Ë°åÊãâÂä®ËßÜÁ∫øÁÇπÂºïËµ∑‚ÄúË∑≥ËΩ¨‚Äù

            useEffect(() => {

                if (sequenceIdx >= 0 && sequenceIdx < aiSequence.length) {

                    setMessages(prev => [...prev, aiSequence[sequenceIdx]]);

                }

            }, [sequenceIdx, aiSequence]);

            const triggerNext = React.useCallback(() => {

                console.log('Triggering next segment...');

                setSequenceIdx(prev => prev + 1);

            }, []);

            const handleSend = (text, type = 'text') => {

                if (!text.trim() && type === 'text') return;

                const baseId = Date.now();
                const newUserMsg = { id: baseId, role: 'user', content: text, time: 'ÂàöÂàö', type };

                setMessages(prev => [...prev, newUserMsg]);

                setInputValue('');
                setHasTypedInput(true); // Prevent re-typing

                setIsGenerating(true);
                // ÈöèÊú∫ÁîüÊàêÊñáÊ°àÊ®°Êùø
                const captionTemplates = [
                    `üëÜüèªüî•üî•Mira la serie completaüî•üî•üëÜüèª
ü•∞ü•∞ La historia contin√∫a aqu√≠üëâüèª üì≤ ¬°Descarga la app de "FlareFlow" y mira la se rie completa‚ú®! üî•üî•

#DramaCorto #Corto #Spanish #Drama #Spain #Reel #Pel√≠cula #Rom√°ntico #AmorVerdadero #CEO #FlareFlow #shortdrama #shorts #drama #dramashorts #reels #movie #shorts #romance #TrueLove #FYP #MicroDrama #FinalInesperado`
                ];
                // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™Ê®°Êùø
                const randomCaption = captionTemplates[Math.floor(Math.random() * captionTemplates.length)];
                const sequence = [

                    {

                        id: `s1-${baseId}`, role: 'ai',

                        content: 'Ê≠£Âú®Ê∑±ÂÖ•ÂàÜÊûêÊÇ®ÁöÑÂÜÖÂÆπÁ¥†ÊùêÔºåÊèêÂèñÊ†∏ÂøÉÂèô‰∫ãÁ∫øÁ¥¢ÂíåÊÉÖÊÑüÁàÜÂèëÁÇπ...',

                        time: 'ÂàöÂàö'

                    },

                    {

                        id: `s2-h-${baseId}`, role: 'ai', type: 'report-header',

                        content: 'Âü∫‰∫éËØ≠‰πâÂàÜÊûêÔºåÊàëÂ∑≤‰∏∫ÊÇ®ÁîüÊàê‰ª•‰∏ãÁü≠ÂâßÂà∂‰ΩúÊñπÊ°àÔºö',

                        time: 'ÂàöÂàö'

                    },

                    {

                        id: `s2-p-${baseId}`, role: 'ai', type: 'report-points',

                        title: 'Ê†∏ÂøÉÂçñÁÇπÔºö',

                        points: [

                            'Ê≠ª‰∫°Âæ™ÁéØ + ÂÆøÂëΩ‰πãÊÅãÂèåÈáçÊÇ¨Áñë',

                            'Âõõ‰ΩçÂ•≥‰∏ªËßíÂèçÂ§çÂ§±Ë¥•ÔºåÁúüÁõ∏ÊâëÊúîËø∑Á¶ª',

                            '‰∏ªËßíË∑®Ë∂äÊï∞‰∏ñË¢´ÂÆøÂëΩËøΩÈÄê',

                            'ÁªàÊûÅÂèçËΩ¨ÔºöÁúüÊ≠£ÁöÑÂëΩÂÆö‰πã‰∫∫ÈöêËóèÂú®Áîª‰∏≠',

                            'ÊÉÖÊÑüÂÜ≤Âáª‰∏éÊÇ¨ÁñëÂº†ÂäõÂπ∂Â≠òÔºåÂÖ∑Â§áÂ∑®Â§ßÁàÜÊ¨æÊΩúÂäõ'

                        ]

                    },

                    {

                        id: `s2-s-${baseId}`, role: 'ai', type: 'report-structure',

                        title: 'ËßÜÈ¢ëÁªìÊûÑËÆæËÆ° (È¢Ñ‰º∞60Áßí):',

                        structure: [

                            { t: '0-5Áßí', c: "Èí©Â≠êÔºö‰ªñÊùÄ‰∫ÜÊàë4Ê¨°ÔºåÂè™‰∏∫ÊâæÂà∞ÈÇ£‰∏™Êà¥Âæó‰∏äÊàíÊåáÁöÑ‰∫∫" },

                            { t: '5-15Áßí', c: "Èì∫Âû´Ôºö4‰ΩçÂ•≥ÊºîÂëòËØïÊà¥ÊàíÊåáÂ§±Ë¥•ÔºåÁªìÂ±ÄÊÉ®ÁÉà" },

                            { t: '15-25Áßí', c: "ÁôªÂú∫ÔºöÂ•π‰ª¨Áªà‰∫éÊääÊàëÈÄÅ‰∫Ü‰∏äÂéª - ÊàíÊåáÂÆåÁæéÂ•ëÂêà" },

                            { t: '25-40Áßí', c: "ÂèçËΩ¨ÔºöÂ°ûÂ∑¥ÊñØËíÇÂÆâÁúãÂà∞ÊàëÂêéÊö¥ÊÄíÔºö'‰Ω†‰∏çÊòØÂ•πÔºÅ'" },

                            { t: '40-60Áßí', c: "Á∫øÁ¥¢ÔºöÂä©ÁêÜÂ∏¶Êù•Êñ∞ÊàíÊåáÔºå'ÁúüÊ≠£ÁöÑ‰∏ª‰∫∫Â∞±Âú®‰Ω†‰ª¨‰∏≠Èó¥'" }

                        ]

                    },

                    {

                        id: `s3-h-${baseId}`, role: 'ai', type: 'promo-header',

                        content: '‰∏∫‰∫ÜÊúÄÂ§ßÂåñÊÇ®ÁöÑ‰ΩúÂìÅÊµÅÈáèÔºåÊàë‰∏∫ÊÇ®ÂÆöÂà∂‰∫ÜËøô‰ªΩ TikTok Êé®ÂπøËÆ°ÂàíÔºö',

                        time: 'ÂàöÂàö'

                    },

                    {

                        id: `s3-1-${baseId}`, role: 'ai', type: 'promo-step',

                        title: 'Á¨¨‰∏ÄÊ≠•Ôºö‰∏ä‰º†‰∏éÈ¢ÑÂ§ÑÁêÜ', step: 1, color: 'blue',

                        items: [

                            { i: 'üîÄ', t: 'ÊâìÂºÄ TikTokÔºåÁÇπÂáªÂ∫ïÈÉ® "+" ‰∏ä‰º†' },

                            { i: 'üìÇ', t: 'ÈÄâÊã©Êú¨Âú∞ËßÜÈ¢ëÊñá‰ª∂ (Êñá‰ª∂Âêç: Project_Master_V2.mp4)' },

                            { i: 'üñºÔ∏è', t: 'Á°Æ‰øù 9:16 ÁîªÂπÖ, 1080x1920 ÂàÜËæ®Áéá, ÊúÄÈ´òÊØîÁâπÁéá' },

                            { i: 'üé®', t: 'ËÆæÁΩÆÂê∏ÁùõÂ∞ÅÈù¢ÔºöÈÄâÂèñ3ÁßíÈªÑÈáëÁâáÊÆµÔºåÊ∑ªÂä†ÈÜíÁõÆÊñáÂ≠ó' }

                        ]

                    },

                    {

                        id: `s3-2-${baseId}`, role: 'ai', type: 'promo-step',

                        title: 'Á¨¨‰∫åÊ≠•ÔºöÂÆöÊó∂‰∏éÂèëÂ∏É', step: 2, color: 'purple',

                        items: [

                            { i: 'üïí', t: 'ÁÇπÂáª "Schedule"ÔºåËÆæÂÆöÁõÆÊ†áÊó∂Èó¥ (GMT+8)' },

                            { i: 'üåç', t: 'ÂºÄÂêØ "High Quality Upload" ‰ª•‰øùËØÅÊó†ÊçüÁîªË¥®' },

                            { i: 'üìù', t: 'Â°´ÂÖÖÈ¢ÑËÆæÊ†áÈ¢òÂπ∂ÁªëÂÆöËØùÈ¢òÔºåÂèëÂ∏ÉÂâçÂä°ÂøÖÈ¢ÑËßà' }

                        ]

                    },

                    {

                        id: `s3-3-${baseId}`, role: 'ai', type: 'promo-step',

                        title: 'Á¨¨‰∏âÊ≠•ÔºöÊ†áÁ≠æ‰∏éSEO', step: 3, color: 'emerald',

                        items: [

                            { i: 'üè∑Ô∏è', t: 'Á≤æÂáÜÊ†áÁ≠æÔºö#fyp #drama #ai #miniseries #goodnovel' },

                            { i: 'üîç', t: 'ÂÖ≥ÈîÆËØçÔºöÂâç50Â≠óÂåÖÂê´ËßíËâ≤ÂêçÊ†∏ÂøÉÂèçËΩ¨ËØç' },

                            { i: 'üé∂', t: 'BGMÔºöÂÖ≥ËÅîÂΩìÂâç TikTok ÁÉ≠Èó®Ë∂ãÂäøÈü≥È¢ëÔºåÈü≥Èáè 50%' }

                        ]

                    },

                    {

                        id: `s3-4-${baseId}`, role: 'ai', type: 'promo-step',

                        title: 'Á¨¨ÂõõÊ≠•Ôºö‰∫íÂä®‰∏éÊµÅÈáè', step: 4, color: 'orange',

                        items: [

                            { i: 'üí¨', t: 'È¶ñËØÑÔºöËØÑËÆ∫ "Who is the real owner?" Âπ∂ÁΩÆÈ°∂' },

                            { i: 'üîó', t: 'ËΩ¨ÂåñÔºöÂºïÂØºÁî®Êà∑ÁÇπÂáª Bio ÈìæÊé•ÊàñÊêúÁ¥¢‰ª£Á†Å' },

                            { i: 'üî•', t: '‰∫íÂä®Ôºö1Â∞èÊó∂ÂÜÖÂõûÂ§ç3-5Êù°È´òË¥®ÈáèËØÑËÆ∫‰ª•Ëß¶ÂèëÊé®Ëçê' }

                        ]

                    },

                    {

                        id: `s3-f-${baseId}`, role: 'ai', type: 'promo-footer',

                        content: 'üåü ÂΩìÂâçÁ≠ñÁï•ËûçÂêà‰∫Ü TikTok ÁÆóÊ≥ï + ‰∫∫Â∑•Èí©Â≠êÂõûË∑Ø„ÄÇÈ¢ÑÊµãÁàÜÊ¨æÊ¶ÇÁéáÔºö91.2%',

                        time: 'ÂàöÂàö'

                    },

                    {

                        id: `s4-${baseId}`, role: 'ai', step: 5,

                        content: 'üéä ÊÅ≠ÂñúÔºÅÁ¥†ÊùêÁºñÊéí„ÄÅÊ∏≤ÊüìÂèäÊé®ÂπøËÆ°ÂàíÂ∑≤Â∞±Áª™„ÄÇËøôÊòØÊÇ®ÁöÑ‰∫§‰ªòÂåÖÔºö',

                        time: 'ÂàöÂàö',

                        renderingText: 'ÊñπÊ°àÁ°ÆËÆ§„ÄÇÊ≠£Âú®Ë∞ÉÁî®‰∫ëÁ´ØÈõÜÁæ§Ê∏≤Êüì 9:16 È´òÊ∏ÖËßÜÈ¢ëÂπ∂ÁîüÊàêÊ†áÈ¢ò...',

                        videoUrl: 'https://beidou-file-test-v1.oss-cn-beijing.aliyuncs.com/syl/%E5%8E%BB%E9%87%8D0109.mp4',

                        generatedCaption: randomCaption,

                        commandCode: '553086'

                    }

                ];

                setTimeout(() => {

                    setAiSequence(sequence);

                    setSequenceIdx(0);

                }, 1000);

            };

            const handleOneClickPublish = (videoUrl, caption) => {

                console.log('üöÄ [One-Click Publish] ÂºÄÂßãË£ÖËΩΩÁ¥†Êùê...');
                console.log('üìπ ËßÜÈ¢ëURL:', videoUrl);
                console.log('üìù Êé®ÂπøÊñáÊ°à:', caption);

                // 1. ÂÖàËÆæÁΩÆÊñáÊ°àÂÜÖÂÆπÔºàÁ°Æ‰øùÂú®ÂàáÊç¢Ê†áÁ≠æÂâçËÆæÁΩÆÔºâ
                if (caption) {
                    if (setPostContent) {
                        setPostContent(caption);
                        console.log('‚úÖ [Caption] Caption set to publish center');
                    } else {
                        console.warn('‚ö†Ô∏è [Caption] setPostContent ÂáΩÊï∞Êú™ÂÆö‰πâÔºÅ');
                    }
                } else {
                    console.warn('‚ö†Ô∏è [Caption] Êé®ÂπøÊñáÊ°à‰∏∫Á©∫');
                }

                // 2. Ê∑ªÂä†ËßÜÈ¢ëÊñá‰ª∂
                const newFile = {
                    remoteUrl: videoUrl,
                    preview: videoUrl,
                    name: `ai_generated_video_${Date.now()}.mp4`,
                    type: 'video/mp4'
                };

                if (setMediaFiles) {
                    setMediaFiles(prev => {
                        const updated = [...prev, newFile];
                        console.log(`‚úÖ [Media] Video added, current media count: ${updated.length}`);
                        return updated;
                    });
                } else {
                    console.error('‚ùå [Media] setMediaFiles ÂáΩÊï∞Êú™ÂÆö‰πâÔºÅ');
                }

                // 3. ÂàáÊç¢Âà∞ÂèëÂ∏ÉÊ†áÁ≠æ
                if (setActiveTab) {
                    setActiveTab('posts');
                    console.log('‚úÖ [Navigation] Switched to publish center');
                }

                // 4. ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫ Â∑≤Âà†Èô§ÔºåÂõ†‰∏∫‰ºöÁõ¥Êé•Ë∑≥ËΩ¨È°µÈù¢


                console.log('‚ú® [One-Click Publish] Load complete!');
            };

            const handleFileUpload = (e) => {

                const file = e.target.files[0];

                if (file) handleSend(`File uploaded: ${file.name} `, 'file');

            };

            return (

                <div className="flex flex-col h-[calc(100vh-140px)] bg-slate-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/10 overflow-hidden animate-in slide-in-from-bottom-4 duration-500">

                    {/* Chat Header */}

                    <div className="px-6 py-4 bg-slate-900 text-white flex items-center justify-between shrink-0">

                        <div className="flex items-center gap-3">

                            <button onClick={onBack} className="p-1.5 hover:bg-white/10 rounded-lg transition-all">

                                <Icon name="plus" className="rotate-45" size={20} />

                            </button>

                            <div className="flex items-center gap-2.5">

                                <div className="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center overflow-hidden">
                                    {((agent.price === 'ÂÆòÊñπËÉΩÂäõ' || (agent.author && agent.author.includes('ÂÆòÊñπ'))) && !getStableStats(agent.id, agent.name).isSpecial) ? (
                                        <Icon name={agent.icon || 'zap'} size={16} />
                                    ) : (
                                        <img src={getStableStats(agent.id, agent.name).avatar} className="w-full h-full object-cover" />
                                    )}
                                </div>

                                <div>

                                    <h3 className="font-bold text-lg">{agent.name}</h3>

                                    <span className="text-sm text-blue-400 font-bold uppercase tracking-widest">Ê†∏ÂøÉÁºñÊéíÊ®°Âºè</span>

                                </div>

                            </div>

                        </div>

                    </div>

                    {/* Messages Area */}

                    <div

                        ref={chatContainerRef}

                        onScroll={handleScroll}

                        className="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar bg-transparent"

                    >

                        <div className="messages-wrapper space-y-1">

                            {messages.map((msg, idx) => {

                                const isFirstInSequence = idx === 0 || messages[idx - 1].role !== msg.role;

                                return (

                                    <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} ${isFirstInSequence ? 'mt-4' : 'mt-0.5'}`} >

                                        <div className={`w-full flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse max-w-[75%]' : 'flex-row max-w-[85%]'} `}>

                                            {/* Avatar Area */}

                                            <div className="w-8 h-8 shrink-0">

                                                {isFirstInSequence ? (

                                                    <div className={`w-full h-full ${msg.role === 'user' ? 'rounded-full bg-blue-50 text-blue-600' : 'rounded-lg bg-white text-blue-600 border border-slate-100'} flex items-center justify-center shadow-md font-bold text-sm overflow-hidden`}>
                                                        {msg.role === 'user' ? (
                                                            CURRENT_USER.avatar ? <img src={CURRENT_USER.avatar} className="w-full h-full object-cover" /> : CURRENT_USER.initials
                                                        ) : (
                                                            (agent.name === 'AI Novel Assistant' || agent.name === 'AIÂàõ‰ΩúÂä©Êâã') ? (
                                                                <img src={API_BASE + "/static/official_novel.png"} className="w-full h-full object-cover" />
                                                            ) : (agent.price === 'ÂÆòÊñπËÉΩÂäõ' || (agent.author && agent.author.includes('ÂÆòÊñπ'))) ? (
                                                                <Icon name={agent.icon || 'zap'} size={16} />
                                                            ) : (
                                                                <img src={getStableStats(agent.id, agent.name).avatar} className="w-full h-full object-cover" />
                                                            )
                                                        )}
                                                    </div>
                                                ) : null}

                                            </div>

                                            <div className="flex-1 space-y-1">

                                                <div className={`${msg.role === 'ai' && msg.type && (msg.type?.startsWith('report-') || msg.type?.startsWith('promo-') || msg.role === 'ai' && msg.commandCode) ? '' : 'p-3 px-4 rounded-2xl bg-white/5 border border-white/10 shadow-sm backdrop-blur-md'} text-base leading-relaxed font-medium ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none max-w-lg ml-auto' : 'text-slate-100 rounded-tl-none'}`}>


                                                    {msg.type === 'file' && (

                                                        <div className="flex items-center gap-2 mb-1.5 p-2 bg-white/10 rounded-lg border border-white/20">

                                                            <Icon name="layout" size={16} />

                                                            <span className="font-bold">{msg.content}</span>

                                                        </div>

                                                    )}

                                                    {msg.type === 'report-header' && (

                                                        <div className="w-full max-w-4xl px-3 py-1.5 text-slate-300">

                                                            <Typewriter text={msg.content} onComplete={triggerNext} />

                                                        </div>

                                                    )}

                                                    {msg.type === 'report-points' && (

                                                        <div className="w-full max-w-4xl px-5 py-6 space-y-6 bg-slate-900/50 rounded-2xl border border-white/10 backdrop-blur-md animate-in fade-in duration-700 shadow-xl">

                                                            <div className="flex items-center gap-3">

                                                                <div className="w-1.5 h-6 bg-blue-600 rounded-full shadow-glow"></div>

                                                                <h4 className="text-lg font-black text-white tracking-tight">Áü≠ÂâßÊñπÊ°àÂ∑≤Á°ÆËÆ§</h4>

                                                            </div>

                                                            <div className="space-y-4">

                                                                <p className="text-sm font-black text-blue-400 uppercase tracking-[0.2em] flex items-center gap-2">

                                                                    <div className="w-1.5 h-1.5 rounded-full bg-blue-400"></div>

                                                                    {msg.title}

                                                                </p>

                                                                <div className="grid grid-cols-2 gap-6">

                                                                    {msg.points.map((p, i) => (

                                                                        <div key={i} className="flex gap-3 group">

                                                                            <span className="text-blue-500 font-black text-base">0{i + 1}.</span>

                                                                            <div className="text-slate-300 font-bold text-base leading-relaxed">

                                                                                <Typewriter

                                                                                    text={p}

                                                                                    delay={i * 400}

                                                                                    speed={20}

                                                                                    onComplete={i === msg.points.length - 1 ? triggerNext : null}

                                                                                />

                                                                            </div>

                                                                        </div>

                                                                    ))}

                                                                </div>

                                                            </div>

                                                        </div>

                                                    )}

                                                    {msg.type === 'report-structure' && (

                                                        <div className="w-full max-w-4xl px-6 py-8 mt-4 bg-slate-900/50 rounded-2xl border border-white/10 backdrop-blur-md shadow-2xl animate-in fade-in zoom-in duration-1000">

                                                            <p className="text-sm font-black text-purple-400 uppercase tracking-[0.2em] flex items-center gap-2 mb-6">

                                                                <div className="w-1.5 h-1.5 rounded-full bg-purple-400"></div>

                                                                {msg.title}

                                                            </p>

                                                            <div className="overflow-hidden">

                                                                <table className="w-full text-left">

                                                                    <tbody className="divide-y divide-white/5">

                                                                        {msg.structure.map((s, i) => (

                                                                            <tr key={i} className="group hover:bg-white/5 transition-colors">

                                                                                <td className="py-4 font-black text-blue-400 whitespace-nowrap text-base w-20 align-top">

                                                                                    <Typewriter text={s.t} delay={i * 1200} speed={40} />

                                                                                </td>

                                                                                <td className="py-4 px-4 text-slate-200 font-bold leading-relaxed text-base antialiased">

                                                                                    <Typewriter

                                                                                        text={s.c}

                                                                                        delay={i * 1200 + 400}

                                                                                        speed={30}

                                                                                        onComplete={i === msg.structure.length - 1 ? triggerNext : null}

                                                                                    />

                                                                                </td>

                                                                            </tr>

                                                                        ))}

                                                                    </tbody>

                                                                </table>

                                                            </div>

                                                        </div>

                                                    )}

                                                    {msg.type === 'promo-header' && (

                                                        <div className="w-full max-w-4xl px-6 py-7 mt-8 bg-white/5 rounded-2xl border border-white/10 backdrop-blur-md shadow-xl animate-in fade-in slide-in-from-bottom-4 duration-700">

                                                            <div className="text-base text-slate-400 font-bold mb-5 italic border-b border-white/5 pb-4 leading-relaxed">

                                                                <Typewriter text={msg.content} onComplete={triggerNext} />

                                                            </div>

                                                            <div className="flex items-center gap-3">

                                                                <div className="w-1.5 h-8 bg-blue-600 rounded-full animate-pulse shadow-[0_0_15px_rgba(37,99,235,0.6)]"></div>

                                                                <h4 className="text-xl font-black text-white tracking-tighter uppercase">TikTok Promotion Plan</h4>

                                                            </div>

                                                        </div>

                                                    )}

                                                    {msg.type === 'promo-step' && (

                                                        <div className="w-full max-w-4xl px-7 py-6 mt-4 bg-white/5 rounded-2xl border border-white/10 backdrop-blur-md shadow-lg animate-in fade-in slide-in-from-left-4 duration-700">

                                                            <div className="relative">

                                                                <h6 className={`text-sm font-black uppercase tracking-[0.2em] mb-4 text-${msg.color}-400 flex items-center gap-2`}>

                                                                    <div className={`w-2 h-2 rounded-full bg-${msg.color}-500 shadow-glow`}></div>

                                                                    <Typewriter text={msg.title} speed={20} />

                                                                </h6>

                                                                <ul className="space-y-4">

                                                                    {msg.items.map((item, idx) => (

                                                                        <li key={idx} className="flex gap-4 items-start group">

                                                                            <span className="text-xl shrink-0 animate-in zoom-in block" style={{ animationDelay: `${idx * 400}ms` }}>{item.i}</span>

                                                                            <div className="text-base text-slate-300 font-bold leading-relaxed pt-1">

                                                                                <Typewriter

                                                                                    text={item.t}

                                                                                    delay={idx * 600}

                                                                                    speed={20}

                                                                                    onComplete={idx === msg.items.length - 1 ? triggerNext : null}

                                                                                />

                                                                            </div>

                                                                        </li>

                                                                    ))}

                                                                </ul>

                                                            </div>

                                                        </div>

                                                    )}

                                                    {msg.type === 'promo-footer' && (

                                                        <div className="w-full max-w-4xl px-7 py-6 mt-4 bg-blue-600/10 rounded-2xl border border-blue-500/20 backdrop-blur-md shadow-inner animate-in fade-in zoom-in duration-700">

                                                            <div className="flex gap-3 items-start">

                                                                <Icon name="zap" size={20} className="text-blue-500 shrink-0 mt-0.5" />

                                                                <p className="text-base text-blue-300 font-black leading-relaxed antialiased italic">

                                                                    <Typewriter text={msg.content} speed={30} onComplete={triggerNext} />

                                                                </p>

                                                            </div>

                                                        </div>

                                                    )}

                                                    {(!msg.type || msg.type === 'text') && msg.role === 'ai' ? (
                                                        <Typewriter text={msg.content} onComplete={() => {
                                                            if (idx === 0) setIsIntroDone(true);
                                                            triggerNext();
                                                        }} />
                                                    ) : (!msg.type || msg.type === 'text') ? msg.content : ''}

                                                    {msg.commandCode && (

                                                        <div className="w-full max-w-4xl px-6 py-8 mt-10 bg-white/5 rounded-3xl border border-white/10 backdrop-blur-md shadow-2xl animate-in fade-in duration-1000">

                                                            <div className="space-y-10">

                                                                <div className="flex flex-col items-center gap-3">

                                                                    <div className="w-12 h-1 bg-blue-600 rounded-full mb-1 shadow-[0_0_15px_rgba(37,99,235,0.5)]"></div>

                                                                    <h5 className="text-sm text-slate-400 font-black uppercase tracking-[0.4em]">Ê≠£ÊñáÂÜÖÂÆπ</h5>

                                                                </div>

                                                                <div className="space-y-8">

                                                                    <div className="space-y-3">
                                                                        <div className="p-6 bg-slate-900 border border-white/5 rounded-3xl relative transition-all hover:border-purple-500/30 hover:shadow-xl hover:shadow-purple-500/5 max-w-lg mx-auto animate-in fade-in zoom-in fill-mode-both" style={{ animationDelay: '2000ms' }}>

                                                                            <div className="text-slate-200 font-bold text-base leading-relaxed text-center whitespace-pre-line antialiased">

                                                                                <Typewriter text={msg.generatedCaption} speed={35} delay={3500} onComplete={() => setIsGenerating(false)} />

                                                                            </div>

                                                                        </div>

                                                                    </div>

                                                                    {/* ËßÜÈ¢ë */}

                                                                    {msg.videoUrl && (

                                                                        <div className="space-y-4">
                                                                            <div className="rounded-3xl overflow-hidden border-4 border-slate-900 shadow-xl bg-black aspect-[9/16] relative group max-w-[260px] mx-auto ring-2 ring-white/5 animate-in fade-in zoom-in fill-mode-both" style={{ animationDelay: '2500ms' }}>

                                                                                <video src={msg.videoUrl} className="w-full h-full object-cover" controls autoPlay muted />

                                                                            </div>

                                                                        </div>

                                                                    )}

                                                                </div>

                                                                <button

                                                                    onClick={() => handleOneClickPublish(msg.videoUrl, msg.generatedCaption)}

                                                                    className="w-full py-4 bg-blue-600/90 text-white rounded-2xl font-black text-base shadow-xl shadow-blue-500/10 hover:bg-blue-600 transition-all flex items-center justify-center gap-3 mt-4"

                                                                >

                                                                    <Icon name="send" size={20} className="rotate-[-10deg]" />

                                                                    ‰∏ÄÈîÆÂèëÂ∏ÉÂà∞Á§æ‰∫§Â™í‰Ωì

                                                                </button>

                                                            </div>

                                                        </div>

                                                    )}

                                                </div>

                                                <p className={`text-xs font-bold text-slate-400 uppercase tracking-widest pt-2 ${msg.role === 'user' ? 'text-right' : 'text-left'}`}>

                                                    {isFirstInSequence ? msg.time : ''}

                                                </p>

                                            </div>

                                        </div>

                                    </div>

                                );

                            })}

                            {

                                isGenerating && aiSequence.length === 0 && (

                                    <div className="flex justify-start animate-in fade-in duration-300">

                                        <div className="flex gap-4">

                                            <div className="w-8 h-8 rounded-lg bg-slate-900 text-blue-400 flex items-center justify-center shadow-lg border border-white/10">

                                                <Icon name={agent.icon || 'zap'} size={16} />

                                            </div>

                                            <div className="bg-slate-900/50 p-5 rounded-3xl rounded-tl-none border border-white/10 shadow-lg flex items-center gap-2 backdrop-blur-md">

                                                <div className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce shadow-glow"></div>

                                                <div className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:0.2s] shadow-glow"></div>

                                                <div className="w-1.5 h-1.5 bg-blue-500 rounded-full animate-bounce [animation-delay:0.4s] shadow-glow"></div>

                                                <span className="text-xs font-black text-slate-400 ml-2 uppercase tracking-widest">AI Deep Creating...</span>

                                            </div>

                                        </div>

                                    </div>

                                )

                            }

                        </div>

                    </div>

                    {/* Input Area */}

                    <div className="p-6 bg-slate-950 border-t border-white/5 shrink-0">

                        <div className="max-w-4xl mx-auto relative" >

                            <div className="flex items-center gap-4 bg-slate-900/50 border border-white/10 rounded-2xl p-2 pr-4 focus-within:bg-slate-900 focus-within:border-blue-500/50 focus-within:shadow-2xl focus-within:shadow-blue-500/10 transition-all duration-300">

                                <button

                                    onClick={() => document.getElementById('chat-file-upload').click()}

                                    className="p-3 text-slate-500 hover:text-blue-400 hover:bg-white/5 rounded-xl transition-all"

                                >

                                    <Icon name="plus" size={20} />

                                </button>

                                <input id="chat-file-upload" type="file" className="hidden" onChange={handleFileUpload} />

                                <input

                                    type="text"

                                    value={inputValue}

                                    onChange={(e) => setInputValue(e.target.value)}

                                    onKeyPress={(e) => e.key === 'Enter' && handleSend(inputValue)}

                                    placeholder="ËæìÂÖ•ÂÜÖÂÆπÊàñ‰∏ä‰º†Á¥†ÊùêÔºåÂºÄÂêØÊô∫ËÉΩÁºñÊéí..."

                                    className="flex-1 bg-transparent border-none outline-none py-3 text-sm font-bold text-white placeholder:text-slate-600"

                                />

                                <button

                                    onClick={() => handleSend(inputValue)}

                                    disabled={!inputValue.trim() || isGenerating}

                                    className={`px-6 py-2.5 rounded-xl font-black text-sm transition-all flex items-center gap-2 ${inputValue.trim() && !isGenerating ? 'bg-blue-600 text-white shadow-xl shadow-blue-500/20'

                                        : 'bg-slate-800 text-slate-600 cursor-not-allowed'}`}

                                >

                                    <span>ÂèëÈÄÅ</span>

                                    <Icon name="send" size={16} />

                                </button>

                            </div>

                        </div>

                    </div>

                </div>

            );

        };

        const MyAgentsView = ({ setActiveTab, setMediaFiles, setPostContent, showStatus }) => {


            const [agents, setAgents] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeCategory, setActiveCategory] = useState('all');
            const [activeAgent, setActiveAgent] = useState(null);
            const [confirmData, setConfirmData] = useState({ open: false, id: null, name: '', isSelfCreated: false });
            const [selectedAgentForTasks, setSelectedAgentForTasks] = useState(null);
            const [agentTasks, setAgentTasks] = useState([]);


            useEffect(() => {

                fetchMyAgents();

            }, []);

            if (activeAgent) {
                return <AgentChatView agent={activeAgent} onBack={() => setActiveAgent(null)} setActiveTab={setActiveTab} setMediaFiles={setMediaFiles} setPostContent={setPostContent} showStatus={showStatus} />
            }

            const fetchMyAgents = async () => {

                setLoading(true);

                try {

                    // Fetch both all agents and subscriptions
                    const [agentsRes, subsRes] = await Promise.all([
                        fetch(`${API_BASE}/api/agents`),
                        fetch(`${API_BASE}/api/subscriptions`)
                    ]);

                    const allAgents = await agentsRes.json();
                    const subAgents = await subsRes.json();

                    const subIds = new Set(subAgents.map(a => String(a.id)));

                    // üéñÔ∏è ‰ΩøÁî®‰∏éÂπøÂú∫‰∏ÄËá¥ÁöÑ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºöÂÆòÊñπÂÖçË¥πÁΩÆÈ°∂
                    const sortedData = allAgents.sort((a, b) => {
                        const isAOfficial = a.price === 'ÂÆòÊñπËÉΩÂäõ' || (a.author && a.author.includes('ÂÆòÊñπ'));
                        const isBOfficial = b.price === 'ÂÆòÊñπËÉΩÂäõ' || (b.author && b.author.includes('ÂÆòÊñπ'));
                        const isAFree = isAOfficial || a.price === 'ÂÖçË¥π' || a.price === 'ÂÖçË¥πËÆ¢ÈòÖ' || a.price === '0' || a.price === '¬•0';
                        const isBFree = isBOfficial || b.price === 'ÂÖçË¥π' || b.price === 'ÂÖçË¥πËÆ¢ÈòÖ' || b.price === '0' || b.price === '¬•0';

                        const getPrio = (off, free) => {
                            if (off && free) return 0;
                            if (free) return 1;
                            return 2;
                        };

                        const prioA = getPrio(isAOfficial, isAFree);
                        const prioB = getPrio(isBOfficial, isBFree);

                        if (prioA !== prioB) return prioA - prioB;
                        return 0;
                    });

                    // Á°Æ‰øùÊâÄÊúâÁ±ªÂûãÁöÑÊô∫ËÉΩ‰ΩìÂú®‚ÄúÂÖ®ÈÉ®‚ÄùÊ†áÁ≠æ‰∏ãÈÉΩËÉΩÁúãÂà∞
                    const processedData = sortedData.map(agent => {
                        const isSubscribed = subIds.has(String(agent.id));
                        const isSelfCreated = agent.author === CURRENT_USER.name || agent.author === 'Me' || agent.author === 'ËÆøÂÆ¢Âàõ‰ΩúËÄÖ' || agent.author === 'Sora' || agent.author === 'Guest Creator';

                        // üöÄ MOCK DATA INJECTION FOR DEMO
                        // Force specific agents to be "Working" to demonstrate new UI
                        let mockRunning = agent.running_tasks || 0;
                        let mockAction = "";

                        if (agent.name.includes('Ââ™Ëæë') || agent.name.includes('ÂèëÂ∏É')) {
                            mockRunning = 4;
                            mockAction = "Ê≠£Âú®ÂèëÂ∏ÉÔºö„ÄäÈú∏ÈÅìÊÄªË£Å„ÄãEp.4 - sweet love...";
                        } else if (agent.name.includes('ÂéªÈáç') || agent.name.includes('Â§ÑÁêÜ')) {
                            mockRunning = 5;
                            mockAction = "Ê≠£Âú®Â§ÑÁêÜÔºöraw_video_source_002.mp4 (78%)";
                        }

                        let category = 'official';
                        if (isSelfCreated) category = 'created';
                        else if (isSubscribed) category = 'subscribed';

                        return {
                            ...agent,
                            isSelfCreated,
                            isSubscribed,
                            category,
                            // Override with mock data
                            running_tasks: mockRunning,
                            current_action: mockAction
                        };
                    });

                    // Only show agents that are either self-created or subscribed
                    const myAgents = processedData.filter(a => a.isSelfCreated || a.isSubscribed);

                    setAgents(myAgents);
                    console.log('‚úÖ My agents loaded (sorted):', myAgents.length);
                } catch (error) {
                    console.error('Fetch my agents error:', error);

                } finally {

                    setLoading(false);

                }

            };

            const handleDelete = (agentId, agentName, isSelfCreated) => {
                setConfirmData({ open: true, id: agentId, name: agentName, isSelfCreated });
            };

            const performDelete = async () => {
                const { id: agentId, isSelfCreated } = confirmData;
                setConfirmData({ ...confirmData, open: false });

                try {
                    // Â¶ÇÊûúÊòØÁî®Êà∑Ëá™Â∑±ÂàõÂª∫ÁöÑÔºåË∞ÉÁî®Âà†Èô§ APIÔºõÂ¶ÇÊûúÊòØËÆ¢ÈòÖÁöÑÔºåË∞ÉÁî®ÂèñÊ∂àËÆ¢ÈòÖ API
                    const url = isSelfCreated
                        ? `${API_BASE}/api/agents/${agentId}`
                        : `${API_BASE}/api/subscriptions/${agentId}`;

                    const res = await fetch(url, {
                        method: 'DELETE'
                    });

                    const result = await res.json();

                    if (result.success) {
                        showStatus('success', isSelfCreated ? 'Âà†Èô§ÊàêÂäü' : 'ÂèñÊ∂àËÆ¢ÈòÖÊàêÂäü');
                        fetchMyAgents(); // Âà∑Êñ∞ÂàóË°®
                    } else {
                        showStatus('error', (isSelfCreated ? 'Âà†Èô§Â§±Ë¥•: ' : 'ÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•: ') + result.error);
                    }
                } catch (error) {
                    console.error('Delete/Unsubscribe agent error:', error);
                    showStatus('error', 'ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÂÜçËØï');
                }
            };

            const handleShowTasks = async (agent) => {
                setSelectedAgentForTasks(agent);
                // Fetch tasks for this agent
                try {
                    const res = await fetch(API_BASE + `/api/agent/${agent.id}/tasks`);
                    if (res.ok) {
                        const tasks = await res.json();
                        setAgentTasks(tasks);
                    }
                } catch (e) {
                    console.error("Fetch tasks error", e);
                    setAgentTasks([]);
                }
            };

            const closeTaskModal = () => {
                setSelectedAgentForTasks(null);
                setAgentTasks([]);
            };

            return (
                <div className="max-w-6xl mx-auto space-y-12">
                    {confirmData.open && (
                        <CustomConfirmModal
                            title={confirmData.isSelfCreated ? "Âà†Èô§Êô∫ËÉΩ‰Ωì" : "ÂèñÊ∂àËÆ¢ÈòÖ"}
                            message={confirmData.isSelfCreated
                                ? `Á°ÆÂÆöË¶ÅÂà†Èô§‚Äú${confirmData.name}‚ÄùÂêóÔºüÊ≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÁßªÈô§ËØ•Êô∫ËÉΩ‰Ωì‰∏îÊó†Ê≥ïÊí§ÈîÄ„ÄÇ`
                                : `Á°ÆÂÆöË¶ÅÂèñÊ∂àËÆ¢ÈòÖ‚Äú${confirmData.name}‚ÄùÂêóÔºü`}
                            onConfirm={performDelete}
                            onCancel={() => setConfirmData({ ...confirmData, open: false })}
                            confirmText={confirmData.isSelfCreated ? "Á°ÆËÆ§Âà†Èô§" : "ÂèñÊ∂àËÆ¢ÈòÖ"}
                        />
                    )}
                    <div className="flex flex-col gap-6 py-6 pt-10">

                        <div className="flex items-center justify-between">

                            <div>

                                <h2 className="text-3xl font-bold text-slate-900 tracking-tight">ÊàëÁöÑÊô∫ËÉΩÂõ¢Èòü</h2>

                                <p className="text-slate-500 mt-2 text-sm font-medium">Êô∫ÊÖßÂçèË∞ÉÊàêÂ∞±ÂçìË∂äËê•ÈîÄËµÑ‰∫ß</p>

                            </div>

                        </div>

                        {/* Category Tabs */}

                        <div className="flex items-center gap-1.5 p-1.5 bg-slate-900/50 w-max rounded-2xl border border-slate-700/50 backdrop-blur-sm">

                            {[

                                { id: 'all', label: 'ÂÖ®ÈÉ®', icon: 'layout' },

                                { id: 'created', label: 'ÊàëÂàõÂª∫ÁöÑ', icon: 'edit' },

                                { id: 'subscribed', label: 'Â∑≤Ë¥≠‰π∞', icon: 'stars' }

                            ].map(tab => (

                                <button

                                    key={tab.id}

                                    onClick={() => setActiveCategory(tab.id)}

                                    className={`flex items-center gap-2 px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${activeCategory === tab.id ? 'bg-slate-800 text-white shadow-sm ring-1 ring-white/10'

                                        : 'text-slate-400 hover:text-white hover:bg-slate-800/50'}`}

                                >

                                    <Icon name={tab.icon} size={16} />

                                    {tab.label}

                                </button>

                            ))}

                        </div>

                    </div>

                    {

                        loading ? (

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6" >

                                {[1, 2, 3].map(i => <div key={i} className="aspect-[4/3] bg-slate-50 rounded-[32px] animate-pulse border border-slate-100"></div>)}

                            </div>

                        ) : agents.filter(a => activeCategory === 'all' ? (a.category === 'created' || a.category === 'subscribed') : a.category === activeCategory).length === 0 ? (

                            <div className="flex flex-col items-center justify-center py-32 bg-white rounded-[40px] border border-slate-100 shadow-sm">

                                <div className="w-24 h-24 bg-slate-50 rounded-full flex items-center justify-center text-slate-200 mb-8 border border-white">

                                    <Icon name="zap" size={48} />

                                </div>

                                <h3 className="text-xl font-bold text-slate-800 mb-2">ÊöÇÊó†Êô∫ËÉΩ‰Ωì</h3>

                                <p className="text-slate-400 mb-10 text-center max-w-sm font-medium">ÂâçÂæÄÂàõ‰Ωú‰∏≠ÂøÉËé∑ÂèñÁÅµÊÑüÔºå<br />ÊàñÂú®ÂπøÂú∫ËÆ¢ÈòÖÁÉ≠Èó®ËÉΩÂäõ</p>

                            </div>

                        ) : (

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-24">
                                {agents.filter(a => activeCategory === 'all' ? (a.category === 'created' || a.category === 'subscribed') : a.category === activeCategory).map(agent => {
                                    const stats = getStableStats(agent.id, agent.name);
                                    return (
                                        <div key={agent.id} className="bg-white rounded-[32px] p-8 border border-slate-100 shadow-sm hover:shadow-2xl hover:-translate-y-1 transition-all duration-500 flex flex-col group relative overflow-hidden">
                                            {/* Type Badge */}
                                            <div className="absolute top-0 right-0">
                                                {agent.isSelfCreated ? (
                                                    <div className="bg-blue-600 text-white px-4 py-1.5 rounded-bl-2xl text-[9px] font-black uppercase tracking-widest flex items-center gap-1.5">
                                                        <Icon name="edit" size={10} />
                                                        Ëá™Á†î
                                                    </div>
                                                ) : (
                                                    <div className="bg-emerald-600 text-white px-4 py-1.5 rounded-bl-2xl text-[9px] font-black uppercase tracking-widest flex items-center gap-1.5">
                                                        <Icon name="check" size={10} />
                                                        Â∑≤ËÆ¢ÈòÖ
                                                    </div>
                                                )}
                                            </div>

                                            <div className="flex items-start justify-between mb-6">
                                                <div className="flex gap-4">
                                                    <div className="relative group/icon">
                                                        {(() => {
                                                            const isOfficial = agent.price === 'ÂÆòÊñπËÉΩÂäõ' || (agent.author && agent.author.includes('ÂÆòÊñπ'));
                                                            const gradientClass = isOfficial ? 'from-purple-600 via-blue-600 to-pink-600' : 'from-blue-400 via-indigo-500 to-teal-400';
                                                            return (
                                                                <>
                                                                    <div className={`absolute inset-0 bg-gradient-to-br ${gradientClass} rounded-2xl blur opacity-75 group-hover/icon:opacity-100 animate-pulse`}></div>
                                                                    <div className={`relative w-16 h-16 rounded-2xl bg-gradient-to-br ${gradientClass} flex items-center justify-center text-white shadow-lg overflow-hidden shadow-purple-500/20 transition-all duration-300 group-hover/icon:scale-110 group-hover/icon:rotate-3`}>
                                                                        {((agent.price === 'ÂÆòÊñπËÉΩÂäõ' || (agent.author && agent.author.includes('ÂÆòÊñπ'))) && !stats.isSpecial) ? (
                                                                            <Icon name={agent.icon || 'zap'} size={28} className="drop-shadow-lg" />
                                                                        ) : (
                                                                            <img src={stats.avatar} className="w-full h-full object-cover" />
                                                                        )}
                                                                        <div className="absolute inset-0 rounded-2xl bg-gradient-to-t from-white/20 to-transparent pointer-events-none"></div>
                                                                    </div>
                                                                </>
                                                            );
                                                        })()}
                                                    </div>

                                                    <div>
                                                        <h4 className="font-bold text-slate-900 text-xl mb-1.5 tracking-tight group-hover:text-blue-600 transition-colors">{agent.name}</h4>
                                                        <div className="flex flex-wrap gap-1.5">
                                                            {(agent.tags || []).map(tag => (
                                                                <span key={tag} className="px-2 py-0.5 bg-slate-100 text-[10px] font-bold text-slate-500 rounded-lg lowercase tracking-tight border border-slate-200/50">{tag}</span>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>


                                                {/* Status Badge - Clickable */}
                                                <div onClick={(e) => { e.stopPropagation(); handleShowTasks(agent); }}
                                                    className={`ml-4 shrink-0 px-4 py-1.5 rounded-full text-xs font-bold cursor-pointer transition-all hover:scale-105 border flex items-center gap-2 group/status ${(agent.running_tasks > 0)
                                                        ? 'bg-gradient-to-r from-slate-900 to-slate-800 text-white shadow-lg shadow-emerald-500/20 ring-1 ring-emerald-500/50'
                                                        : 'bg-slate-50 text-slate-400 border-slate-100 hover:bg-slate-100'
                                                        }`}>
                                                    <span className={`w-2.5 h-2.5 rounded-full ${agent.running_tasks > 0 ? 'bg-emerald-500 animate-pulse shadow-[0_0_8px_#10b981]' : 'bg-amber-400'}`}></span>
                                                    <span className="tracking-wide text-shadow-sm">{agent.running_tasks > 0 ? 'Â∑•‰Ωú‰∏≠' : 'ÂæÖÂëΩ'}</span>
                                                </div>
                                            </div>

                                            <div className="mb-0 flex flex-col justify-end min-h-[72px]">
                                                {agent.running_tasks > 0 ? (
                                                    (() => {
                                                        let colorClass = "bg-blue-50 border-blue-100 text-blue-700";
                                                        let iconColor = "text-blue-600";
                                                        let countColor = "text-blue-600 bg-blue-100";

                                                        if (agent.name.includes('Ââ™Ëæë') || agent.name.includes('ÂèëÂ∏É')) {
                                                            colorClass = "bg-indigo-50 border-indigo-100 text-indigo-700";
                                                            iconColor = "text-indigo-600";
                                                            countColor = "text-indigo-600 bg-indigo-100";
                                                        } else if (agent.name.includes('ÂéªÈáç') || agent.name.includes('Â§ÑÁêÜ')) {
                                                            colorClass = "bg-fuchsia-100 border-fuchsia-200 text-fuchsia-800";
                                                            iconColor = "text-fuchsia-600";
                                                            countColor = "text-fuchsia-600 bg-white";
                                                        }

                                                        return (
                                                            <div className="w-full">
                                                                {/* Task Count Header */}
                                                                <div className="flex items-center justify-between mb-2 px-1">
                                                                    <span className="text-[10px] uppercase tracking-widest font-black text-slate-400">Ê≠£Âú®ÊâßË°å</span>
                                                                    <div className={`px-2 py-0.5 rounded-md text-[10px] font-black ${countColor}`}>
                                                                        {4} ‰∏™‰ªªÂä°
                                                                    </div>
                                                                </div>

                                                                {/* Action Bar - Static Color */}
                                                                <div className={`inline-flex items-center gap-3 px-3 py-2.5 rounded-xl border w-full shadow-sm ${colorClass}`}>
                                                                    <div className="relative shrink-0">
                                                                        <Icon name="loader" size={16} className={`${iconColor} animate-spin`} />
                                                                    </div>
                                                                    <span className="text-sm font-bold truncate tracking-tight">{agent.current_action || 'Ê≠£Âú®Â§ÑÁêÜ‰ªªÂä°...'}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })()
                                                ) : (
                                                    <p className="text-sm text-slate-500 leading-relaxed font-medium line-clamp-2 px-1">
                                                        {agent.description}
                                                    </p>
                                                )}
                                            </div>

                                            <div className="mt-auto flex items-center justify-between text-[11px] mb-6 font-bold bg-slate-900/50 p-4 rounded-2xl border border-white/5 backdrop-blur-sm">
                                                <div className="flex items-center gap-6">
                                                    <div className="flex flex-col">
                                                        <div className="flex items-center gap-1.5 mb-0.5">
                                                            <Icon name="send" size={12} className="text-blue-400" />
                                                            <span className="text-white text-sm font-black tracking-tight">{agent.usage || (stats.fans + '‰∏á')}</span>
                                                        </div>
                                                        <span className="text-[8px] text-white/30 uppercase tracking-[0.1em]">ÁÉ≠Â∫¶/Ë∞ÉÁî®</span>
                                                    </div>
                                                    <div className="w-px h-6 bg-white/5"></div>
                                                    <div className="flex flex-col">
                                                        <div className="flex items-center gap-1.5 mb-0.5 text-orange-400">
                                                            <Icon name="stars" size={12} className="fill-orange-400" />
                                                            <span className="text-white text-sm font-black tracking-tight">{agent.rating || stats.rating}</span>
                                                        </div>
                                                        <span className="text-[8px] text-white/30 uppercase tracking-[0.1em]">ËØÑÂàÜ</span>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-1.5 ml-2">
                                                    <button className="p-2 text-white/20 hover:text-blue-400 hover:bg-white/5 rounded-xl transition-all border border-transparent hover:border-white/5 group/edit">
                                                        <Icon name="edit" size={14} className="group-hover:scale-110 transition-transform" />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(agent.id, agent.name, agent.isSelfCreated)}
                                                        className="p-2 text-slate-400 hover:text-white hover:bg-red-500 rounded-xl transition-all border border-transparent hover:border-red-500 group/delete"
                                                    >
                                                        <Icon name="trash" size={14} className="group-hover:scale-110 transition-transform" />
                                                    </button>
                                                </div>
                                            </div>

                                            <button
                                                onClick={() => setActiveAgent(agent)}
                                                className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-[20px] text-xs font-bold hover:from-blue-500 hover:to-indigo-500 shadow-lg shadow-blue-600/30 active:scale-[0.98] transition-all flex items-center justify-center gap-2 group/btn"
                                            >
                                                <span>Á´ãÂç≥‰ΩøÁî®</span>
                                                <Icon name="chevron-right" size={14} className="group-hover/btn:translate-x-1 transition-transform" />
                                            </button>
                                        </div>
                                    );
                                })}
                            </div>

                        )
                    }

                    {
                        selectedAgentForTasks && (
                            <AgentWorkbenchModal agent={selectedAgentForTasks} tasks={agentTasks} onClose={closeTaskModal} />
                        )
                    }
                </div >

            );

        };

        const ScheduleView = ({ showStatus }) => {
            const [scheduledPosts, setScheduledPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [confirmData, setConfirmData] = useState({ open: false, id: null });

            useEffect(() => {

                // Ê®°ÊãüËé∑ÂèñÂÆöÊó∂‰ªªÂä°ÔºåÂÆûÈôÖÂ∫î‰ªé posts ‰∏≠ËøáÊª§ status === 'SCHEDULED'

                // ËøôÈáå‰∏∫‰∫ÜÊºîÁ§∫ÊïàÊûúÔºåÂ¶ÇÊûúÊ≤°ÊúâÁúüÂÆûÊï∞ÊçÆÔºåÊàë‰ª¨ÈÄ†‰∏Ä‰∫õ Mock Êï∞ÊçÆ

                fetchScheduled();

            }, []);

            const fetchScheduled = async () => {

                setLoading(true);

                try {

                    const res = await fetch(`${API_BASE}/api/history`);

                    const data = await res.json();

                    const realScheduled = Array.isArray(data) ? data.filter(p => p.status === 'SCHEDULED' || p.status === 'WAITING') : [];

                    if (realScheduled.length > 0) {

                        setScheduledPosts(realScheduled);

                    } else {

                        // ÊºîÁ§∫Áî® Mock Êï∞ÊçÆ

                        setScheduledPosts([

                            {

                                id: 'mock_1',

                                postDate: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(), // ÊòéÂ§©

                                content: 'This is the default scheduled content, launching tomorrow! #AI #Automation',

                                accounts: [{

                                    type: 'YOUTUBE', name: 'tech_guru_99', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'

                                }],

                                media: [{

                                    type: 'image', url: 'cover1.png'

                                }]

                            },

                            {

                                id: 'mock_2',

                                postDate: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(), // 2Â∞èÊó∂Âêé

                                content: 'Noon News Dispatch: Big moves in the tech world? Click to see details',

                                accounts: [{

                                    type: 'TIKTOK', name: 'daily_news', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka'

                                }],

                                media: [] // Á∫ØÊñáÂ≠ó

                            }

                        ]);

                    }

                } catch (e) {

                    console.error(e);

                } finally {

                    setLoading(false);

                }

            };

            const handleDelete = (id) => {
                setConfirmData({ open: true, id: id });
            };

            const performCancelSchedule = () => {
                const id = confirmData.id;
                setConfirmData({ open: false, id: null });
                setScheduledPosts(prev => prev.filter(p => p.id !== id));
                showStatus('success', 'ÂÆöÊó∂ÂèëÂ∏ÉÂ∑≤ÂèñÊ∂à');
            };

            const formatTime = (isoString) => {

                const date = new Date(isoString);

                const hours = date.getHours().toString().padStart(2, '0');

                const minutes = date.getMinutes().toString().padStart(2, '0');

                return `${hours}:${minutes}`;

            };

            const formatDate = (isoString) => {

                const date = new Date(isoString);

                return `${date.getMonth() + 1}Êúà${date.getDate()}Êó•`;

            };

            const getTimeUntil = (isoString) => {

                const diff = new Date(isoString) - new Date();

                const hours = Math.floor(diff / (1000 * 60 * 60));

                if (hours < 0) return 'Âç≥Â∞ÜÂºÄÂßã';

                if (hours < 24) return `${hours}Â∞èÊó∂ÂêéÊâßË°å`;

                return `${Math.floor(hours / 24)}Â§©ÂêéÊâßË°å`;

            };

            return (
                <div className="max-w-6xl mx-auto space-y-12">
                    {confirmData.open && (
                        <CustomConfirmModal
                            title="ÂèñÊ∂àÂÆöÊó∂ÂèëÂ∏É"
                            message="Á°ÆÂÆöË¶ÅÂèñÊ∂àËøô‰∏™ÂÆöÊó∂ÂèëÂ∏É‰ªªÂä°ÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ"
                            onConfirm={performCancelSchedule}
                            onCancel={() => setConfirmData({ open: false, id: null })}
                            confirmText="ÂèñÊ∂àÂÆöÊó∂"
                            cancelText="‰øùÁïô"
                        />
                    )}
                    <div className="max-w-6xl mx-auto py-12 px-6">

                        <div className="flex items-center justify-between mb-16">

                            <div>

                                <div className="flex items-center gap-3 mb-3">

                                    <div className="p-3 bg-blue-50 text-blue-600 rounded-2xl">

                                        <Icon name="calendar" size={32} />

                                    </div>

                                    <h2 className="text-4xl font-black text-slate-900 tracking-tighter">ÂÆöÊó∂ÂèëÂ∏ÉÁü©Èòµ</h2>

                                </div>

                                <p className="text-slate-500 font-medium text-lg">Êô∫ËÉΩË∞ÉÂ∫¶ÂºïÊìéÈ´òÊïàËøêË°å‰∏≠ÔºåÁõëÊéßÊØè‰∏Ä‰∏™ÂæÖÂèëÂ∏ÉÁöÑËµÑ‰∫ß</p>

                            </div>

                            <div className="px-6 py-3 bg-[#0F172A] rounded-full flex items-center gap-3 shadow-xl shadow-slate-900/20">

                                <span className="relative flex h-3 w-3">

                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>

                                    <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>

                                </span>

                                <span className="text-green-400 font-bold text-xs uppercase tracking-widest">Ë∞ÉÂ∫¶Âô®ËøêË°åÊ≠£Â∏∏</span>

                            </div>

                        </div>

                        {loading ? (

                            <div className="grid grid-cols-1 gap-8">

                                {[1, 2].map(i => <div key={i} className="h-64 bg-slate-50 rounded-[40px] animate-pulse"></div>)}

                            </div>

                        ) : (

                            <div className="grid grid-cols-1 gap-8">

                                {scheduledPosts.map(post => (

                                    <div key={post.id} className="group relative bg-[#0F172A] rounded-[40px] p-10 overflow-hidden shadow-2xl transition-transform hover:scale-[1.01] duration-500">

                                        {/* Glass Effect Background */}

                                        <div className="absolute top-0 right-0 w-[500px] h-[500px] bg-blue-600/20 blur-[120px] rounded-full pointer-events-none -translate-y-1/2 translate-x-1/2"></div>

                                        <div className="relative z-10 flex items-start justify-between gap-12">

                                            {/* Left: Time & Info */}

                                            <div className="flex-1 min-w-0">

                                                <div className="mb-8">

                                                    <p className="text-slate-400 text-xs font-black uppercase tracking-[0.2em] mb-2">ÂÄíËÆ°Êó∂</p>

                                                    <div className="flex items-baseline gap-4">

                                                        <span className="text-7xl font-black text-white tracking-tighter">{formatTime(post.postDate)}</span>

                                                        <div className="flex flex-col">

                                                            <span className="text-blue-400 font-bold text-lg">{formatDate(post.postDate)}</span>

                                                            <span className="text-slate-500 text-xs font-bold uppercase tracking-wider">{getTimeUntil(post.postDate)}</span>

                                                        </div>

                                                    </div>

                                                </div>

                                                <div className="space-y-6">

                                                    <div className="flex items-center gap-3">

                                                        <p className="text-slate-500 text-xs font-bold uppercase tracking-wider min-w-[60px]">ÂêåÊ≠•Âü∫ÂáÜ</p>

                                                        <div className="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/10">

                                                            {(post.accounts || []).map((acc, idx) => (

                                                                <div key={idx} className="flex items-center gap-2">

                                                                    <div className="w-6 h-6 rounded-full bg-slate-800 overflow-hidden">

                                                                        {acc.avatar && <img src={acc.avatar} className="w-full h-full object-cover" />}

                                                                    </div>

                                                                    <span className="text-white font-bold text-xs">{acc.name}</span>

                                                                    <span className="text-slate-500 text-[10px] uppercase font-black bg-slate-900 px-1.5 py-0.5 rounded border border-white/5">{acc.type}</span>

                                                                </div>

                                                            ))}

                                                        </div>

                                                    </div>

                                                </div>

                                            </div>

                                            {/* Right: Content Preview */}

                                            <div className="w-[480px] bg-white/5 rounded-[32px] p-4 border border-white/10 flex gap-6 hover:bg-white/10 transition-colors cursor-pointer group/card">

                                                <div className="w-24 h-24 bg-slate-900 rounded-2xl overflow-hidden shrink-0 border border-white/5 relative" >

                                                    {

                                                        post.media && post.media.length > 0 ? (

                                                            <img

                                                                src={post.media[0].url}

                                                                className="w-full h-full object-cover opacity-80 group-hover/card:opacity-100 transition-opacity"

                                                                onError={(e) => {

                                                                    if (post.media[0].type?.startsWith('video')) {

                                                                        // Â¶ÇÊûúËßÜÈ¢ëÈ¢ÑËßàÁ¢é‰∫ÜÔºåÊòæÁ§∫Áî®Êà∑‰∏ä‰º†ÁöÑÂ∞ÅÈù¢
                                                                        const covers = ["cover1.png", "cover2.png", "cover3.png", "cover4.png", "cover5.png", "cover11.png", "cover7.png", "cover8.png", "cover9.png"];
                                                                        const h = Math.abs(String(post.id).split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0));
                                                                        e.target.src = covers[h % covers.length];

                                                                    } else {
                                                                        const covers = ["cover1.png", "cover2.png", "cover3.png", "cover4.png", "cover5.png", "cover11.png", "cover7.png", "cover8.png", "cover9.png"];
                                                                        const h = Math.abs(String(post.id).split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0));
                                                                        e.target.src = covers[h % covers.length];

                                                                    }

                                                                    e.target.onerror = null;

                                                                }}

                                                            />

                                                        ) : (

                                                            <div className="w-full h-full flex items-center justify-center text-slate-700">

                                                                <Icon name="file-text" />

                                                            </div>

                                                        )}

                                                </div>

                                                <div className="flex-1 py-1">

                                                    <p className="text-slate-300 text-sm font-medium leading-relaxed line-clamp-2 mb-3">

                                                        {post.content || 'No caption content'}

                                                    </p>

                                                    <div className="flex items-center gap-2">

                                                        <span className="text-blue-400 text-xs font-bold hover:underline flex items-center gap-1">

                                                            Êü•ÁúãËØ¶ÊÉÖ

                                                            <Icon name="chevron-right" size={12} />

                                                        </span>

                                                    </div>

                                                </div>

                                            </div>

                                            {/* Action */}

                                            <button

                                                onClick={() => handleDelete(post.id)}

                                                className="absolute top-10 right-10 w-12 h-12 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-slate-500 hover:bg-red-500/20 hover:text-red-400 hover:border-red-500/50 transition-all opacity-0 group-hover:opacity-100"

                                            >

                                                <Icon name="trash" size={20} />

                                            </button>

                                        </div>

                                    </div>

                                ))}

                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('my-agents');
            const [accounts, setAccounts] = useState([]);
            const [integrations, setIntegrations] = useState([]);
            const [loading, setLoading] = useState(true);
            const [connectingId, setConnectingId] = useState(null);
            const [selectedPlatform, setSelectedPlatform] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [confirmData, setConfirmData] = useState({ open: false, id: null, name: '' });
            const [statusModal, setStatusModal] = useState({ isOpen: false, type: 'success', message: '' });
            const [postContent, setPostContent] = useState('');
            const [selectedAccounts, setSelectedAccounts] = useState([]);
            const [mediaFiles, setMediaFiles] = useState([]);
            const [publishing, setPublishing] = useState(false);
            const [showPublishSuccess, setShowPublishSuccess] = useState(false);
            const [lastPublishedAccounts, setLastPublishedAccounts] = useState([]);

            const showStatus = (type, message) => {
                setStatusModal({ isOpen: true, type, message });
            };

            // Fetch Data

            const fetchData = async () => {
                setLoading(true);
                try {
                    const fetchAccounts = async () => {
                        const accRes = await fetch(`${API_BASE}/api/accounts`).catch(() => null);
                        if (accRes && accRes.ok) {
                            const data = await accRes.json();
                            const processedAccounts = data.map(acc => ({
                                ...acc,
                                type: acc.type || acc.platform || 'SOCIAL',
                                platform: acc.platform || acc.type || 'SOCIAL'
                            }));
                            setAccounts(processedAccounts);
                            console.log('‚úÖ ÊàêÂäüÂä†ËΩΩË¥¶Êà∑:', processedAccounts.length);
                        } else {
                            setAccounts([]);
                            console.warn('‚ö†Ô∏è Ë¥¶Êà∑APIËØ∑Ê±ÇÂ§±Ë¥•');
                        }
                    };

                    const fetchIntegrations = async () => {
                        const intRes = await fetch(`${API_BASE}/api/integrations`).catch(() => null);
                        if (intRes && intRes.ok) {
                            const data = await intRes.json();
                            setIntegrations(data);
                        }
                    };

                    await Promise.all([fetchAccounts(), fetchIntegrations()]);
                } catch (e) {
                    console.error(e);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
                const handleMessage = (event) => {
                    if (event.data === "auth_success") {
                        console.log("Authorization successful, refreshing data...");
                        fetchData();
                    }
                };
                window.addEventListener("message", handleMessage);
                return () => window.removeEventListener("message", handleMessage);
            }, []);

            const openModal = (platform) => {
                setSelectedPlatform(platform);
                setIsModalOpen(true);
            };

            const handleAuthorize = async () => {
                if (!selectedPlatform) return;
                setConnectingId(selectedPlatform.id);
                const authWindow = window.open('about:blank', '_blank', 'width=600,height=800');
                try {
                    const res = await fetch(`${API_BASE}/api/connect-url`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ platformId: selectedPlatform.id })
                    });
                    if (res && res.ok) {
                        const { url, error } = await res.json();
                        if (url) {
                            authWindow.location.href = url;
                            setIsModalOpen(false);
                        } else {
                            authWindow.close();
                            showStatus('error', `ÊéàÊùÉÂ§±Ë¥•: ${error || "Êú™Áü•ÈîôËØØ"}`);
                        }
                    } else {
                        authWindow.close();
                        const errorData = await res.json().catch(() => ({}));
                        showStatus('error', errorData.error || "Ëé∑ÂèñÊéàÊùÉÈìæÊé•Â§±Ë¥•");
                    }
                } catch (e) {
                    if (authWindow) authWindow.close();
                    showStatus('error', "ÁΩëÁªúÈîôËØØ");
                } finally { setConnectingId(null); }
            };

            const handleDisconnect = (id, name) => {
                setConfirmData({ open: true, id, name });
            };

            const performDisconnect = async () => {
                const { id, name } = confirmData;
                setConfirmData({ open: false, id: null, name: '' });
                try {
                    setAccounts(prev => prev.filter(a => a.id !== id));
                    await fetch(`${API_BASE}/api/accounts/${id}`, { method: 'DELETE' });
                    showStatus('success', `Ë¥¶Âè∑‚Äú${name}‚ÄùÂ∑≤Êñ≠ÂºÄËøûÊé•`);
                } catch (e) { showStatus('error', 'Êñ≠ÂºÄËøûÊé•Â§±Ë¥•'); }
            };

            // Publish page handlers

            const toggleAccountSelection = (accountId) => {

                setSelectedAccounts(prev =>

                    prev.includes(accountId) ? prev.filter(id => id !== accountId)

                        : [...prev, accountId]

                );

            };

            const handlePublish = async () => {

                if (!postContent.trim() && mediaFiles.length === 0) {

                    showStatus('error', 'Please enter post content or upload video/image');

                    return;

                }

                if (selectedAccounts.length === 0) {

                    showStatus('error', 'Please select at least one account');

                    return;

                }

                setPublishing(true);

                try {

                    const formData = new FormData();

                    formData.append('content', postContent);

                    formData.append('accountIds', JSON.stringify(selectedAccounts));

                    // Ê∑ªÂä†Â™í‰Ωì

                    mediaFiles.forEach(m => {

                        if (m.file) {

                            formData.append('media', m.file);

                        } else if (m.remoteUrl) {

                            formData.append('mediaUrls', m.remoteUrl);

                        }

                    });

                    const response = await fetch(`${API_BASE}/api/publish`, {

                        method: 'POST',

                        body: formData

                    });

                    const result = await response.json();

                    if (response.ok) {

                        const msg = result.message || 'ÂÜÖÂÆπÂèëÂ∏ÉÊàêÂäüÔºÅÊÇ®ÁöÑÂÜÖÂÆπÊ≠£Âú®ÂêåÊ≠•Ëá≥ÂêÑÂπ≥Âè∞„ÄÇ';

                        // showStatus('success', msg); // Replacing with custom modal

                        setPostContent('');

                        // Find the account objects for the selected IDs before clearing
                        const publishedAccs = accounts.filter(a => selectedAccounts.includes(a.id));
                        setLastPublishedAccounts(publishedAccs);

                        setSelectedAccounts([]);

                        // Ê∏ÖÁêÜÊú¨Âú∞È¢ÑËßà URL ÈÅøÂÖçÂÜÖÂ≠òÊ≥ÑÊºè

                        mediaFiles.forEach(m => { if (m.preview && m.preview.startsWith('blob:')) URL.revokeObjectURL(m.preview); });

                        setMediaFiles([]);

                        // Show success modal instead of switching tab
                        setShowPublishSuccess(true);
                    } else {
                        let errorMsg = result.error || 'Unknown error';

                        // üåü ‰øùÁïôÊç¢Ë°åÁ¨¶Ôºå‰ΩøÈîôËØØÊ∂àÊÅØÊõ¥ÊòìËØª
                        // Â∞Ü \n ËΩ¨Êç¢‰∏∫ÂÆûÈôÖÊç¢Ë°å
                        if (errorMsg.includes('\\n')) {
                            errorMsg = errorMsg.replace(/\\n/g, '\n');
                        }

                        showStatus('error', 'Publish failed: ' + errorMsg);
                    }
                } catch (error) {
                    showStatus('error', 'Publish network error: ' + error.message);

                }

                setPublishing(false);

            };

            return (
                <div className="flex w-full h-full bg-transparent overflow-hidden">
                    {confirmData.open && (
                        <CustomConfirmModal
                            title="Êñ≠ÂºÄË¥¶Âè∑ËøûÊé•"
                            message={`Á°ÆÂÆöË¶ÅÊñ≠ÂºÄË¥¶Âè∑‚Äú${confirmData.name}‚ÄùÁöÑËøûÊé•ÂêóÔºüÊâÄÊúâÁõ∏ÂÖ≥ÁöÑÂÆöÊó∂ÂèëÂ∏É‰ªªÂä°ÂèØËÉΩ‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇ`}
                            onConfirm={performDisconnect}
                            onCancel={() => setConfirmData({ open: false, id: null, name: '' })}
                            confirmText="Á°ÆËÆ§Êñ≠ÂºÄ"
                        />
                    )}
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />

                    <div className="flex-1 flex flex-col h-full overflow-hidden">

                        {/* Header */}

                        <header className="h-14 bg-slate-900/30 backdrop-blur-xl border-b border-purple-500/20 px-8 flex items-center justify-between shrink-0">

                            <div className="flex items-center gap-2">

                                <h2 className="text-lg font-bold text-slate-800">

                                    {activeTab === 'accounts' ? 'Á§æ‰∫§Ë¥¶Âè∑' :

                                        activeTab === 'posts' ? 'ÂèëÂ∏É‰∏≠ÂøÉ' :

                                            activeTab === 'ai-lab' ? 'Êô∫ËÉΩ‰ΩìÂπøÂú∫' :

                                                activeTab === 'my-agents' ? 'Êô∫ËÉΩÂõ¢Èòü' :

                                                    activeTab === 'schedule' ? 'ÂÆöÊó∂ÂèëÂ∏É' :

                                                        activeTab === 'history' ? 'ÂÜÖÂÆπ‰∏≠ÂøÉ' : '‰ª™Ë°®Áõò'}

                                </h2>

                            </div>

                            <div className="flex items-center gap-6">

                                <div className="relative group">

                                    <input

                                        type="text"

                                        placeholder="ÊêúÁ¥¢..."

                                        className="bg-slate-50 border border-slate-100 px-4 py-2 pl-10 rounded-full text-xs outline-none focus:ring-2 focus:ring-blue-500/10 focus:border-blue-400 transition-all w-64"

                                    />

                                    <Icon name="search" size={14} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" />

                                </div>

                                <div className="flex items-center gap-4 text-slate-400">

                                    <button className="hover:text-slate-600 transition-colors">

                                        <Icon name="bell" size={20} />

                                    </button>

                                    <button className="hover:text-slate-600 transition-colors">

                                        <Icon name="help" size={20} />

                                    </button>

                                </div>

                                <div className="flex items-center gap-3 pl-6 border-l border-slate-100">

                                    <div className="w-8 h-8 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-xs overflow-hidden border border-blue-100 shadow-sm">

                                        {CURRENT_USER.avatar ? <img src={CURRENT_USER.avatar} className="w-full h-full object-cover" /> : CURRENT_USER.initials}

                                    </div>

                                    <span className="text-xs font-bold text-slate-700">{CURRENT_USER.name}</span>

                                </div>

                            </div>

                        </header>

                        {/* Main Content Scrollable */}

                        <main className="flex-1 overflow-y-auto p-6 bg-transparent">

                            {activeTab === 'accounts' && (

                                <section className="max-w-6xl mx-auto">

                                    <div className="flex items-center justify-between mb-8">

                                        <div className="flex items-center gap-2">

                                            <h3 className="text-lg font-bold text-slate-800">Â∑≤ËøûÊé•Ë¥¶Âè∑</h3>

                                            <span className="bg-slate-200 text-slate-600 px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider">{accounts.length} Ê¥ªË∑É</span>

                                        </div>

                                        <div className="flex items-center gap-4">

                                            <button

                                                onClick={fetchData}

                                                className="flex items-center gap-1.5 text-slate-500 hover:text-secondary text-sm font-bold transition-colors"

                                            >

                                                <Icon name="link" size={14} className={loading ? "animate-spin" : ""} />

                                                {loading ? "ÂêåÊ≠•‰∏≠..." : "Á´ãÂç≥ÂêåÊ≠•"}

                                            </button>

                                        </div>

                                    </div>

                                    {loading ? (

                                        <div className="flex flex-col items-center justify-center py-20 text-slate-400 gap-4">

                                            <div className="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>

                                            <p className="text-sm font-medium">Ê≠£Âú®Âä†ËΩΩË¥¶Êà∑‰ø°ÊÅØ...</p>

                                        </div>

                                    ) : (

                                        <>

                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">

                                                {accounts.map(acc => (

                                                    <ConnectedCard key={acc.id} account={acc} onDisconnect={(id) => handleDisconnect(id, acc.name)} />

                                                ))}

                                            </div>

                                            <section id="integrations-section" className="mt-12">

                                                <h3 className="text-lg font-bold text-slate-800 mb-2">ÂèØÁî®ÈõÜÊàêÂπ≥Âè∞</h3>

                                                <p className="text-slate-500 text-sm mb-8">ÈÄâÊã©‰∏ãÊñπÂπ≥Âè∞ËøûÊé•ÊÇ®ÁöÑÁ§æ‰∫§Â™í‰ΩìË¥¶Âè∑</p>

                                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">

                                                    {integrations.map(int => (

                                                        <IntegrationCard

                                                            key={int.id}

                                                            integration={int}

                                                            onConnect={() => openModal(int)}

                                                            isConnecting={connectingId === int.id}

                                                        />

                                                    ))}

                                                </div>

                                            </section>

                                        </>

                                    )}

                                </section>

                            )}

                            {
                                activeTab === 'posts' && (
                                    <PublishView
                                        accounts={accounts}
                                        postContent={postContent}
                                        setPostContent={setPostContent}
                                        selectedAccounts={selectedAccounts}
                                        toggleAccountSelection={toggleAccountSelection}
                                        handlePublish={handlePublish}
                                        publishing={publishing}
                                        mediaFiles={mediaFiles}
                                        setMediaFiles={setMediaFiles}
                                        showStatus={showStatus}
                                    />
                                )
                            }
                            {
                                activeTab === 'ai-lab' && (
                                    <AIAgentsView setActiveTab={setActiveTab} setMediaFiles={setMediaFiles} setPostContent={setPostContent} showStatus={showStatus} />
                                )
                            }
                            {
                                activeTab === 'my-agents' && (
                                    <MyAgentsView setActiveTab={setActiveTab} setMediaFiles={setMediaFiles} setPostContent={setPostContent} showStatus={showStatus} />
                                )
                            }

                            {
                                activeTab === 'history' && (
                                    <HistoryView showStatus={showStatus} />
                                )
                            }
                            {
                                activeTab === 'schedule' && (
                                    <ScheduleView showStatus={showStatus} />
                                )
                            }
                            {
                                activeTab === 'analytics' && (
                                    <AnalyticsView showStatus={showStatus} />
                                )
                            }

                            {

                                activeTab !== 'accounts' && activeTab !== 'posts' && activeTab !== 'ai-lab' && activeTab !== 'my-agents' && activeTab !== 'history' && activeTab !== 'schedule' && activeTab !== 'analytics' && (

                                    <div className="flex flex-col items-center justify-center py-40">

                                        <div className="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center text-slate-300 mb-6">

                                            <Icon name="layout" size={40} />

                                        </div>

                                        <h3 className="text-xl font-bold text-slate-800 mb-2">{activeTab} page is under development</h3>

                                        <p className="text-slate-500">Feature coming soon, stay tuned</p>

                                    </div>

                                )

                            }

                        </main >



                    </div>

                    {
                        isModalOpen && (
                            <LoginModal
                                platform={selectedPlatform}
                                onClose={() => setIsModalOpen(false)}
                                onAuthorize={handleAuthorize}
                                isConnecting={!!connectingId}
                            />
                        )
                    }

                    <StatusModal
                        isOpen={statusModal.isOpen}
                        type={statusModal.type}
                        message={statusModal.message}
                        onClose={() => setStatusModal({ ...statusModal, isOpen: false })}
                    />

                    {showPublishSuccess && (
                        <PublishSuccessModal
                            publishedAccounts={lastPublishedAccounts}
                            onClose={() => setShowPublishSuccess(false)}
                            onViewHistory={() => {
                                setShowPublishSuccess(false);
                                setActiveTab('history');
                            }}
                        />
                    )}

                </div>

            );

        };

        const root = ReactDOM.createRoot(document.getElementById('root'));

        root.render(<App />);

    </script>

</body>

</html>